diff -N -r -u poppler-0.6.4-orig/cmake/modules/COPYING-CMAKE-SCRIPTS poppler-0.6.4/cmake/modules/COPYING-CMAKE-SCRIPTS
--- poppler-0.6.4-orig/cmake/modules/COPYING-CMAKE-SCRIPTS	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/COPYING-CMAKE-SCRIPTS	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,22 @@
+Redistribution and use in source and binary forms, with or without
+modification, are permitted provided that the following conditions
+are met:
+
+1. Redistributions of source code must retain the copyright
+   notice, this list of conditions and the following disclaimer.
+2. Redistributions in binary form must reproduce the copyright
+   notice, this list of conditions and the following disclaimer in the
+   documentation and/or other materials provided with the distribution.
+3. The name of the author may not be used to endorse or promote products 
+   derived from this software without specific prior written permission.
+
+THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
+IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
+IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
+INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
+NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
+THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
diff -N -r -u poppler-0.6.4-orig/cmake/modules/FindCairo.cmake poppler-0.6.4/cmake/modules/FindCairo.cmake
--- poppler-0.6.4-orig/cmake/modules/FindCairo.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/FindCairo.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,44 @@
+# - try to find Cairo
+# Once done this will define
+#
+#  CAIRO_FOUND - system has Cairo
+#  CAIRO_CFLAGS - the Cairo CFlags
+#  CAIRO_LIBRARIES - Link these to use Cairo
+#
+# Copyright (c) 2007, Pino Toscano, <pino@kde.org>
+#
+# Redistribution and use is allowed according to the terms of the BSD license.
+# For details see the accompanying COPYING-CMAKE-SCRIPTS file.
+
+if (NOT WIN32)
+  include(UsePkgConfig)
+
+  pkgconfig(cairo _LibCairoIncDir _LibCairoLinkDir _CairoLinkFlags _CairoCflags)
+  set (CAIRO_FOUND FALSE)
+  if (_LibCairoIncDir)
+
+    if (CAIRO_VERSION)
+
+      exec_program(${PKGCONFIG_EXECUTABLE} ARGS --atleast-version=${CAIRO_VERSION} cairo RETURN_VALUE _return_VALUE OUTPUT_VARIABLE _pkgconfigDevNull)
+      if(_return_VALUE STREQUAL "0")
+        set (CAIRO_CFLAGS ${_CairoCflags})
+        set (CAIRO_LIBRARIES ${_CairoLinkFlags})
+      endif(_return_VALUE STREQUAL "0")
+
+    else (CAIRO_VERSION)
+      set (CAIRO_CFLAGS ${_CairoCflags})
+      set (CAIRO_LIBRARIES ${_CairoLinkFlags})
+    endif (CAIRO_VERSION)
+
+    include(FindPackageHandleStandardArgs)
+    find_package_handle_standard_args(Cairo DEFAULT_MSG CAIRO_LIBRARIES CAIRO_CFLAGS)
+
+  endif (_LibCairoIncDir)
+
+endif(NOT WIN32)
+
+mark_as_advanced(
+  CAIRO_CFLAGS
+  CAIRO_LIBRARIES
+)
+
diff -N -r -u poppler-0.6.4-orig/cmake/modules/FindFontconfig.cmake poppler-0.6.4/cmake/modules/FindFontconfig.cmake
--- poppler-0.6.4-orig/cmake/modules/FindFontconfig.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/FindFontconfig.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,47 @@
+# - Try to find the  Fontconfig
+# Once done this will define
+#
+#  FONTCONFIG_FOUND - system has Fontconfig
+#  FONTCONFIG_LIBRARIES - Link these to use FONTCONFIG
+#  FONTCONFIG_DEFINITIONS - Compiler switches required for using FONTCONFIG
+
+# Copyright (c) 2006,2007 Laurent Montel, <montel@kde.org>
+#
+# Redistribution and use is allowed according to the terms of the BSD license.
+# For details see the accompanying COPYING-CMAKE-SCRIPTS file.
+
+
+if (FONTCONFIG_LIBRARIES AND FONTCONFIG_INCLUDE_DIR)
+
+  # in cache already
+  set(FONTCONFIG_FOUND TRUE)
+
+else (FONTCONFIG_LIBRARIES AND FONTCONFIG_INCLUDE_DIR)
+
+  if (NOT WIN32)
+    # use pkg-config to get the directories and then use these values
+    # in the FIND_PATH() and FIND_LIBRARY() calls
+    include(UsePkgConfig)
+
+    pkgconfig(fontconfig _FONTCONFIGIncDir _FONTCONFIGLinkDir _FONTCONFIGLinkFlags _FONTCONFIGCflags)
+
+    set(FONTCONFIG_DEFINITIONS ${_FONTCONFIGCflags} CACHE INTERNAL "The compilation flags for fontconfig")
+  endif (NOT WIN32)
+
+  find_path(FONTCONFIG_INCLUDE_DIR fontconfig/fontconfig.h
+    PATHS
+    ${_FONTCONFIGIncDir}
+    /usr/X11/include
+  )
+
+  find_library(FONTCONFIG_LIBRARIES NAMES fontconfig
+    PATHS
+    ${_FONTCONFIGLinkDir}
+  )
+
+  include(FindPackageHandleStandardArgs)
+  FIND_PACKAGE_HANDLE_STANDARD_ARGS(Fontconfig DEFAULT_MSG FONTCONFIG_LIBRARIES FONTCONFIG_INCLUDE_DIR )
+  
+  mark_as_advanced(FONTCONFIG_LIBRARIES FONTCONFIG_INCLUDE_DIR)
+
+endif (FONTCONFIG_LIBRARIES AND FONTCONFIG_INCLUDE_DIR)
diff -N -r -u poppler-0.6.4-orig/cmake/modules/FindFreetype.cmake poppler-0.6.4/cmake/modules/FindFreetype.cmake
--- poppler-0.6.4-orig/cmake/modules/FindFreetype.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/FindFreetype.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,72 @@
+# - Try to find the freetype library
+# Once done this will define
+#
+#  FREETYPE_FOUND - system has Freetype
+#  FREETYPE_INCLUDE_DIR - the FREETYPE include directory
+#  FREETYPE_LIBRARIES - Link these to use FREETYPE
+#
+# Copyright (c) 2006, Laurent Montel, <montel@kde.org>
+#
+# Redistribution and use is allowed according to the terms of the BSD license.
+# For details see the accompanying COPYING-CMAKE-SCRIPTS file.
+
+
+if (FREETYPE_LIBRARIES AND FREETYPE_INCLUDE_DIR)
+
+  # in cache already
+  set(FREETYPE_FOUND TRUE)
+
+else (FREETYPE_LIBRARIES AND FREETYPE_INCLUDE_DIR)
+
+  FIND_PROGRAM(FREETYPECONFIG_EXECUTABLE NAMES freetype-config PATHS
+     /opt/local/bin
+  )
+
+  #reset vars
+  set(FREETYPE_LIBRARIES)
+  set(FREETYPE_INCLUDE_DIR)
+
+  # if freetype-config has been found
+  if(FREETYPECONFIG_EXECUTABLE)
+
+    EXEC_PROGRAM(${FREETYPECONFIG_EXECUTABLE} ARGS --libs RETURN_VALUE _return_VALUE OUTPUT_VARIABLE FREETYPE_LIBRARIES)
+
+    EXEC_PROGRAM(${FREETYPECONFIG_EXECUTABLE} ARGS --cflags RETURN_VALUE _return_VALUE OUTPUT_VARIABLE _freetype_pkgconfig_output)
+    if(FREETYPE_LIBRARIES AND _freetype_pkgconfig_output)
+      set(FREETYPE_FOUND TRUE)
+
+      # freetype-config can print out more than one -I, so we need to chop it up
+      # into a list and process each entry separately
+      SEPARATE_ARGUMENTS(_freetype_pkgconfig_output)
+      FOREACH(value ${_freetype_pkgconfig_output})
+        STRING(REGEX REPLACE "-I(.+)" "\\1" value "${value}")
+        set(FREETYPE_INCLUDE_DIR ${FREETYPE_INCLUDE_DIR} ${value})
+      ENDFOREACH(value)
+    endif(FREETYPE_LIBRARIES AND _freetype_pkgconfig_output)
+
+    MARK_AS_ADVANCED(FREETYPE_LIBRARIES FREETYPE_INCLUDE_DIR)
+
+    set( FREETYPE_LIBRARIES ${FREETYPE_LIBRARIES} CACHE INTERNAL "The libraries for freetype" )
+
+  else(FREETYPECONFIG_EXECUTABLE)
+	find_path (FREETYPE_INCLUDE_DIR freetype/freetype.h
+        ${CMAKE_INCLUDE_PATH}/freetype2
+	)
+    find_library(FREETYPE_LIBRARIES freetype)
+    if(FREETYPE_INCLUDE_DIR AND FREETYPE_LIBRARIES)
+        set(FREETYPE_FOUND TRUE)
+    endif(FREETYPE_INCLUDE_DIR AND FREETYPE_LIBRARIES)
+  endif(FREETYPECONFIG_EXECUTABLE)
+
+
+  IF (FREETYPE_FOUND)
+    IF (NOT Freetype_FIND_QUIETLY)
+       MESSAGE(STATUS "Found Freetype: ${FREETYPE_LIBRARIES}")
+    ENDIF (NOT Freetype_FIND_QUIETLY)
+  ELSE (FREETYPE_FOUND)
+    IF (Freetype_FIND_REQUIRED)
+       MESSAGE(FATAL_ERROR "Could not find FreeType library")
+    ENDIF (Freetype_FIND_REQUIRED)
+  ENDIF (FREETYPE_FOUND)
+
+endif (FREETYPE_LIBRARIES AND FREETYPE_INCLUDE_DIR)
diff -N -r -u poppler-0.6.4-orig/cmake/modules/FindGTK.cmake poppler-0.6.4/cmake/modules/FindGTK.cmake
--- poppler-0.6.4-orig/cmake/modules/FindGTK.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/FindGTK.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,70 @@
+# - try to find GTK (and glib)
+# Once done this will define
+#
+#  GLIB_FOUND - system has GLib
+#  GLIB_CFLAGS - the GLib CFlags
+#  GLIB_LIBRARIES - Link these to use GLib
+#
+# Copyright (c) 2007, Pino Toscano, <pino@kde.org>
+#
+# Redistribution and use is allowed according to the terms of the BSD license.
+# For details see the accompanying COPYING-CMAKE-SCRIPTS file.
+
+include(FindPackageHandleStandardArgs)
+
+if (NOT WIN32)
+  include(UsePkgConfig)
+
+  pkgconfig(glib-2.0 _LibGLIB2IncDir _LibGLIB2LinkDir GLIB2LinkFlags GLIB2Cflags)
+  pkgconfig(gdk-2.0 _LibGDK2IncDir _LibGDK2LinkDir GDK2LinkFlags GDK2Cflags)
+  set (GLIB_FOUND FALSE)
+  if (_LibGLIB2IncDir AND _LibGDK2IncDir)
+
+    exec_program(${PKGCONFIG_EXECUTABLE} ARGS --atleast-version=2.6 glib-2.0 RETURN_VALUE _return_VALUE OUTPUT_VARIABLE _pkgconfigDevNull)
+    if(_return_VALUE STREQUAL "0")
+      set(_glib_FOUND TRUE)
+    endif(_return_VALUE STREQUAL "0")
+
+    exec_program(${PKGCONFIG_EXECUTABLE} ARGS --atleast-version=2.4.0 gdk-2.0 RETURN_VALUE _return_VALUE OUTPUT_VARIABLE _pkgconfigDevNull)
+    if(_return_VALUE STREQUAL "0")
+      set(_gdk_FOUND TRUE)
+    endif(_return_VALUE STREQUAL "0")
+
+    if (_glib_FOUND AND _gdk_FOUND)
+      set (GLIB2_CFLAGS ${GLIB2Cflags} ${GDK2Cflags})
+      set (GLIB2_LIBRARIES ${GLIB2LinkFlags} ${GDK2LinkFlags})
+    endif (_glib_FOUND AND _gdk_FOUND)
+
+    find_package_handle_standard_args(GLib DEFAULT_MSG GLIB2_LIBRARIES GLIB2_CFLAGS)
+
+  endif (_LibGLIB2IncDir AND _LibGDK2IncDir)
+
+  pkgconfig(gtk+-2.0 _LibGTK2IncDir _LibGTK2LinkDir GTK2LinkFlags GTK2Cflags)
+  pkgconfig(gdk-pixbuf-2.0 _LibGDK2PixbufIncDir _LibGDK2PixbufLinkDir GDK2PixbufLinkFlags GDK2PixbufCflags)
+  pkgconfig(libglade-2.0 _LibGLADE2IncDir _LibGLADE2LinkDir GLADE2LinkFlags GLADE2Cflags)
+
+  if (_LibGTK2IncDir AND _LibGDK2PixbufIncDir AND _LibGLADE2IncDir)
+
+    exec_program(${PKGCONFIG_EXECUTABLE} ARGS --atleast-version=2.8.0 gtk+-2.0 RETURN_VALUE _return_VALUE OUTPUT_VARIABLE _pkgconfigDevNull)
+    if(_return_VALUE STREQUAL "0")
+      set(_gtk_FOUND TRUE)
+    endif(_return_VALUE STREQUAL "0")
+
+    if (_gtk_FOUND)
+      set (GTK2_CFLAGS ${GTK2Cflags} ${GDK2PixbufCflags} ${GLADE2Cflags})
+      set (GTK2_LIBRARIES ${GTK2LinkFlags} ${GDK2PixbufLinkFlags} ${GLADE2LinkFlags})
+    endif (_gtk_FOUND)
+
+    find_package_handle_standard_args(GTK DEFAULT_MSG GTK2_LIBRARIES GTK2_CFLAGS)
+
+  endif (_LibGTK2IncDir AND _LibGDK2PixbufIncDir AND _LibGLADE2IncDir)
+
+endif(NOT WIN32)
+
+mark_as_advanced(
+  GLIB2_CFLAGS
+  GLIB2_LIBRARIES
+  GTK2_CFLAGS
+  GTK2_LIBRARIES
+)
+
diff -N -r -u poppler-0.6.4-orig/cmake/modules/FindKDEWIN.cmake poppler-0.6.4/cmake/modules/FindKDEWIN.cmake
--- poppler-0.6.4-orig/cmake/modules/FindKDEWIN.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/FindKDEWIN.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,64 @@
+# - Try to find the directory in which the kdewin32 library and other win32 related libraries lives
+# 
+# used environment vars 
+#  KDEWIN_DIR  - kdewin root dir 
+#
+# this will define
+#  KDEWIN_FOUND - system has KDEWIN
+#  KDEWIN_DIR - the KDEWIN root installation dir
+#
+# Copyright (c) 2007, Ralf Habacker, <ralf.habacker@freenet.de>
+#
+# Redistribution and use is allowed according to the terms of the BSD license.
+# For details see the accompanying COPYING-CMAKE-SCRIPTS file.
+
+if (WIN32)
+  IF (NOT KDEWIN_DIR)
+    # check for enviroment variable
+    file(TO_CMAKE_PATH "$ENV{KDEWIN_DIR}" KDEWIN_DIR)
+    if(NOT KDEWIN_DIR)
+      file(TO_CMAKE_PATH "$ENV{PROGRAMFILES}" _progFiles)
+      if (MINGW)
+        set (DIR "kdewin-mingw")
+      else (MINGW)
+        set (DIR "kdewin-msvc")
+      endif (MINGW)
+      
+      # search in the default program install folder
+      find_file(KDEWIN_DIR_tmp ${DIR} kdewin kdewin32 win32libs gnuwin32
+      PATHS
+        "${_progFiles}"
+      )
+      set (KDEWIN_DIR ${KDEWIN_DIR_tmp})
+    endif (NOT KDEWIN_DIR)
+    if (KDEWIN_DIR)
+      message(STATUS "Found windows supplementary package location: ${KDEWIN_DIR}")
+    endif (KDEWIN_DIR)
+  endif (NOT KDEWIN_DIR)
+
+  # this must be set every time 
+  if (KDEWIN_DIR)
+    # add include path and library to all targets, this is required because 
+    # cmake's 2.4.6 FindZLib.cmake does not use CMAKE_REQUIRED... vars
+    set(CMAKE_INCLUDE_PATH ${CMAKE_INCLUDE_PATH} ${KDEWIN_DIR}/include)
+    set(CMAKE_LIBRARY_PATH ${CMAKE_LIBRARY_PATH} ${KDEWIN_DIR}/lib)
+     
+    set (KDEWIN_FOUND 1)
+    if (NOT KDEWIN_FIND_QUIETLY)
+      message(STATUS "Found kdewin32 library: ${KDEWIN32_LIBRARY}")
+    endif (NOT KDEWIN_FIND_QUIETLY)
+
+  else(KDEWIN_DIR)
+    if( KDEWIN_FIND_REQUIRED )
+      message(FATAL_ERROR "Could not find the location of the windows supplementary packages which is \n"
+                      "\t\tenvironment variable KDEWIN_DIR\n"
+                      "\t\t<ProgramFiles>/${DIR}\n"
+                      "\t\t<ProgramFiles>/kdewin\n" 
+                      "\t\t<ProgramFiles>/kdewin32\n" 
+                      "\t\t<ProgramFiles>/win32libs\n"
+                      "\t\t<ProgramFiles>/gnuwin32\n"
+      )
+    endif( KDEWIN_FIND_REQUIRED )
+   endif(KDEWIN_DIR)
+  
+endif (WIN32)
diff -N -r -u poppler-0.6.4-orig/cmake/modules/FindKDEWIN32.cmake poppler-0.6.4/cmake/modules/FindKDEWIN32.cmake
--- poppler-0.6.4-orig/cmake/modules/FindKDEWIN32.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/FindKDEWIN32.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,74 @@
+# - Try to find the KDEWIN32 library
+# 
+# Once done this will define
+#
+#  KDEWIN32_FOUND - system has KDEWIN32
+#  KDEWIN32_INCLUDES - the KDEWIN32 include directories
+#  KDEWIN32_LIBRARIES - The libraries needed to use KDEWIN32
+#
+# Copyright (c) 2006, Alexander Neundorf, <neundorf@kde.org>
+# Copyright (c) 2007, Ralf Habacker, <ralf.habacker@freenet.de>
+#
+# Redistribution and use is allowed according to the terms of the BSD license.
+# For details see the accompanying COPYING-CMAKE-SCRIPTS file.
+
+
+if (WIN32)
+  include(FindLibraryWithDebug)
+
+  if (NOT KDEWIN32_DIR)
+    if(NOT KDEWIN_FOUND)
+      find_package(KDEWIN)
+    endif(NOT KDEWIN_FOUND)
+
+    find_path(KDEWIN32_INCLUDE_DIR winposix_export.h
+      ${CMAKE_INCLUDE_PATH}
+      ${CMAKE_INSTALL_PREFIX}/include
+    )
+ 
+    # search for kdewin32 in the default install directory for applications (default of (n)make install)
+    FILE(TO_CMAKE_PATH "${CMAKE_LIBRARY_PATH}" _cmakeLibraryPathCmakeStyle)
+    find_library_with_debug(KDEWIN32_LIBRARY
+      WIN32_DEBUG_POSTFIX d
+      NAMES kdewin32
+      PATHS 
+        ${_cmakeLibraryPathCmakeStyle}
+        ${CMAKE_INSTALL_PREFIX}/lib
+      NO_SYSTEM_ENVIRONMENT_PATH
+    )
+
+    # kdelibs/win/ has to be built before the rest of kdelibs/
+    # eventually it will be moved out from kdelibs/
+    if (KDEWIN32_LIBRARY AND KDEWIN32_INCLUDE_DIR)
+      set(KDEWIN32_FOUND TRUE)
+      # add needed system libs
+      set(KDEWIN32_LIBRARIES ${KDEWIN32_LIBRARY} user32 shell32 ws2_32 netapi32 userenv)
+  
+      if (MINGW)
+        #mingw compiler
+        set(KDEWIN32_INCLUDES ${KDEWIN32_INCLUDE_DIR} ${KDEWIN32_INCLUDE_DIR}/mingw ${QT_INCLUDES})
+      else (MINGW)
+        # msvc compiler
+        # add the MS SDK include directory if available
+        file(TO_CMAKE_PATH "$ENV{MSSDK}" MSSDK_DIR)
+        set(KDEWIN32_INCLUDES ${KDEWIN32_INCLUDE_DIR} ${KDEWIN32_INCLUDE_DIR}/msvc  ${QT_INCLUDES} ${MSSDK_DIR})
+      endif (MINGW)
+  
+    endif (KDEWIN32_LIBRARY AND KDEWIN32_INCLUDE_DIR)
+    # required for configure
+    set(CMAKE_REQUIRED_INCLUDES ${CMAKE_REQUIRED_INCLUDES} ${KDEWIN32_INCLUDES})
+    set(CMAKE_REQUIRED_LIBRARIES ${CMAKE_REQUIRED_LIBRARIES} ${KDEWIN32_LIBRARIES})      
+
+  endif (NOT KDEWIN32_DIR)
+
+  if (KDEWIN32_FOUND)
+    if (NOT KDEWIN32_FIND_QUIETLY)
+      message(STATUS "Found kdewin32 library: ${KDEWIN32_LIBRARY}")
+    endif (NOT KDEWIN32_FIND_QUIETLY)
+
+  else (KDEWIN32_FOUND)
+    if (KDEWIN32_FIND_REQUIRED)
+      message(FATAL_ERROR "Could NOT find KDEWIN32 library\nPlease install it first")
+    endif (KDEWIN32_FIND_REQUIRED)
+  endif (KDEWIN32_FOUND)
+endif (WIN32)
diff -N -r -u poppler-0.6.4-orig/cmake/modules/FindLibraryWithDebug.cmake poppler-0.6.4/cmake/modules/FindLibraryWithDebug.cmake
--- poppler-0.6.4-orig/cmake/modules/FindLibraryWithDebug.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/FindLibraryWithDebug.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,113 @@
+#
+#  FIND_LIBRARY_WITH_DEBUG
+#  -> enhanced FIND_LIBRARY to allow the search for an
+#     optional debug library with a WIN32_DEBUG_POSTFIX similar
+#     to CMAKE_DEBUG_POSTFIX when creating a shared lib
+#     it has to be the second and third argument
+
+# Copyright (c) 2007, Christian Ehrlicher, <ch.ehrlicher@gmx.de>
+# Redistribution and use is allowed according to the terms of the BSD license.
+# For details see the accompanying COPYING-CMAKE-SCRIPTS file.
+
+MACRO(FIND_LIBRARY_WITH_DEBUG var_name win32_dbg_postfix_name dgb_postfix libname)
+
+  IF(NOT "${win32_dbg_postfix_name}" STREQUAL "WIN32_DEBUG_POSTFIX")
+
+     # no WIN32_DEBUG_POSTFIX -> simply pass all arguments to FIND_LIBRARY
+     FIND_LIBRARY(${var_name}
+                  ${win32_dbg_postfix_name}
+                  ${dgb_postfix}
+                  ${libname}
+                  ${ARGN}
+     )
+
+  ELSE(NOT "${win32_dbg_postfix_name}" STREQUAL "WIN32_DEBUG_POSTFIX")
+
+    IF(NOT WIN32)
+      # on non-win32 we don't need to take care about WIN32_DEBUG_POSTFIX
+
+      FIND_LIBRARY(${var_name} ${libname} ${ARGN})
+
+    ELSE(NOT WIN32)
+
+      # 1. get all possible libnames
+      SET(args ${ARGN})
+      SET(newargs "")
+      SET(libnames_release "")
+      SET(libnames_debug "")
+
+      LIST(LENGTH args listCount)
+
+      IF("${libname}" STREQUAL "NAMES")
+        SET(append_rest 0)
+        LIST(APPEND args " ")
+
+        FOREACH(i RANGE ${listCount})
+          LIST(GET args ${i} val)
+
+          IF(append_rest)
+            LIST(APPEND newargs ${val})
+          ELSE(append_rest)
+            IF("${val}" STREQUAL "PATHS")
+              LIST(APPEND newargs ${val})
+              SET(append_rest 1)
+            ELSE("${val}" STREQUAL "PATHS")
+              LIST(APPEND libnames_release "${val}")
+              LIST(APPEND libnames_debug   "${val}${dgb_postfix}")
+            ENDIF("${val}" STREQUAL "PATHS")
+          ENDIF(append_rest)
+
+        ENDFOREACH(i)
+
+      ELSE("${libname}" STREQUAL "NAMES")
+
+        # just one name
+        LIST(APPEND libnames_release "${libname}")
+        LIST(APPEND libnames_debug   "${libname}${dgb_postfix}")
+
+        SET(newargs ${args})
+
+      ENDIF("${libname}" STREQUAL "NAMES")
+
+      # search the release lib
+      FIND_LIBRARY(${var_name}_RELEASE
+                   NAMES ${libnames_release}
+                   ${newargs}
+      )
+
+      # search the debug lib
+      FIND_LIBRARY(${var_name}_DEBUG
+                   NAMES ${libnames_debug}
+                   ${newargs}
+      )
+
+      IF(${var_name}_RELEASE AND ${var_name}_DEBUG)
+
+        # both libs found
+        SET(${var_name} optimized ${${var_name}_RELEASE}
+                        debug     ${${var_name}_DEBUG})
+
+      ELSE(${var_name}_RELEASE AND ${var_name}_DEBUG)
+
+        IF(${var_name}_RELEASE)
+
+          # only release found
+          SET(${var_name} ${${var_name}_RELEASE})
+
+        ELSE(${var_name}_RELEASE)
+
+          # only debug (or nothing) found
+          SET(${var_name} ${${var_name}_DEBUG})
+
+        ENDIF(${var_name}_RELEASE)
+       
+      ENDIF(${var_name}_RELEASE AND ${var_name}_DEBUG)
+
+      MARK_AS_ADVANCED(${var_name}_RELEASE)
+      MARK_AS_ADVANCED(${var_name}_DEBUG)
+
+    ENDIF(NOT WIN32)
+
+  ENDIF(NOT "${win32_dbg_postfix_name}" STREQUAL "WIN32_DEBUG_POSTFIX")
+
+ENDMACRO(FIND_LIBRARY_WITH_DEBUG)
diff -N -r -u poppler-0.6.4-orig/cmake/modules/FindPackageHandleStandardArgs.cmake poppler-0.6.4/cmake/modules/FindPackageHandleStandardArgs.cmake
--- poppler-0.6.4-orig/cmake/modules/FindPackageHandleStandardArgs.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/FindPackageHandleStandardArgs.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,58 @@
+# FIND_PACKAGE_HANDLE_STANDARD_ARGS(NAME (DEFAULT_MSG|"Custom failure message") VAR1 ... )
+#    This macro is intended to be used in FindXXX.cmake modules files.
+#    It handles the REQUIRED and QUIET argument to FIND_PACKAGE() and
+#    it also sets the <UPPERCASED_NAME>_FOUND variable.
+#    The package is found if all variables listed are TRUE.
+#    Example:
+#
+#    FIND_PACKAGE_HANDLE_STANDARD_ARGS(LibXml2 DEFAULT_MSG LIBXML2_LIBRARIES LIBXML2_INCLUDE_DIR)
+#
+#    LibXml2 is considered to be found, if both LIBXML2_LIBRARIES and 
+#    LIBXML2_INCLUDE_DIR are valid. Then also LIBXML2_FOUND is set to TRUE.
+#    If it is not found and REQUIRED was used, it fails with FATAL_ERROR, 
+#    independent whether QUIET was used or not.
+#    If it is found, the location is reported using the VAR1 argument, so 
+#    here a message "Found LibXml2: /usr/lib/libxml2.so" will be printed out.
+#    If the second argument is DEFAULT_MSG, the message in the failure case will 
+#    be "Could NOT find LibXml2", if you don't like this message you can specify
+#    your own custom failure message there.
+
+MACRO(FIND_PACKAGE_HANDLE_STANDARD_ARGS _NAME _FAIL_MSG _VAR1 )
+
+  IF("${_FAIL_MSG}" STREQUAL "DEFAULT_MSG")
+    IF (${_NAME}_FIND_REQUIRED)
+      SET(_FAIL_MESSAGE "Could not find REQUIRED package ${_NAME}")
+    ELSE (${_NAME}_FIND_REQUIRED)
+      SET(_FAIL_MESSAGE "Could not find OPTIONAL package ${_NAME}")
+    ENDIF (${_NAME}_FIND_REQUIRED)
+  ELSE("${_FAIL_MSG}" STREQUAL "DEFAULT_MSG")
+    SET(_FAIL_MESSAGE "${_FAIL_MSG}")
+  ENDIF("${_FAIL_MSG}" STREQUAL "DEFAULT_MSG")
+
+  STRING(TOUPPER ${_NAME} _NAME_UPPER)
+
+  SET(${_NAME_UPPER}_FOUND TRUE)
+  IF(NOT ${_VAR1})
+    SET(${_NAME_UPPER}_FOUND FALSE)
+  ENDIF(NOT ${_VAR1})
+
+  FOREACH(_CURRENT_VAR ${ARGN})
+    IF(NOT ${_CURRENT_VAR})
+      SET(${_NAME_UPPER}_FOUND FALSE)
+    ENDIF(NOT ${_CURRENT_VAR})
+  ENDFOREACH(_CURRENT_VAR)
+
+  IF (${_NAME_UPPER}_FOUND)
+    IF (NOT ${_NAME}_FIND_QUIETLY)
+        MESSAGE(STATUS "Found ${_NAME}: ${${_VAR1}}")
+    ENDIF (NOT ${_NAME}_FIND_QUIETLY)
+  ELSE (${_NAME_UPPER}_FOUND)
+    IF (${_NAME}_FIND_REQUIRED)
+        MESSAGE(FATAL_ERROR "${_FAIL_MESSAGE}")
+    ELSE (${_NAME}_FIND_REQUIRED)
+      IF (NOT ${_NAME}_FIND_QUIETLY)
+        MESSAGE(STATUS "${_FAIL_MESSAGE}")
+      ENDIF (NOT ${_NAME}_FIND_QUIETLY)
+    ENDIF (${_NAME}_FIND_REQUIRED)
+  ENDIF (${_NAME_UPPER}_FOUND)
+ENDMACRO(FIND_PACKAGE_HANDLE_STANDARD_ARGS)
diff -N -r -u poppler-0.6.4-orig/cmake/modules/FindQt3.cmake poppler-0.6.4/cmake/modules/FindQt3.cmake
--- poppler-0.6.4-orig/cmake/modules/FindQt3.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/FindQt3.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,319 @@
+# - Locate Qt include paths and libraries
+# This module defines:
+#  QT3_INCLUDE_DIR - where to find qt.h, etc.
+#  QT3_LIBRARIES   - the libraries to link against to use Qt.
+#  QT3_DEFINITIONS - definitions to use when 
+#                   compiling code that uses Qt.
+#  QT3_FOUND       - If false, don't try to use Qt.
+#
+# If you need the multithreaded version of Qt, set QT_MT_REQUIRED to TRUE
+#
+# Also defined, but not for general use are:
+#  QT3_MOC_EXECUTABLE, where to find the moc tool.
+#  QT3_UIC_EXECUTABLE, where to find the uic tool.
+#  QT3_QT_LIBRARY, where to find the Qt library.
+#  QT3_QTMAIN_LIBRARY, where to find the qtmain 
+#   library. This is only required by Qt3 on Windows.
+
+# These are around for backwards compatibility 
+# they will be set
+#  QT_WRAP_CPP, set true if QT3_MOC_EXECUTABLE is found
+#  QT_WRAP_UI set true if QT3_UIC_EXECUTABLE is found
+
+FILE(GLOB GLOB_PATHS_BIN /usr/lib/qt-3*/bin/)
+FIND_PATH(QT3_INCLUDE_DIR qt.h
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.1;InstallDir]/include/Qt"
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.0;InstallDir]/include/Qt"
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.1.0;InstallDir]/include/Qt"
+  $ENV{QTDIR}/include
+  ${GLOB_PATHS_BIN}
+  /usr/local/qt/include
+  /usr/lib/qt/include
+  /usr/lib/qt3/include
+  /usr/include/qt
+  /usr/share/qt3/include
+  C:/Progra~1/qt/include
+  /usr/include/qt3
+  /usr/X11R6/include
+  )
+
+# if qglobal.h is not in the qt_include_dir then set
+# QT3_INCLUDE_DIR to NOTFOUND
+IF(NOT EXISTS ${QT3_INCLUDE_DIR}/qglobal.h)
+  SET(QT3_INCLUDE_DIR QT3_INCLUDE_DIR-NOTFOUND CACHE PATH "path to qt3 include directory" FORCE)
+ENDIF(NOT EXISTS ${QT3_INCLUDE_DIR}/qglobal.h)
+
+IF(QT3_INCLUDE_DIR)
+  #extract the version string from qglobal.h
+  FILE(READ ${QT3_INCLUDE_DIR}/qglobal.h QGLOBAL_H)
+  STRING(REGEX MATCH "#define[\t ]+QT_VERSION_STR[\t ]+\"([0-9]+.[0-9]+.[0-9]+)\"" QGLOBAL_H "${QGLOBAL_H}")
+  STRING(REGEX REPLACE ".*\"([0-9]+.[0-9]+.[0-9]+)\".*" "\\1" qt_version_str "${QGLOBAL_H}")
+
+  # Under windows the qt library (MSVC) has the format qt-mtXYZ where XYZ is the
+  # version X.Y.Z, so we need to remove the dots from version
+  STRING(REGEX REPLACE "\\." "" qt_version_str_lib "${qt_version_str}")
+ELSE(QT3_INCLUDE_DIR)
+ENDIF(QT3_INCLUDE_DIR)
+
+FILE(GLOB GLOB_PATHS_LIB /usr/lib/qt-3*/lib/)
+IF (QT_MT_REQUIRED)
+  FIND_LIBRARY(QT3_QT_LIBRARY
+    NAMES
+    qt-mt qt-mt${qt_version_str_lib} qt-mtnc${qt_version_str_lib}
+    qt-mtedu${qt_version_str_lib} qt-mt230nc qt-mtnc321 qt-mt3
+    PATHS
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.1;InstallDir]/lib"
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.0;InstallDir]/lib"
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.1.0;InstallDir]/lib"
+    $ENV{QTDIR}/lib
+    ${GLOB_PATHS_LIB}
+    /usr/local/qt/lib
+    /usr/lib/qt/lib
+    /usr/lib/qt3/lib
+    /usr/lib/qt3/lib64
+    /usr/share/qt3/lib
+    C:/Progra~1/qt/lib
+    /usr/X11R6/lib
+    )
+
+ELSE (QT_MT_REQUIRED)
+  FIND_LIBRARY(QT3_QT_LIBRARY
+    NAMES 
+    qt qt-${qt_version_str_lib} qt-edu${qt_version_str_lib} 
+    qt-mt qt-mt${qt_version_str_lib} qt-mtnc${qt_version_str_lib}
+    qt-mtedu${qt_version_str_lib} qt-mt230nc qt-mtnc321 qt-mt3
+    PATHS
+    "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.1;InstallDir]/lib"
+    "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.0;InstallDir]/lib"
+    "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.1.0;InstallDir]/lib"
+    $ENV{QTDIR}/lib
+    ${GLOB_PATHS_LIB}
+    /usr/local/qt/lib
+    /usr/lib/qt/lib
+    /usr/lib/qt3/lib
+    /usr/lib/qt3/lib64
+    /usr/share/qt3/lib
+    C:/Progra~1/qt/lib
+    /usr/X11R6/lib
+    )
+ENDIF (QT_MT_REQUIRED)
+
+IF(QT3_QT_LIBRARY)
+ELSE(QT3_QT_LIBRARY)
+ENDIF(QT3_QT_LIBRARY)
+
+
+FIND_LIBRARY(QT_QASSISTANTCLIENT_LIBRARY
+  NAMES qassistantclient
+  PATHS
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.1;InstallDir]/lib"
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.0;InstallDir]/lib"
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.1.0;InstallDir]/lib"
+  $ENV{QTDIR}/lib
+  ${GLOB_PATHS_LIB}
+  /usr/local/qt/lib
+  /usr/lib/qt3/lib
+  /usr/lib/qt3/lib64
+  /usr/share/qt3/lib
+  C:/Progra~1/qt/lib
+  /usr/X11R6/lib
+  )
+
+# qt 3 should prefer QTDIR over the PATH
+FIND_PROGRAM(QT3_MOC_EXECUTABLE 
+  NAMES moc moc-qt3
+  PATHS 
+  $ENV{QTDIR}/bin 
+  NO_DEFAULT_PATH
+)
+
+FIND_PROGRAM(QT3_MOC_EXECUTABLE 
+  NAMES moc moc-qt3
+  PATHS 
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.1;InstallDir]/include/Qt"
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.0;InstallDir]/include/Qt"
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.1.0;InstallDir]/include/Qt"
+  $ENV{QTDIR}/bin 
+  ${GLOB_PATHS_BIN}
+  /usr/local/qt/bin
+  /usr/lib/qt/bin
+  /usr/lib/qt3/bin
+  /usr/share/qt3/bin
+  C:/Progra~1/qt/bin
+  /usr/X11R6/bin
+  )
+
+IF(QT3_MOC_EXECUTABLE)
+  SET ( QT_WRAP_CPP "YES")
+ELSE(QT3_MOC_EXECUTABLE)
+ENDIF(QT3_MOC_EXECUTABLE)
+
+# qt 3 should prefer QTDIR over the PATH
+FIND_PROGRAM(QT3_UIC_EXECUTABLE uic
+  PATHS 
+  $ENV{QTDIR}/bin 
+  NO_DEFAULT_PATH
+)
+FIND_PROGRAM(QT3_UIC_EXECUTABLE uic
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.1;InstallDir]/include/Qt"
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.0;InstallDir]/include/Qt"
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.1.0;InstallDir]/include/Qt"
+  $ENV{QTDIR}/bin 
+  ${GLOB_PATHS_BIN}
+  /usr/local/qt/bin
+  /usr/lib/qt/bin
+  /usr/lib/qt3/bin
+  /usr/share/qt3/bin
+  C:/Progra~1/qt/bin
+  /usr/X11R6/bin
+  )
+
+IF(QT3_UIC_EXECUTABLE)
+  SET ( QT_WRAP_UI "YES")
+ELSE(QT3_UIC_EXECUTABLE)
+ENDIF(QT3_UIC_EXECUTABLE)
+
+IF (WIN32)
+  FIND_LIBRARY(QT3_QTMAIN_LIBRARY qtmain
+    "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.1;InstallDir]/lib"
+    "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.2.0;InstallDir]/lib"
+    "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\3.1.0;InstallDir]/lib"
+    "$ENV{ProgramFiles}/qt/lib"
+    $ENV{QTDIR}/lib "C:/Program Files/qt/lib"
+    DOC "This Library is only needed by and included with Qt3 on MSWindows. It should be NOTFOUND, undefined or IGNORE otherwise."
+    )
+ENDIF (WIN32)
+
+
+IF (QT3_MIN_VERSION)
+
+  STRING(REGEX REPLACE "([0-9]+)\\.[0-9]+\\.[0-9]+" "\\1" qt_major_vers "${qt_version_str}")
+  STRING(REGEX REPLACE "[0-9]+\\.([0-9]+)\\.[0-9]+" "\\1" qt_minor_vers "${qt_version_str}")
+  STRING(REGEX REPLACE "[0-9]+\\.[0-9]+\\.([0-9]+)" "\\1" qt_patch_vers "${qt_version_str}")
+  
+  #now parse the parts of the user given version string into variables 
+  STRING(REGEX MATCH "^[0-9]+\\.[0-9]+\\.[0-9]+$" req_qt_major_vers "${QT3_MIN_VERSION}")
+  IF (NOT req_qt_major_vers)
+    MESSAGE( FATAL_ERROR "Invalid Qt version string given: \"${QT3_MIN_VERSION}\", expected e.g. \"3.1.5\"")
+  ENDIF (NOT req_qt_major_vers)
+  
+  STRING(REGEX REPLACE "([0-9]+)\\.[0-9]+\\.[0-9]+" "\\1" req_qt_major_vers "${QT3_MIN_VERSION}")
+  STRING(REGEX REPLACE "[0-9]+\\.([0-9])+\\.[0-9]+" "\\1" req_qt_minor_vers "${QT3_MIN_VERSION}")
+  STRING(REGEX REPLACE "[0-9]+\\.[0-9]+\\.([0-9]+)" "\\1" req_qt_patch_vers "${QT3_MIN_VERSION}")
+  
+  # req = "6.5.4", qt = "3.2.1"
+  
+  IF (req_qt_major_vers GREATER qt_major_vers)                  # (6 > 3) ?
+    MESSAGE(  FATAL_ERROR "Qt major version not matched (required: ${QT3_MIN_VERSION}, found: ${qt_version_str})")            # yes
+  ELSE  (req_qt_major_vers GREATER qt_major_vers)               # no
+    IF (req_qt_major_vers LESS qt_major_vers)                  # (6 < 3) ?
+      SET( QT_VERSION_BIG_ENOUGH "YES" )                      # yes
+    ELSE (req_qt_major_vers LESS qt_major_vers)                # ( 6==3) ?
+      IF (req_qt_minor_vers GREATER qt_minor_vers)            # (5>2) ?
+        MESSAGE(  FATAL_ERROR "Qt minor version not matched (required: ${QT3_MIN_VERSION}, found: ${qt_version_str})")      # yes
+      ELSE (req_qt_minor_vers GREATER qt_minor_vers)          # no
+        IF (req_qt_minor_vers LESS qt_minor_vers)            # (5<2) ?
+          SET( QT_VERSION_BIG_ENOUGH "YES" )                # yes
+        ELSE (req_qt_minor_vers LESS qt_minor_vers)          # (5==2)
+          IF (req_qt_patch_vers GREATER qt_patch_vers)      # (4>1) ?
+            MESSAGE( FATAL_ERROR "Qt patch level not matched (required: ${QT3_MIN_VERSION}, found: ${qt_version_str})")  # yes
+          ELSE (req_qt_patch_vers GREATER qt_patch_vers)    # (4>1) ?
+            SET( QT_VERSION_BIG_ENOUGH "YES" )             # yes
+          ENDIF (req_qt_patch_vers GREATER qt_patch_vers)   # (4>1) ?
+        ENDIF (req_qt_minor_vers LESS qt_minor_vers)
+      ENDIF (req_qt_minor_vers GREATER qt_minor_vers)
+    ENDIF (req_qt_major_vers LESS qt_major_vers)
+  ENDIF (req_qt_major_vers GREATER qt_major_vers)
+ENDIF (QT3_MIN_VERSION)
+
+# if the include a library are found then we have it
+IF(QT3_INCLUDE_DIR)
+  IF(QT3_QT_LIBRARY)
+    SET( QT3_FOUND "YES" )
+  ENDIF(QT3_QT_LIBRARY)
+ENDIF(QT3_INCLUDE_DIR)
+
+IF(QT3_FOUND)
+  SET( QT3_LIBRARIES ${QT3_LIBRARIES} ${QT3_QT_LIBRARY} )
+  SET( QT3_DEFINITIONS "")
+  
+  IF (WIN32 AND NOT CYGWIN)
+    IF (QT3_QTMAIN_LIBRARY)
+      # for version 3
+      SET (QT3_DEFINITIONS -DQT_DLL -DQT_THREAD_SUPPORT -DNO_DEBUG)
+      SET (QT3_LIBRARIES imm32.lib ${QT3_QT_LIBRARY} ${QT3_QTMAIN_LIBRARY} )
+      SET (QT3_LIBRARIES ${QT3_LIBRARIES} winmm wsock32)
+    ELSE (QT3_QTMAIN_LIBRARY)
+      # for version 2
+      SET (QT3_LIBRARIES imm32.lib ws2_32.lib ${QT3_QT_LIBRARY} )
+    ENDIF (QT3_QTMAIN_LIBRARY)
+  ELSE (WIN32 AND NOT CYGWIN)
+    SET (QT3_LIBRARIES ${QT3_QT_LIBRARY} )
+    
+    SET (QT3_DEFINITIONS -DQT_SHARED -DQT_NO_DEBUG)
+    IF(QT3_QT_LIBRARY MATCHES "qt-mt")
+      SET (QT3_DEFINITIONS ${QT3_DEFINITIONS} -DQT_THREAD_SUPPORT -D_REENTRANT)
+    ENDIF(QT3_QT_LIBRARY MATCHES "qt-mt")
+    
+  ENDIF (WIN32 AND NOT CYGWIN)
+  
+  IF (QT_QASSISTANTCLIENT_LIBRARY)
+    SET (QT3_LIBRARIES ${QT_QASSISTANTCLIENT_LIBRARY} ${QT3_LIBRARIES})
+  ENDIF (QT_QASSISTANTCLIENT_LIBRARY)
+  
+  # Backwards compatibility for CMake1.4 and 1.2
+  SET (QT_MOC_EXE ${QT3_MOC_EXECUTABLE} )
+  SET (QT_UIC_EXE ${QT3_UIC_EXECUTABLE} )
+  # for unix add X11 stuff
+  IF(UNIX)
+    FIND_PACKAGE(X11)
+    IF (X11_FOUND)
+      SET (QT3_LIBRARIES ${QT3_LIBRARIES} ${X11_LIBRARIES})
+    ENDIF (X11_FOUND)
+    IF (CMAKE_DL_LIBS)
+      SET (QT3_LIBRARIES ${QT3_LIBRARIES} ${CMAKE_DL_LIBS})
+    ENDIF (CMAKE_DL_LIBS)
+  ENDIF(UNIX)
+  IF(QT3_QT_LIBRARY MATCHES "qt-mt")
+    FIND_PACKAGE(Threads)
+    SET(QT3_LIBRARIES ${QT3_LIBRARIES} ${CMAKE_THREAD_LIBS_INIT})
+  ENDIF(QT3_QT_LIBRARY MATCHES "qt-mt")
+ENDIF(QT3_FOUND)
+
+EXEC_PROGRAM(${QT3_MOC_EXECUTABLE} ARGS "-v" OUTPUT_VARIABLE QTVERSION_MOC)
+EXEC_PROGRAM(${QT3_UIC_EXECUTABLE} ARGS "-version" OUTPUT_VARIABLE QTVERSION_UI)
+
+SET(_QT_UIC_VERSION_3 FALSE)
+IF("${QTVERSION_UIC}" MATCHES ".* 3..*")
+  SET(_QT_UIC_VERSION_3 TRUE)
+ENDIF("${QTVERSION_UIC}" MATCHES ".* 3..*")
+
+SET(_QT_MOC_VERSION_3 FALSE)
+IF("${QTVERSION_MOC}" MATCHES ".* 3..*")
+  SET(_QT_MOC_VERSION_3 TRUE)
+ENDIF("${QTVERSION_MOC}" MATCHES ".* 3..*")
+
+SET(QT_WRAP_CPP FALSE)
+IF (QT3_MOC_EXECUTABLE)   
+  IF(_QT_MOC_VERSION_3)
+    SET ( QT_WRAP_CPP TRUE)
+  ENDIF(_QT_MOC_VERSION_3)
+ENDIF (QT3_MOC_EXECUTABLE)   
+
+SET(QT_WRAP_UI FALSE)
+IF (QT3_UIC_EXECUTABLE)   
+  IF(_QT_UIC_VERSION_3)
+    SET ( QT_WRAP_UI TRUE)
+  ENDIF(_QT_UIC_VERSION_3)
+ENDIF (QT3_UIC_EXECUTABLE)   
+
+MARK_AS_ADVANCED(
+  QT3_INCLUDE_DIR
+  QT3_QT_LIBRARY
+  QT3_QTMAIN_LIBRARY
+  QT_QASSISTANTCLIENT_LIBRARY
+  QT3_UIC_EXECUTABLE
+  QT3_MOC_EXECUTABLE
+  QT_WRAP_CPP
+  QT_WRAP_UI
+  ) 
diff -N -r -u poppler-0.6.4-orig/cmake/modules/FindQt4.cmake poppler-0.6.4/cmake/modules/FindQt4.cmake
--- poppler-0.6.4-orig/cmake/modules/FindQt4.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/FindQt4.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,1258 @@
+# - Find QT 4
+# This module can be used to find Qt4.
+# The most important issue is that the Qt4 qmake is available via the system path.
+# This qmake is then used to detect basically everything else.
+# This module defines a number of key variables and macros. First is 
+# QT_USE_FILE which is the path to a CMake file that can be included to compile
+# Qt 4 applications and libraries.  By default, the QtCore and QtGui 
+# libraries are loaded. This behavior can be changed by setting one or more 
+# of the following variables to true:
+#                    QT_DONT_USE_QTCORE
+#                    QT_DONT_USE_QTGUI
+#                    QT_USE_QT3SUPPORT
+#                    QT_USE_QTASSISTANT
+#                    QT_USE_QTDESIGNER
+#                    QT_USE_QTMOTIF
+#                    QT_USE_QTMAIN
+#                    QT_USE_QTNETWORK
+#                    QT_USE_QTNSPLUGIN
+#                    QT_USE_QTOPENGL
+#                    QT_USE_QTSQL
+#                    QT_USE_QTXML
+#                    QT_USE_QTSVG
+#                    QT_USE_QTTEST
+#                    QT_USE_QTUITOOLS
+#                    QT_USE_QTDBUS
+#                    QT_USE_QTSCRIPT
+#
+# All the libraries required are stored in a variable called QT_LIBRARIES.  
+# Add this variable to your TARGET_LINK_LIBRARIES.
+#  
+#  macro QT4_WRAP_CPP(outfiles inputfile ... )
+#  macro QT4_WRAP_UI(outfiles inputfile ... )
+#  macro QT4_ADD_RESOURCES(outfiles inputfile ... )
+#  macro QT4_AUTOMOC(inputfile ... )
+#  macro QT4_GENERATE_MOC(inputfile outputfile )
+#
+#  macro QT4_ADD_DBUS_INTERFACE(outfiles interface basename)
+#        create a the interface header and implementation files with the 
+#        given basename from the given interface xml file and add it to 
+#        the list of sources.
+#        To disable generating a namespace header, set the source file property 
+#        NO_NAMESPACE to TRUE on the interface file.
+#
+#  macro QT4_ADD_DBUS_INTERFACES(outfiles inputfile ... )
+#        create the interface header and implementation files 
+#        for all listed interface xml files
+#        the name will be automatically determined from the name of the xml file
+#        To disable generating namespace headers, set the source file property 
+#        NO_NAMESPACE to TRUE for these inputfiles.
+#
+#  macro QT4_ADD_DBUS_ADAPTOR(outfiles xmlfile parentheader parentclassname [basename] [classname])
+#        create a dbus adaptor (header and implementation file) from the xml file
+#        describing the interface, and add it to the list of sources. The adaptor
+#        forwards the calls to a parent class, defined in parentheader and named
+#        parentclassname. The name of the generated files will be
+#        <basename>adaptor.{cpp,h} where basename defaults to the basename of the xml file.
+#        If <classname> is provided, then it will be used as the classname of the
+#        adaptor itself.
+#
+#  macro QT4_GENERATE_DBUS_INTERFACE( header [interfacename] )
+#        generate the xml interface file from the given header.
+#        If the optional argument interfacename is omitted, the name of the 
+#        interface file is constructed from the basename of the header with
+#        the suffix .xml appended.
+#
+#  QT_FOUND         If false, don't try to use Qt.
+#  QT4_FOUND        If false, don't try to use Qt 4.
+#
+#  QT4_QTCORE_FOUND        True if QtCore was found.
+#  QT4_QTGUI_FOUND         True if QtGui was found.
+#  QT4_QT3SUPPORT_FOUND    True if Qt3Support was found.
+#  QT4_QTASSISTANT_FOUND   True if QtAssistant was found.
+#  QT4_QTDBUS_FOUND        True if QtDBus was found.
+#  QT4_QTDESIGNER_FOUND    True if QtDesigner was found.
+#  QT4_QTDESIGNERCOMPONENTS True if QtDesignerComponents was found.
+#  QT4_QTMOTIF_FOUND       True if QtMotif was found.
+#  QT4_QTNETWORK_FOUND     True if QtNetwork was found.
+#  QT4_QTNSPLUGIN_FOUND    True if QtNsPlugin was found.
+#  QT4_QTOPENGL_FOUND      True if QtOpenGL was found.
+#  QT4_QTSQL_FOUND         True if QtSql was found.
+#  QT4_QTXML_FOUND         True if QtXml was found.
+#  QT4_QTSVG_FOUND         True if QtSvg was found.
+#  QT4_QTSCRIPT_FOUND      True if QtScript was found.
+#  QT4_QTTEST_FOUND        True if QtTest was found.
+#  QT4_QTUITOOLS_FOUND     True if QtUiTools was found.
+#                      
+#  QT4_DEFINITIONS   Definitions to use when compiling code that uses Qt.
+#                  
+#  QT4_INCLUDES      List of paths to all include directories of 
+#                   Qt4 QT4_INCLUDE_DIR and QT4_QTCORE_INCLUDE_DIR are
+#                   always in this variable even if NOTFOUND,
+#                   all other INCLUDE_DIRS are
+#                   only added if they are found.
+#   
+#  QT4_INCLUDE_DIR              Path to "include" of Qt4
+#  QT4_QT4_INCLUDE_DIR           Path to "include/Qt" 
+#  QT4_QT3SUPPORT_INCLUDE_DIR   Path to "include/Qt3Support" 
+#  QT4_QTASSISTANT_INCLUDE_DIR  Path to "include/QtAssistant" 
+#  QT4_QTCORE_INCLUDE_DIR       Path to "include/QtCore"         
+#  QT4_QTDESIGNER_INCLUDE_DIR   Path to "include/QtDesigner" 
+#  QT4_QTDESIGNERCOMPONENTS_INCLUDE_DIR   Path to "include/QtDesigner"
+#  QT4_QTDBUS_INCLUDE_DIR       Path to "include/QtDBus" 
+#  QT4_QTGUI_INCLUDE_DIR        Path to "include/QtGui" 
+#  QT4_QTMOTIF_INCLUDE_DIR      Path to "include/QtMotif" 
+#  QT4_QTNETWORK_INCLUDE_DIR    Path to "include/QtNetwork" 
+#  QT4_QTNSPLUGIN_INCLUDE_DIR   Path to "include/QtNsPlugin" 
+#  QT4_QTOPENGL_INCLUDE_DIR     Path to "include/QtOpenGL" 
+#  QT4_QTSQL_INCLUDE_DIR        Path to "include/QtSql" 
+#  QT4_QTXML_INCLUDE_DIR        Path to "include/QtXml" 
+#  QT4_QTSVG_INCLUDE_DIR        Path to "include/QtSvg"
+#  QT4_QTSCRIPT_INCLUDE_DIR     Path to "include/QtScript"
+#  QT4_QTTEST_INCLUDE_DIR       Path to "include/QtTest"
+#                            
+#  QT4_LIBRARY_DIR              Path to "lib" of Qt4
+# 
+#  QT4_PLUGINS_DIR              Path to "plugins" for Qt4
+#                            
+# For every library of Qt, a QT4_QTFOO_LIBRARY variable is defined, with the full path to the library.
+#
+# So there are the following variables:
+# The Qt3Support library:     QT4_QT3SUPPORT_LIBRARY
+#
+# The QtAssistant library:    QT4_QTASSISTANT_LIBRARY
+#
+# The QtCore library:         QT4_QTCORE_LIBRARY
+#
+# The QtDBus library:         QT4_QTDBUS_LIBRARY
+#
+# The QtDesigner library:     QT4_QTDESIGNER_LIBRARY
+#
+# The QtDesignerComponents library:     QT4_QTDESIGNERCOMPONENTS_LIBRARY
+#
+# The QtGui library:          QT4_QTGUI_LIBRARY
+#
+# The QtMotif library:        QT4_QTMOTIF_LIBRARY
+#
+# The QtNetwork library:      QT4_QTNETWORK_LIBRARY
+#
+# The QtNsPLugin library:     QT4_QTNSPLUGIN_LIBRARY
+#
+# The QtOpenGL library:       QT4_QTOPENGL_LIBRARY
+#
+# The QtSql library:          QT4_QTSQL_LIBRARY
+#
+# The QtXml library:          QT4_QTXML_LIBRARY
+#
+# The QtSvg library:          QT4_QTSVG_LIBRARY
+#
+# The QtScript library:       QT4_QTSCRIPT_LIBRARY
+#
+# The QtTest library:         QT4_QTTEST_LIBRARY
+#
+# The qtmain library for Windows QT4_QTMAIN_LIBRARY
+#
+# The QtUiTools library:      QT4_QTUITOOLS_LIBRARY
+#  
+# also defined, but NOT for general use are
+#  QT4_MOC_EXECUTABLE          Where to find the moc tool.
+#  QT4_UIC_EXECUTABLE          Where to find the uic tool.
+#  QT_UIC3_EXECUTABLE         Where to find the uic3 tool.
+#  QT_RCC_EXECUTABLE          Where to find the rcc tool
+#  QT_DBUSCPP2XML_EXECUTABLE  Where to find the qdbuscpp2xml tool.
+#  QT_DBUSXML2CPP_EXECUTABLE  Where to find the qdbusxml2cpp tool.
+#  
+#  QT_DOC_DIR                 Path to "doc" of Qt4
+#  QT_MKSPECS_DIR             Path to "mkspecs" of Qt4
+#
+#
+# These are around for backwards compatibility 
+# they will be set
+#  QT_WRAP_CPP  Set true if QT4_MOC_EXECUTABLE is found
+#  QT_WRAP_UI   Set true if QT4_UIC_EXECUTABLE is found
+#  
+# These variables do _NOT_ have any effect anymore (compared to FindQt.cmake)
+#  QT_MT_REQUIRED         Qt4 is now always multithreaded
+#  
+# These variables are set to "" Because Qt structure changed 
+# (They make no sense in Qt4)
+#  QT4_QT_LIBRARY        Qt-Library is now split
+
+# Copyright (c) 2002 Kitware, Inc., Insight Consortium.  All rights reserved.
+# See Copyright.txt or http://www.cmake.org/HTML/Copyright.html for details.
+
+if (QT4_QMAKE_FOUND)
+   # Check already done in this cmake run, nothing more to do
+
+else (QT4_QMAKE_FOUND)
+
+INCLUDE(CheckSymbolExists)
+INCLUDE(MacroAddFileDependencies)
+INCLUDE(MacroPushRequiredVars)
+
+SET(QT_USE_FILE ${CMAKE_ROOT}/Modules/UseQt4.cmake)
+
+SET( QT4_DEFINITIONS "")
+
+IF (WIN32)
+  SET(QT4_DEFINITIONS -DQT_DLL)
+ENDIF(WIN32)
+
+SET(QT4_INSTALLED_VERSION_TOO_OLD FALSE)
+
+#  macro for asking qmake to process pro files
+MACRO(QT_QUERY_QMAKE outvar invar)
+  FILE(WRITE ${CMAKE_CURRENT_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmpQmake/tmp.pro
+    "message(CMAKE_MESSAGE<$$${invar}>)")
+
+  # Invoke qmake with the tmp.pro program to get the desired
+  # information.  Use the same variable for both stdout and stderr
+  # to make sure we get the output on all platforms.
+  EXECUTE_PROCESS(COMMAND ${QT_QMAKE_EXECUTABLE}
+    WORKING_DIRECTORY  
+    ${CMAKE_CURRENT_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmpQmake
+    OUTPUT_VARIABLE _qmake_query_output
+    RESULT_VARIABLE _qmake_result
+    ERROR_VARIABLE _qmake_query_output )
+  
+  FILE(REMOVE_RECURSE 
+    "${CMAKE_CURRENT_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmpQmake")
+
+  IF(_qmake_result)
+    MESSAGE(WARNING " querying qmake for ${invar}.  qmake reported:\n${_qmake_query_output}")
+  ELSE(_qmake_result)
+    STRING(REGEX REPLACE ".*CMAKE_MESSAGE<([^>]*).*" "\\1" ${outvar} "${_qmake_query_output}")
+  ENDIF(_qmake_result)
+
+ENDMACRO(QT_QUERY_QMAKE)
+
+# check for qmake
+FIND_PROGRAM(QT_QMAKE_EXECUTABLE NAMES qmake qmake4 qmake-qt4 PATHS
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\4.0.0;InstallDir]/bin"
+  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Versions\\4.0.0;InstallDir]/bin"
+  $ENV{QTDIR}/bin
+)
+
+IF (QT_QMAKE_EXECUTABLE)
+
+  SET(QT4_QMAKE_FOUND FALSE)
+  
+  EXEC_PROGRAM(${QT_QMAKE_EXECUTABLE} ARGS "-query QT_VERSION" OUTPUT_VARIABLE QTVERSION)
+
+  # check for qt3 qmake and then try and find qmake4 or qmake-qt4 in the path
+  IF("${QTVERSION}" MATCHES "Unknown")
+    SET(QT_QMAKE_EXECUTABLE NOTFOUND CACHE FILEPATH "" FORCE)
+    FIND_PROGRAM(QT_QMAKE_EXECUTABLE NAMES qmake4 qmake-qt4 PATHS
+      "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\4.0.0;InstallDir]/bin"
+      "[HKEY_CURRENT_USER\\Software\\Trolltech\\Versions\\4.0.0;InstallDir]/bin"
+      $ENV{QTDIR}/bin
+      )
+    IF(QT_QMAKE_EXECUTABLE)
+      EXEC_PROGRAM(${QT_QMAKE_EXECUTABLE} 
+        ARGS "-query QT_VERSION" OUTPUT_VARIABLE QTVERSION)
+    ENDIF(QT_QMAKE_EXECUTABLE)
+  ENDIF("${QTVERSION}" MATCHES "Unknown")
+
+  # check that we found the Qt4 qmake, Qt3 qmake output won't match here
+  STRING(REGEX MATCH "^[0-9]+\\.[0-9]+\\.[0-9]+" qt_version_tmp "${QTVERSION}")
+  IF (qt_version_tmp)
+
+    # we need at least version 4.0.0
+    IF (NOT QT4_MIN_VERSION)
+      SET(QT4_MIN_VERSION "4.0.0")
+    ENDIF (NOT QT4_MIN_VERSION)
+
+    #now parse the parts of the user given version string into variables
+    STRING(REGEX MATCH "^[0-9]+\\.[0-9]+\\.[0-9]+" req_qt_major_vers "${QT4_MIN_VERSION}")
+    IF (NOT req_qt_major_vers)
+      MESSAGE( FATAL_ERROR "Invalid Qt version string given: \"${QT4_MIN_VERSION}\", expected e.g. \"4.0.1\"")
+    ENDIF (NOT req_qt_major_vers)
+
+    # now parse the parts of the user given version string into variables
+    STRING(REGEX REPLACE "^([0-9]+)\\.[0-9]+\\.[0-9]+" "\\1" req_qt_major_vers "${QT4_MIN_VERSION}")
+    STRING(REGEX REPLACE "^[0-9]+\\.([0-9])+\\.[0-9]+" "\\1" req_qt_minor_vers "${QT4_MIN_VERSION}")
+    STRING(REGEX REPLACE "^[0-9]+\\.[0-9]+\\.([0-9]+)" "\\1" req_qt_patch_vers "${QT4_MIN_VERSION}")
+
+    IF (NOT req_qt_major_vers EQUAL 4)
+      MESSAGE( FATAL_ERROR "Invalid Qt version string given: \"${QT4_MIN_VERSION}\", major version 4 is required, e.g. \"4.0.1\"")
+    ENDIF (NOT req_qt_major_vers EQUAL 4)
+
+    # and now the version string given by qmake
+    STRING(REGEX REPLACE "^([0-9]+)\\.[0-9]+\\.[0-9]+.*" "\\1" found_qt_major_vers "${QTVERSION}")
+    STRING(REGEX REPLACE "^[0-9]+\\.([0-9])+\\.[0-9]+.*" "\\1" found_qt_minor_vers "${QTVERSION}")
+    STRING(REGEX REPLACE "^[0-9]+\\.[0-9]+\\.([0-9]+).*" "\\1" found_qt_patch_vers "${QTVERSION}")
+
+    # compute an overall version number which can be compared at once
+    MATH(EXPR req_vers "${req_qt_major_vers}*10000 + ${req_qt_minor_vers}*100 + ${req_qt_patch_vers}")
+    MATH(EXPR found_vers "${found_qt_major_vers}*10000 + ${found_qt_minor_vers}*100 + ${found_qt_patch_vers}")
+
+    IF (found_vers LESS req_vers)
+      SET(QT4_QMAKE_FOUND FALSE)
+      SET(QT4_INSTALLED_VERSION_TOO_OLD TRUE)
+    ELSE (found_vers LESS req_vers)
+      SET(QT4_QMAKE_FOUND TRUE)
+    ENDIF (found_vers LESS req_vers)
+  ENDIF (qt_version_tmp)
+
+ENDIF (QT_QMAKE_EXECUTABLE)
+
+IF (QT4_QMAKE_FOUND)
+
+  if (WIN32)
+    # get qt install dir 
+    get_filename_component(_DIR ${QT_QMAKE_EXECUTABLE} PATH )
+    get_filename_component(QT_INSTALL_DIR ${_DIR} PATH )
+  endif (WIN32)
+
+  # ask qmake for the library dir
+  # Set QT4_LIBRARY_DIR
+  IF (NOT QT4_LIBRARY_DIR)
+    EXEC_PROGRAM( ${QT_QMAKE_EXECUTABLE}
+      ARGS "-query QT_INSTALL_LIBS"
+      OUTPUT_VARIABLE QT4_LIBRARY_DIR_TMP )
+    IF(EXISTS "${QT4_LIBRARY_DIR_TMP}")
+      SET(QT4_LIBRARY_DIR ${QT4_LIBRARY_DIR_TMP} CACHE PATH "Qt library dir")
+    ELSE(EXISTS "${QT4_LIBRARY_DIR_TMP}")
+      MESSAGE("Warning: QT_QMAKE_EXECUTABLE reported QT_INSTALL_LIBS as ${QT4_LIBRARY_DIR_TMP}")
+      MESSAGE("Warning: ${QT4_LIBRARY_DIR_TMP} does NOT exist, Qt must NOT be installed correctly.")
+    ENDIF(EXISTS "${QT4_LIBRARY_DIR_TMP}")
+  ENDIF(NOT QT4_LIBRARY_DIR)
+  
+  IF (APPLE)
+    IF (EXISTS ${QT4_LIBRARY_DIR}/QtCore.framework)
+      SET(QT_USE_FRAMEWORKS ON
+        CACHE BOOL "Set to ON if Qt build uses frameworks.")
+    ELSE (EXISTS ${QT4_LIBRARY_DIR}/QtCore.framework)
+      SET(QT_USE_FRAMEWORKS OFF
+        CACHE BOOL "Set to ON if Qt build uses frameworks.")
+    ENDIF (EXISTS ${QT4_LIBRARY_DIR}/QtCore.framework)
+    
+    MARK_AS_ADVANCED(QT_USE_FRAMEWORKS)
+  ENDIF (APPLE)
+  
+  # ask qmake for the binary dir
+  IF (NOT QT_BINARY_DIR)
+     EXEC_PROGRAM(${QT_QMAKE_EXECUTABLE}
+        ARGS "-query QT_INSTALL_BINS"
+        OUTPUT_VARIABLE qt_bins )
+     SET(QT_BINARY_DIR ${qt_bins} CACHE INTERNAL "")
+  ENDIF (NOT QT_BINARY_DIR)
+
+  # ask qmake for the include dir
+  IF (NOT QT_HEADERS_DIR)
+      EXEC_PROGRAM( ${QT_QMAKE_EXECUTABLE}
+        ARGS "-query QT_INSTALL_HEADERS" 
+        OUTPUT_VARIABLE qt_headers )
+      SET(QT_HEADERS_DIR ${qt_headers} CACHE INTERNAL "")
+  ENDIF(NOT QT_HEADERS_DIR)
+
+
+  # ask qmake for the documentation directory
+  IF (NOT QT_DOC_DIR)
+    EXEC_PROGRAM( ${QT_QMAKE_EXECUTABLE}
+      ARGS "-query QT_INSTALL_DOCS"
+      OUTPUT_VARIABLE qt_doc_dir )
+    SET(QT_DOC_DIR ${qt_doc_dir} CACHE PATH "The location of the Qt docs")
+  ENDIF (NOT QT_DOC_DIR)
+
+  # ask qmake for the mkspecs directory
+  IF (NOT QT_MKSPECS_DIR)
+    EXEC_PROGRAM( ${QT_QMAKE_EXECUTABLE}
+      ARGS "-query QMAKE_MKSPECS"
+      OUTPUT_VARIABLE qt_mkspecs_dir )
+    SET(QT_MKSPECS_DIR ${qt_mkspecs_dir} CACHE PATH "The location of the Qt mkspecs")
+  ENDIF (NOT QT_MKSPECS_DIR)
+
+  # ask qmake for the plugins directory
+  IF (NOT QT4_PLUGINS_DIR)
+    EXEC_PROGRAM( ${QT_QMAKE_EXECUTABLE}
+      ARGS "-query QT_INSTALL_PLUGINS"
+      OUTPUT_VARIABLE qt_plugins_dir )
+    SET(QT4_PLUGINS_DIR ${qt_plugins_dir} CACHE PATH "The location of the Qt plugins")
+  ENDIF (NOT QT4_PLUGINS_DIR)
+  ########################################
+  #
+  #       Setting the INCLUDE-Variables
+  #
+  ########################################
+
+  FIND_PATH(QT4_QTCORE_INCLUDE_DIR QtGlobal
+    ${QT_HEADERS_DIR}/QtCore
+    ${QT4_LIBRARY_DIR}/QtCore.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_INCLUDE_DIR by removine "/QtCore" in the string ${QT4_QTCORE_INCLUDE_DIR}
+  IF( QT4_QTCORE_INCLUDE_DIR AND NOT QT4_INCLUDE_DIR)
+    IF (QT_USE_FRAMEWORKS)
+      SET(QT4_INCLUDE_DIR ${QT_HEADERS_DIR})
+    ELSE (QT_USE_FRAMEWORKS)
+      STRING( REGEX REPLACE "/QtCore$" "" qt4_include_dir ${QT4_QTCORE_INCLUDE_DIR})
+      SET( QT4_INCLUDE_DIR ${qt4_include_dir} CACHE PATH "")
+    ENDIF (QT_USE_FRAMEWORKS)
+  ENDIF( QT4_QTCORE_INCLUDE_DIR AND NOT QT4_INCLUDE_DIR)
+
+  IF( NOT QT4_INCLUDE_DIR)
+    IF( NOT Qt4_FIND_QUIETLY AND Qt4_FIND_REQUIRED)
+      MESSAGE( FATAL_ERROR "Could NOT find QtGlobal header")
+    ENDIF( NOT Qt4_FIND_QUIETLY AND Qt4_FIND_REQUIRED)
+  ENDIF( NOT QT4_INCLUDE_DIR)
+
+  #############################################
+  #
+  # Find out what window system we're using
+  #
+  #############################################
+  # Save required includes and required_flags variables
+  macro_push_required_vars()
+  # Add QT4_INCLUDE_DIR to CMAKE_REQUIRED_INCLUDES
+  SET(CMAKE_REQUIRED_INCLUDES "${CMAKE_REQUIRED_INCLUDES};${QT4_INCLUDE_DIR}")
+  # On Mac OS X when Qt has framework support, also add the framework path
+  IF( QT_USE_FRAMEWORKS )
+    SET(CMAKE_REQUIRED_FLAGS "-F${QT4_LIBRARY_DIR} ")
+  ENDIF( QT_USE_FRAMEWORKS )
+  # Check for Window system symbols (note: only one should end up being set)
+  CHECK_SYMBOL_EXISTS(Q_WS_X11 "QtCore/qglobal.h" Q_WS_X11)
+  CHECK_SYMBOL_EXISTS(Q_WS_WIN "QtCore/qglobal.h" Q_WS_WIN)
+  CHECK_SYMBOL_EXISTS(Q_WS_QWS "QtCore/qglobal.h" Q_WS_QWS)
+  CHECK_SYMBOL_EXISTS(Q_WS_MAC "QtCore/qglobal.h" Q_WS_MAC)
+
+  IF (QT4_QTCOPY_REQUIRED)
+     CHECK_SYMBOL_EXISTS(QT_IS_QTCOPY "QtCore/qglobal.h" QT_KDE_QT_COPY)
+     IF (NOT QT_IS_QTCOPY)
+        MESSAGE(FATAL_ERROR "qt-copy is required, but hasn't been found")
+     ENDIF (NOT QT_IS_QTCOPY)
+  ENDIF (QT4_QTCOPY_REQUIRED)
+
+  # Restore CMAKE_REQUIRED_INCLUDES+CMAKE_REQUIRED_FLAGS variables
+  macro_pop_required_vars()
+  #
+  #############################################
+
+  IF (QT_USE_FRAMEWORKS)
+    SET(QT4_DEFINITIONS ${QT4_DEFINITIONS} -F${QT4_LIBRARY_DIR} -L${QT4_LIBRARY_DIR} )
+  ENDIF (QT_USE_FRAMEWORKS)
+
+  # Set QT4_QT3SUPPORT_INCLUDE_DIR
+  FIND_PATH(QT4_QT3SUPPORT_INCLUDE_DIR Qt3Support
+    PATHS
+    ${QT4_INCLUDE_DIR}/Qt3Support
+    ${QT4_LIBRARY_DIR}/Qt3Support.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QT4_INCLUDE_DIR
+  FIND_PATH(QT4_QT4_INCLUDE_DIR qglobal.h
+    PATHS
+    ${QT4_INCLUDE_DIR}/Qt
+    ${QT4_LIBRARY_DIR}/QtCore.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QTGUI_INCLUDE_DIR
+  FIND_PATH(QT4_QTGUI_INCLUDE_DIR QtGui
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtGui
+    ${QT4_LIBRARY_DIR}/QtGui.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QTSVG_INCLUDE_DIR
+  FIND_PATH(QT4_QTSVG_INCLUDE_DIR QtSvg
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtSvg
+    ${QT4_LIBRARY_DIR}/QtSvg.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QTSCRIPT_INCLUDE_DIR
+  FIND_PATH(QT4_QTSCRIPT_INCLUDE_DIR QtScript
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtScript
+    ${QT4_LIBRARY_DIR}/QtScript.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QTTEST_INCLUDE_DIR
+  FIND_PATH(QT4_QTTEST_INCLUDE_DIR QtTest
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtTest
+    ${QT4_LIBRARY_DIR}/QtTest.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QTUITOOLS_INCLUDE_DIR
+  FIND_PATH(QT4_QTUITOOLS_INCLUDE_DIR QtUiTools
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtUiTools
+    ${QT4_LIBRARY_DIR}/QtUiTools.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+
+
+  # Set QT4_QTMOTIF_INCLUDE_DIR
+  IF(Q_WS_X11)
+    FIND_PATH(QT4_QTMOTIF_INCLUDE_DIR QtMotif PATHS ${QT4_INCLUDE_DIR}/QtMotif NO_DEFAULT_PATH )
+  ENDIF(Q_WS_X11)
+
+  # Set QT4_QTNETWORK_INCLUDE_DIR
+  FIND_PATH(QT4_QTNETWORK_INCLUDE_DIR QtNetwork
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtNetwork
+    ${QT4_LIBRARY_DIR}/QtNetwork.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QTNSPLUGIN_INCLUDE_DIR
+  FIND_PATH(QT4_QTNSPLUGIN_INCLUDE_DIR QtNsPlugin
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtNsPlugin
+    ${QT4_LIBRARY_DIR}/QtNsPlugin.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QTOPENGL_INCLUDE_DIR
+  FIND_PATH(QT4_QTOPENGL_INCLUDE_DIR QtOpenGL
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtOpenGL
+    ${QT4_LIBRARY_DIR}/QtOpenGL.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QTSQL_INCLUDE_DIR
+  FIND_PATH(QT4_QTSQL_INCLUDE_DIR QtSql
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtSql
+    ${QT4_LIBRARY_DIR}/QtSql.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QTXML_INCLUDE_DIR
+  FIND_PATH(QT4_QTXML_INCLUDE_DIR QtXml
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtXml
+    ${QT4_LIBRARY_DIR}/QtXml.framework/Headers
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QTASSISTANT_INCLUDE_DIR
+  FIND_PATH(QT4_QTASSISTANT_INCLUDE_DIR QtAssistant
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtAssistant
+    ${QT_HEADERS_DIR}/QtAssistant
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QTDESIGNER_INCLUDE_DIR
+  FIND_PATH(QT4_QTDESIGNER_INCLUDE_DIR QDesignerComponents
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtDesigner
+    ${QT_HEADERS_DIR}/QtDesigner
+    NO_DEFAULT_PATH
+    )
+
+  # Set QT4_QTDESIGNERCOMPONENTS_INCLUDE_DIR
+  FIND_PATH(QT4_QTDESIGNERCOMPONENTS_INCLUDE_DIR QDesignerComponents
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtDesigner
+    ${QT_HEADERS_DIR}/QtDesigner
+    NO_DEFAULT_PATH
+    )
+
+
+  # Set QT4_QTDBUS_INCLUDE_DIR
+  FIND_PATH(QT4_QTDBUS_INCLUDE_DIR QtDBus
+    PATHS
+    ${QT4_INCLUDE_DIR}/QtDBus
+    ${QT_HEADERS_DIR}/QtDBus
+    NO_DEFAULT_PATH
+    )
+
+  # Make variables changeble to the advanced user
+  MARK_AS_ADVANCED( QT4_LIBRARY_DIR QT4_INCLUDE_DIR QT4_QT4_INCLUDE_DIR QT_DOC_DIR QT_MKSPECS_DIR QT4_PLUGINS_DIR)
+
+  # Set QT4_INCLUDES
+  SET( QT4_INCLUDES ${QT4_INCLUDE_DIR} ${QT4_QT4_INCLUDE_DIR} ${QT_MKSPECS_DIR}/default )
+
+
+  ########################################
+  #
+  #       Setting the LIBRARY-Variables
+  #
+  ########################################
+
+  IF (QT_USE_FRAMEWORKS)
+    # If FIND_LIBRARY found libraries in Apple frameworks, we would NOT have
+    # to jump through these hoops.
+    IF(EXISTS ${QT4_LIBRARY_DIR}/QtCore.framework)
+      SET(QT4_QTCORE_FOUND TRUE)
+      SET(QT4_QTCORE_LIBRARY "-F${QT4_LIBRARY_DIR} -framework QtCore" CACHE STRING "The QtCore library.")
+    ELSE(EXISTS ${QT4_LIBRARY_DIR}/QtCore.framework)
+      SET(QT4_QTCORE_FOUND FALSE)
+    ENDIF(EXISTS ${QT4_LIBRARY_DIR}/QtCore.framework)
+
+    IF(EXISTS ${QT4_LIBRARY_DIR}/QtGui.framework)
+      SET(QT4_QTGUI_FOUND TRUE)
+      SET(QT4_QTGUI_LIBRARY "-F${QT4_LIBRARY_DIR} -framework QtGui" CACHE STRING "The QtGui library.")
+    ELSE(EXISTS ${QT4_LIBRARY_DIR}/QtGui.framework)
+      SET(QT4_QTGUI_FOUND FALSE)
+    ENDIF(EXISTS ${QT4_LIBRARY_DIR}/QtGui.framework)
+
+    IF(EXISTS ${QT4_LIBRARY_DIR}/Qt3Support.framework)
+      SET(QT4_QT3SUPPORT_FOUND TRUE)
+      SET(QT4_QT3SUPPORT_LIBRARY "-F${QT4_LIBRARY_DIR} -framework Qt3Support" CACHE STRING "The Qt3Support library.")
+    ELSE(EXISTS ${QT4_LIBRARY_DIR}/Qt3Support.framework)
+      SET(QT4_QT3SUPPORT_FOUND FALSE)
+    ENDIF(EXISTS ${QT4_LIBRARY_DIR}/Qt3Support.framework)
+
+    IF(EXISTS ${QT4_LIBRARY_DIR}/QtNetwork.framework)
+      SET(QT4_QTNETWORK_FOUND TRUE)
+      SET(QT4_QTNETWORK_LIBRARY "-F${QT4_LIBRARY_DIR} -framework QtNetwork" CACHE STRING "The QtNetwork library.")
+    ELSE(EXISTS ${QT4_LIBRARY_DIR}/QtNetwork.framework)
+      SET(QT4_QTNETWORK_FOUND FALSE)
+    ENDIF(EXISTS ${QT4_LIBRARY_DIR}/QtNetwork.framework)
+
+    IF(EXISTS ${QT4_LIBRARY_DIR}/QtOpenGL.framework)
+      SET(QT4_QTOPENGL_FOUND TRUE)
+      SET(QT4_QTOPENGL_LIBRARY "-F${QT4_LIBRARY_DIR} -framework QtOpenGL" CACHE STRING "The QtOpenGL library.")
+    ELSE(EXISTS ${QT4_LIBRARY_DIR}/QtOpenGL.framework)
+      SET(QT4_QTOPENGL_FOUND FALSE)
+    ENDIF(EXISTS ${QT4_LIBRARY_DIR}/QtOpenGL.framework)
+
+    IF(EXISTS ${QT4_LIBRARY_DIR}/QtSql.framework)
+      SET(QT4_QTSQL_FOUND TRUE)
+      SET(QT4_QTSQL_LIBRARY "-F${QT4_LIBRARY_DIR} -framework QtSql" CACHE STRING "The QtSql library.")
+    ELSE(EXISTS ${QT4_LIBRARY_DIR}/QtSql.framework)
+      SET(QT4_QTSQL_FOUND FALSE)
+    ENDIF(EXISTS ${QT4_LIBRARY_DIR}/QtSql.framework)
+
+    IF(EXISTS ${QT4_LIBRARY_DIR}/QtXml.framework)
+      SET(QT4_QTXML_FOUND TRUE)
+      SET(QT4_QTXML_LIBRARY "-F${QT4_LIBRARY_DIR} -framework QtXml" CACHE STRING "The QtXml library.")
+    ELSE(EXISTS ${QT4_LIBRARY_DIR}/QtXml.framework)
+      SET(QT4_QTXML_FOUND FALSE)
+    ENDIF(EXISTS ${QT4_LIBRARY_DIR}/QtXml.framework)
+
+    IF(EXISTS ${QT4_LIBRARY_DIR}/QtSvg.framework)
+      SET(QT4_QTSVG_FOUND TRUE)
+      SET(QT4_QTSVG_LIBRARY "-F${QT4_LIBRARY_DIR} -framework QtSvg" CACHE STRING "The QtSvg library.")
+    ELSE(EXISTS ${QT4_LIBRARY_DIR}/QtSvg.framework)
+      SET(QT4_QTSVG_FOUND FALSE)
+    ENDIF(EXISTS ${QT4_LIBRARY_DIR}/QtSvg.framework)
+
+    IF(EXISTS ${QT4_LIBRARY_DIR}/QtDBus.framework)
+      SET(QT4_QTDBUS_FOUND TRUE)
+      SET(QT4_QTDBUS_LIBRARY "-F${QT4_LIBRARY_DIR} -framework QtDBus" CACHE STRING "The QtDBus library.")
+    ELSE(EXISTS ${QT4_LIBRARY_DIR}/QtDBus.framework)
+      SET(QT4_QTDBUS_FOUND FALSE)
+    ENDIF(EXISTS ${QT4_LIBRARY_DIR}/QtDBus.framework)
+
+    IF(EXISTS ${QT4_LIBRARY_DIR}/QtTest.framework)
+      SET(QT4_QTTEST_FOUND TRUE)
+      SET(QT4_QTTEST_LIBRARY "-F${QT4_LIBRARY_DIR} -framework QtTest" CACHE STRING "The QtTest library.")
+    ELSE(EXISTS ${QT4_LIBRARY_DIR}/QtTest.framework)
+      SET(QT4_QTTEST_FOUND FALSE)
+    ENDIF(EXISTS ${QT4_LIBRARY_DIR}/QtTest.framework)
+
+    # WTF?  why don't we have frameworks?  :P
+    # Set QT4_QTUITOOLS_LIBRARY
+    FIND_LIBRARY(QT4_QTUITOOLS_LIBRARY NAMES QtUiTools QtUiTools4 PATHS ${QT4_LIBRARY_DIR} )
+    # Set QT4_QTSCRIPT_LIBRARY
+    FIND_LIBRARY(QT4_QTSCRIPT_LIBRARY NAMES QtScript QtScript4    PATHS ${QT4_LIBRARY_DIR} )
+
+  ELSE (QT_USE_FRAMEWORKS)
+    
+    # Set QT4_QTCORE_LIBRARY by searching for a lib with "QtCore."  as part of the filename
+    FIND_LIBRARY(QT4_QTCORE_LIBRARY NAMES QtCore QtCore4 QtCored4          PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH )
+
+    # Set QT4_QT3SUPPORT_LIBRARY
+    FIND_LIBRARY(QT4_QT3SUPPORT_LIBRARY NAMES Qt3Support Qt3Support4 Qt3Supportd4 PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+    # Set QT4_QTGUI_LIBRARY
+    FIND_LIBRARY(QT4_QTGUI_LIBRARY NAMES QtGui QtGui4 QtGuid4            PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+    # Set QT4_QTMOTIF_LIBRARY
+    IF(Q_WS_X11)
+      FIND_LIBRARY(QT4_QTMOTIF_LIBRARY NAMES QtMotif          PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+    ENDIF(Q_WS_X11)
+
+    # Set QT4_QTNETWORK_LIBRARY
+    FIND_LIBRARY(QT4_QTNETWORK_LIBRARY NAMES QtNetwork QtNetwork4 QtNetworkd4 PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+    # Set QT4_QTNSPLUGIN_LIBRARY
+    FIND_LIBRARY(QT4_QTNSPLUGIN_LIBRARY NAMES QtNsPlugin      PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+    # Set QT4_QTOPENGL_LIBRARY
+    FIND_LIBRARY(QT4_QTOPENGL_LIBRARY NAMES QtOpenGL QtOpenGL4 QtOpenGLd4    PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+    # Set QT4_QTSQL_LIBRARY
+    FIND_LIBRARY(QT4_QTSQL_LIBRARY NAMES QtSql QtSql4 QtSqld4       PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+    # Set QT4_QTXML_LIBRARY
+    FIND_LIBRARY(QT4_QTXML_LIBRARY NAMES QtXml QtXml4 QtXmld4       PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+    # Set QT4_QTSVG_LIBRARY
+    FIND_LIBRARY(QT4_QTSVG_LIBRARY NAMES QtSvg QtSvg4 QtSvgd4       PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+    # Set QT4_QTSCRIPT_LIBRARY
+    FIND_LIBRARY(QT4_QTSCRIPT_LIBRARY NAMES QtScript QtScript4 QtScriptd4   PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+    # Set QT4_QTUITOOLS_LIBRARY
+    FIND_LIBRARY(QT4_QTUITOOLS_LIBRARY NAMES QtUiTools QtUiTools4 QtUiToolsd4 PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+    # Set QT4_QTTEST_LIBRARY
+    FIND_LIBRARY(QT4_QTTEST_LIBRARY NAMES QtTest QtTest4 QtTestd4          PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+    FIND_LIBRARY(QT4_QTDBUS_LIBRARY NAMES QtDBus QtDBus4 QtDBusd4         PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+    IF(MSVC)
+      FIND_LIBRARY(QT4_QTCORE_LIBRARY_RELEASE    NAMES QtCore4            PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTCORE_LIBRARY_DEBUG      NAMES QtCored4            PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QT3SUPPORT_LIBRARY_RELEASE NAMES Qt3Support4        PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QT3SUPPORT_LIBRARY_DEBUG  NAMES Qt3Supportd4        PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTGUI_LIBRARY_RELEASE     NAMES QtGui4             PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTGUI_LIBRARY_DEBUG       NAMES QtGuid4             PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTNETWORK_LIBRARY_RELEASE NAMES QtNetwork4         PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTNETWORK_LIBRARY_DEBUG   NAMES QtNetworkd4         PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTOPENGL_LIBRARY_RELEASE  NAMES QtOpenGL4          PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTOPENGL_LIBRARY_DEBUG    NAMES QtOpenGLd4          PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTSQL_LIBRARY_RELEASE     NAMES QtSql4             PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTSQL_LIBRARY_DEBUG       NAMES QtSqld4             PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTXML_LIBRARY_RELEASE     NAMES QtXml4             PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTXML_LIBRARY_DEBUG       NAMES QtXmld4             PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTSVG_LIBRARY_RELEASE     NAMES QtSvg4             PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTSVG_LIBRARY_DEBUG       NAMES QtSvgd4             PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTSCRIPT_LIBRARY_RELEASE  NAMES QtScript4          PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTSCRIPT_LIBRARY_DEBUG    NAMES QtScriptd4          PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTUITOOLS_LIBRARY_RELEASE NAMES QtUiTools QtUiTools4 PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTUITOOLS_LIBRARY_DEBUG   NAMES QtUiToolsd QtUiToolsd4 PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTTEST_LIBRARY_RELEASE    NAMES QtTest4            PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTTEST_LIBRARY_DEBUG      NAMES QtTestd4            PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTDBUS_LIBRARY_RELEASE    NAMES QtDBus4            PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTDBUS_LIBRARY_DEBUG      NAMES QtDBusd4            PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTASSISTANT_LIBRARY_RELEASE NAMES QtAssistantClient4 PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTASSISTANT_LIBRARY_DEBUG NAMES QtAssistantClientd4 PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTDESIGNER_LIBRARY_RELEASE NAMES QtDesigner4            PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTDESIGNER_LIBRARY_DEBUG  NAMES QtDesignerd4            PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTDESIGNERCOMPONENTS_LIBRARY_RELEASE NAMES QtDesignerComponents4 PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTDESIGNERCOMPONENTS_LIBRARY_DEBUG NAMES QtDesignerComponentsd4 PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTMAIN_LIBRARY_RELEASE    NAMES qtmain             PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+      FIND_LIBRARY(QT4_QTMAIN_LIBRARY_DEBUG      NAMES qtmaind             PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+    ENDIF(MSVC)
+  ENDIF (QT_USE_FRAMEWORKS)
+
+  IF( NOT QT4_QTCORE_LIBRARY )
+    IF( NOT Qt4_FIND_QUIETLY AND Qt4_FIND_REQUIRED)
+      MESSAGE( FATAL_ERROR "Could NOT find QtCore. Check CMakeFiles/CMakeError.log for more details.")
+    ENDIF( NOT Qt4_FIND_QUIETLY AND Qt4_FIND_REQUIRED)
+  ENDIF( NOT QT4_QTCORE_LIBRARY )
+
+  # Set QT4_QTASSISTANT_LIBRARY
+  FIND_LIBRARY(QT4_QTASSISTANT_LIBRARY NAMES QtAssistantClient QtAssistantClient4 QtAssistant QtAssistant4 QtAssistantd4 PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+
+  # Set QT4_QTDESIGNER_LIBRARY
+  FIND_LIBRARY(QT4_QTDESIGNER_LIBRARY NAMES QtDesigner QtDesigner4 QtDesignerd4 PATHS ${QT4_LIBRARY_DIR}        NO_DEFAULT_PATH)
+
+  # Set QT4_QTDESIGNERCOMPONENTS_LIBRARY
+  FIND_LIBRARY(QT4_QTDESIGNERCOMPONENTS_LIBRARY NAMES QtDesignerComponents QtDesignerComponents4 QtDesignerComponentsd4 PATHS ${QT4_LIBRARY_DIR}        NO_DEFAULT_PATH)
+
+  # Set QT4_QTMAIN_LIBRARY
+  IF(WIN32)
+    FIND_LIBRARY(QT4_QTMAIN_LIBRARY NAMES qtmain qtmaind PATHS ${QT4_LIBRARY_DIR} NO_DEFAULT_PATH)
+  ENDIF(WIN32)
+
+  ############################################
+  #
+  # Check the existence of the libraries.
+  #
+  ############################################
+
+  MACRO (_QT4_ADJUST_LIB_VARS basename)
+    IF (QT4_${basename}_LIBRARY OR QT4_${basename}_LIBRARY_DEBUG)
+
+      IF(MSVC)
+        # Both set
+        IF (QT4_${basename}_LIBRARY_RELEASE AND QT4_${basename}_LIBRARY_DEBUG)
+          SET(QT4_${basename}_LIBRARY optimized ${QT4_${basename}_LIBRARY_RELEASE} debug ${QT4_${basename}_LIBRARY_DEBUG})
+        ENDIF (QT4_${basename}_LIBRARY_RELEASE AND QT4_${basename}_LIBRARY_DEBUG)
+
+        # Only debug was found
+        IF (NOT QT4_${basename}_LIBRARY_RELEASE AND QT4_${basename}_LIBRARY_DEBUG)
+          SET(QT4_${basename}_LIBRARY ${QT4_${basename}_LIBRARY_DEBUG})
+        ENDIF (NOT QT4_${basename}_LIBRARY_RELEASE AND QT4_${basename}_LIBRARY_DEBUG)
+
+        # Only release was found
+        IF (QT4_${basename}_LIBRARY_RELEASE AND NOT QT4_${basename}_LIBRARY_DEBUG)
+          SET(QT4_${basename}_LIBRARY ${QT4_${basename}_LIBRARY_RELEASE})
+        ENDIF (QT4_${basename}_LIBRARY_RELEASE AND NOT QT4_${basename}_LIBRARY_DEBUG)
+
+        # Hmm, is this used anywhere ? Yes, in UseQt4.cmake. We are currently incompatible :-(
+        SET(QT4_${basename}_LIBRARIES optimized ${QT4_${basename}_LIBRARY} debug ${QT4_${basename}_LIBRARY_DEBUG})
+
+      ENDIF(MSVC)
+
+      SET(QT4_${basename}_LIBRARY ${QT4_${basename}_LIBRARY} CACHE FILEPATH "The Qt4 ${basename} library")
+
+      IF (QT4_${basename}_LIBRARY)
+        SET(QT4_${basename}_FOUND 1)
+      ENDIF (QT4_${basename}_LIBRARY)
+      
+    ENDIF (QT4_${basename}_LIBRARY OR QT4_${basename}_LIBRARY_DEBUG)
+    
+    IF (QT4_${basename}_INCLUDE_DIR)
+      #add the include directory to QT4_INCLUDES
+      SET(QT4_INCLUDES ${QT4_INCLUDES} "${QT4_${basename}_INCLUDE_DIR}")
+    ENDIF (QT4_${basename}_INCLUDE_DIR)
+
+    # Make variables changeble to the advanced user
+    MARK_AS_ADVANCED(QT4_${basename}_LIBRARY QT4_${basename}_INCLUDE_DIR)
+  ENDMACRO (_QT4_ADJUST_LIB_VARS)
+
+
+  # Set QT_xyz_LIBRARY variable and add 
+  # library include path to QT4_INCLUDES
+  _QT4_ADJUST_LIB_VARS(QTCORE)
+  _QT4_ADJUST_LIB_VARS(QTGUI)
+  _QT4_ADJUST_LIB_VARS(QT3SUPPORT)
+  _QT4_ADJUST_LIB_VARS(QTASSISTANT)
+  _QT4_ADJUST_LIB_VARS(QTDESIGNER)
+  _QT4_ADJUST_LIB_VARS(QTDESIGNERCOMPONENTS)
+  _QT4_ADJUST_LIB_VARS(QTNETWORK)
+  _QT4_ADJUST_LIB_VARS(QTNSPLUGIN)
+  _QT4_ADJUST_LIB_VARS(QTOPENGL)
+  _QT4_ADJUST_LIB_VARS(QTSQL)
+  _QT4_ADJUST_LIB_VARS(QTXML)
+  _QT4_ADJUST_LIB_VARS(QTSVG)
+  _QT4_ADJUST_LIB_VARS(QTSCRIPT)
+  _QT4_ADJUST_LIB_VARS(QTUITOOLS)
+  _QT4_ADJUST_LIB_VARS(QTTEST)
+  _QT4_ADJUST_LIB_VARS(QTDBUS)
+  
+  
+  # platform dependent libraries
+  IF(Q_WS_X11)
+    _QT4_ADJUST_LIB_VARS(QTMOTIF)
+  ENDIF(Q_WS_X11)
+  IF(WIN32)
+    _QT4_ADJUST_LIB_VARS(QTMAIN)
+  ENDIF(WIN32)
+  
+
+  #######################################
+  #
+  #       Check the executables of Qt 
+  #          ( moc, uic, rcc )
+  #
+  #######################################
+
+
+  # find moc and uic using qmake
+  QT_QUERY_QMAKE(QT4_MOC_EXECUTABLE_INTERNAL "QMAKE_MOC")
+  QT_QUERY_QMAKE(QT4_UIC_EXECUTABLE_INTERNAL "QMAKE_UIC")
+
+  FILE(TO_CMAKE_PATH 
+    "${QT4_MOC_EXECUTABLE_INTERNAL}" QT4_MOC_EXECUTABLE_INTERNAL)
+  FILE(TO_CMAKE_PATH 
+    "${QT4_UIC_EXECUTABLE_INTERNAL}" QT4_UIC_EXECUTABLE_INTERNAL)
+
+  SET(QT4_MOC_EXECUTABLE 
+    ${QT4_MOC_EXECUTABLE_INTERNAL} CACHE FILEPATH "The moc executable")
+  SET(QT4_UIC_EXECUTABLE 
+    ${QT4_UIC_EXECUTABLE_INTERNAL} CACHE FILEPATH "The uic executable")
+
+  FIND_PROGRAM(QT_UIC3_EXECUTABLE
+    NAMES uic3
+    PATHS ${QT_BINARY_DIR}
+    NO_DEFAULT_PATH
+    )
+
+  FIND_PROGRAM(QT_RCC_EXECUTABLE 
+    NAMES rcc
+    PATHS ${QT_BINARY_DIR}
+    NO_DEFAULT_PATH
+    )
+
+  FIND_PROGRAM(QT_DBUSCPP2XML_EXECUTABLE 
+    NAMES qdbuscpp2xml
+    PATHS ${QT_BINARY_DIR}
+    NO_DEFAULT_PATH
+    )
+
+  FIND_PROGRAM(QT_DBUSXML2CPP_EXECUTABLE 
+    NAMES qdbusxml2cpp
+    PATHS ${QT_BINARY_DIR}
+    NO_DEFAULT_PATH
+    )
+
+  IF (QT4_MOC_EXECUTABLE)
+     SET(QT_WRAP_CPP "YES")
+  ENDIF (QT4_MOC_EXECUTABLE)
+
+  IF (QT4_UIC_EXECUTABLE)
+     SET(QT_WRAP_UI "YES")
+  ENDIF (QT4_UIC_EXECUTABLE)
+
+
+
+  MARK_AS_ADVANCED( QT4_UIC_EXECUTABLE QT_UIC3_EXECUTABLE QT4_MOC_EXECUTABLE QT_RCC_EXECUTABLE QT_DBUSXML2CPP_EXECUTABLE QT_DBUSCPP2XML_EXECUTABLE)
+
+  ######################################
+  #
+  #       Macros for building Qt files
+  #
+  ######################################
+
+  MACRO (QT4_GET_MOC_INC_DIRS _moc_INC_DIRS)
+     SET(${_moc_INC_DIRS})
+     GET_DIRECTORY_PROPERTY(_inc_DIRS INCLUDE_DIRECTORIES)
+
+     FOREACH(_current ${_inc_DIRS})
+        SET(${_moc_INC_DIRS} ${${_moc_INC_DIRS}} "-I" ${_current})
+     ENDFOREACH(_current ${_inc_DIRS})
+  ENDMACRO(QT4_GET_MOC_INC_DIRS)
+
+
+  MACRO (QT4_GENERATE_MOC infile outfile )
+  # get include dirs
+     QT4_GET_MOC_INC_DIRS(moc_includes)
+
+     GET_FILENAME_COMPONENT(abs_infile ${infile} ABSOLUTE)
+
+     IF (MSVC_IDE)
+        SET (_moc_parameter_file ${outfile}_parameters)
+        SET (_moc_param "${moc_includes} \n-o${outfile} \n${abs_infile}")
+        STRING(REGEX REPLACE ";-I;" "\\n-I" _moc_param "${_moc_param}")
+        FILE (WRITE ${_moc_parameter_file} "${_moc_param}")
+        ADD_CUSTOM_COMMAND(OUTPUT ${outfile}
+          COMMAND ${QT4_MOC_EXECUTABLE}
+          ARGS @"${_moc_parameter_file}"
+          DEPENDS ${abs_infile})
+     ELSE (MSVC_IDE)     
+        ADD_CUSTOM_COMMAND(OUTPUT ${outfile}
+           COMMAND ${QT4_MOC_EXECUTABLE}
+           ARGS ${moc_includes} -o ${outfile} ${abs_infile}
+           DEPENDS ${abs_infile})     
+     ENDIF (MSVC_IDE)
+
+     SET_SOURCE_FILES_PROPERTIES(${outfile} PROPERTIES SKIP_AUTOMOC TRUE)  # dont run automoc on this file
+
+     MACRO_ADD_FILE_DEPENDENCIES(${abs_infile} ${outfile})
+  ENDMACRO (QT4_GENERATE_MOC)
+
+
+  # QT4_WRAP_CPP(outfiles inputfile ... )
+  # TODO  perhaps add support for -D, -U and other minor options
+
+  MACRO (QT4_WRAP_CPP outfiles )
+    # get include dirs
+    QT4_GET_MOC_INC_DIRS(moc_includes)
+
+    FOREACH (it ${ARGN})
+      GET_FILENAME_COMPONENT(it ${it} ABSOLUTE)
+      GET_FILENAME_COMPONENT(outfile ${it} NAME_WE)
+
+      SET(outfile ${CMAKE_CURRENT_BINARY_DIR}/moc_${outfile}.cxx)
+      ADD_CUSTOM_COMMAND(OUTPUT ${outfile}
+        COMMAND ${QT4_MOC_EXECUTABLE}
+        ARGS ${moc_includes} -o ${outfile} ${it}
+        DEPENDS ${it})
+      SET(${outfiles} ${${outfiles}} ${outfile})
+    ENDFOREACH(it)
+
+  ENDMACRO (QT4_WRAP_CPP)
+
+
+  # QT4_WRAP_UI(outfiles inputfile ... )
+
+  MACRO (QT4_WRAP_UI outfiles )
+
+    FOREACH (it ${ARGN})
+      GET_FILENAME_COMPONENT(outfile ${it} NAME_WE)
+      GET_FILENAME_COMPONENT(infile ${it} ABSOLUTE)
+      SET(outfile ${CMAKE_CURRENT_BINARY_DIR}/ui_${outfile}.h)
+      ADD_CUSTOM_COMMAND(OUTPUT ${outfile}
+        COMMAND ${QT4_UIC_EXECUTABLE}
+        ARGS -o ${outfile} ${infile}
+        MAIN_DEPENDENCY ${infile})
+      SET(${outfiles} ${${outfiles}} ${outfile})
+    ENDFOREACH (it)
+
+  ENDMACRO (QT4_WRAP_UI)
+
+
+  # QT4_ADD_RESOURCES(outfiles inputfile ... )
+  # TODO  perhaps consider adding support for compression and root options to rcc
+
+  MACRO (QT4_ADD_RESOURCES outfiles )
+
+    FOREACH (it ${ARGN})
+      GET_FILENAME_COMPONENT(outfilename ${it} NAME_WE)
+      GET_FILENAME_COMPONENT(infile ${it} ABSOLUTE)
+      GET_FILENAME_COMPONENT(rc_path ${infile} PATH)
+      SET(outfile ${CMAKE_CURRENT_BINARY_DIR}/qrc_${outfilename}.cxx)
+      #  parse file for dependencies 
+      #  all files are absolute paths or relative to the location of the qrc file
+      FILE(READ "${infile}" _RC_FILE_CONTENTS)
+      STRING(REGEX MATCHALL "<file[^<]+" _RC_FILES "${_RC_FILE_CONTENTS}")
+      SET(_RC_DEPENDS)
+      FOREACH(_RC_FILE ${_RC_FILES})
+        STRING(REGEX REPLACE "^<file[^>]*>" "" _RC_FILE "${_RC_FILE}")
+        STRING(REGEX MATCH "^/|([A-Za-z]:/)" _ABS_PATH_INDICATOR "${_RC_FILE}")
+        IF(NOT _ABS_PATH_INDICATOR)
+          SET(_RC_FILE "${rc_path}/${_RC_FILE}")
+        ENDIF(NOT _ABS_PATH_INDICATOR)
+        SET(_RC_DEPENDS ${_RC_DEPENDS} "${_RC_FILE}")
+      ENDFOREACH(_RC_FILE)
+      ADD_CUSTOM_COMMAND(OUTPUT ${outfile}
+        COMMAND ${QT_RCC_EXECUTABLE}
+        ARGS -name ${outfilename} -o ${outfile} ${infile}
+        MAIN_DEPENDENCY ${infile}
+        DEPENDS ${_RC_DEPENDS})
+      SET(${outfiles} ${${outfiles}} ${outfile})
+    ENDFOREACH (it)
+
+  ENDMACRO (QT4_ADD_RESOURCES)
+
+  MACRO(QT4_ADD_DBUS_INTERFACE _sources _interface _basename)
+    GET_FILENAME_COMPONENT(_infile ${_interface} ABSOLUTE)
+    SET(_header ${CMAKE_CURRENT_BINARY_DIR}/${_basename}.h)
+    SET(_impl   ${CMAKE_CURRENT_BINARY_DIR}/${_basename}.cpp)
+    SET(_moc    ${CMAKE_CURRENT_BINARY_DIR}/${_basename}.moc)
+
+    GET_SOURCE_FILE_PROPERTY(_nonamespace ${_interface} NO_NAMESPACE)
+    IF ( _nonamespace )
+        SET(_params -N -m)
+    ELSE ( _nonamespace )
+        SET(_params -m)
+    ENDIF ( _nonamespace )
+
+    GET_SOURCE_FILE_PROPERTY(_include ${_interface} INCLUDE)
+    IF ( _include )
+        SET(_params ${_params} -i ${_include})
+    ENDIF ( _include )
+
+    ADD_CUSTOM_COMMAND(OUTPUT ${_impl} ${_header}
+        COMMAND ${QT_DBUSXML2CPP_EXECUTABLE} ${_params} -p ${_basename} ${_infile}
+        DEPENDS ${_infile})
+  
+    SET_SOURCE_FILES_PROPERTIES(${_impl} PROPERTIES SKIP_AUTOMOC TRUE)
+    
+    QT4_GENERATE_MOC(${_header} ${_moc})
+  
+    SET(${_sources} ${${_sources}} ${_impl} ${_header} ${_moc})
+    MACRO_ADD_FILE_DEPENDENCIES(${_impl} ${_moc})
+  
+  ENDMACRO(QT4_ADD_DBUS_INTERFACE)
+ 
+  MACRO(QT4_ADD_DBUS_INTERFACES _sources)
+     FOREACH (_current_FILE ${ARGN})
+        GET_FILENAME_COMPONENT(_infile ${_current_FILE} ABSOLUTE)
+        # get the part before the ".xml" suffix
+        STRING(REGEX REPLACE "(.*[/\\.])?([^\\.]+)\\.xml" "\\2" _basename ${_current_FILE})
+        STRING(TOLOWER ${_basename} _basename)
+        QT4_ADD_DBUS_INTERFACE(${_sources} ${_infile} ${_basename}interface)
+     ENDFOREACH (_current_FILE)
+  ENDMACRO(QT4_ADD_DBUS_INTERFACES)
+
+  MACRO(QT4_ADD_DBUS_INTERFACE_NO_NAMESPACE _sources _interface _basename)
+    MESSAGE(SEND_ERROR "QT4_ADD_DBUS_INTERFACE_NO_NAMESPACE() is deprecated. Use the following instead:
+SET_SOURCE_FILES_PROPERTIES(<interface> PROPERTIES NO_NAMESPACE TRUE)
+QT4_ADD_DBUS_INTERFACE(<srcList> <interface> <basename>)\n")
+  ENDMACRO(QT4_ADD_DBUS_INTERFACE_NO_NAMESPACE)
+
+  MACRO(QT4_ADD_DBUS_INTERFACES_NO_NAMESPACE _sources)
+    MESSAGE(SEND_ERROR "QT4_ADD_DBUS_INTERFACES_NO_NAMESPACE() is deprecated. Use the following instead:
+SET_SOURCE_FILES_PROPERTIES(<files> PROPERTIES NO_NAMESPACE TRUE)
+QT4_ADD_DBUS_INTERFACES(<srcList> <files>)\n")
+  ENDMACRO(QT4_ADD_DBUS_INTERFACES_NO_NAMESPACE)
+  
+  MACRO(QT4_GENERATE_DBUS_INTERFACE _header) # _customName )
+    SET(_customName "${ARGV1}")
+    GET_FILENAME_COMPONENT(_in_file ${_header} ABSOLUTE)
+    GET_FILENAME_COMPONENT(_basename ${_header} NAME_WE)
+    
+    IF (_customName)
+      SET(_target ${CMAKE_CURRENT_BINARY_DIR}/${_customName})
+    ELSE (_customName)
+      SET(_target ${CMAKE_CURRENT_BINARY_DIR}/${_basename}.xml)
+    ENDIF (_customName)
+  
+    ADD_CUSTOM_COMMAND(OUTPUT ${_target}
+        COMMAND ${QT_DBUSCPP2XML_EXECUTABLE} ${_in_file} > ${_target}
+        DEPENDS ${_in_file}
+    )
+  ENDMACRO(QT4_GENERATE_DBUS_INTERFACE)
+  
+  
+  MACRO(QT4_ADD_DBUS_ADAPTOR _sources _xml_file _include _parentClass) # _optionalBasename _optionalClassName)
+    GET_FILENAME_COMPONENT(_infile ${_xml_file} ABSOLUTE)
+    
+    SET(_optionalBasename "${ARGV4}")
+    IF (_optionalBasename)
+       SET(_basename ${_optionalBasename} )
+    ELSE (_optionalBasename)
+       STRING(REGEX REPLACE "(.*[/\\.])?([^\\.]+)\\.xml" "\\2adaptor" _basename ${_infile})
+       STRING(TOLOWER ${_basename} _basename)
+    ENDIF (_optionalBasename)
+
+    SET(_optionalClassName "${ARGV5}")
+    SET(_header ${CMAKE_CURRENT_BINARY_DIR}/${_basename}.h)
+    SET(_impl   ${CMAKE_CURRENT_BINARY_DIR}/${_basename}.cpp)
+    SET(_moc    ${CMAKE_CURRENT_BINARY_DIR}/${_basename}.moc)
+
+    IF(_optionalClassName)
+       ADD_CUSTOM_COMMAND(OUTPUT ${_impl} ${_header}
+          COMMAND ${QT_DBUSXML2CPP_EXECUTABLE} -m -a ${_basename} -c ${_optionalClassName} -i ${_include} -l ${_parentClass} ${_infile}
+          DEPENDS ${_infile}
+        )
+    ELSE(_optionalClassName)
+       ADD_CUSTOM_COMMAND(OUTPUT ${_impl} ${_header}
+          COMMAND ${QT_DBUSXML2CPP_EXECUTABLE} -m -a ${_basename} -i ${_include} -l ${_parentClass} ${_infile}
+          DEPENDS ${_infile}
+        )
+    ENDIF(_optionalClassName)
+
+    QT4_GENERATE_MOC(${_header} ${_moc})
+    SET_SOURCE_FILES_PROPERTIES(${_impl} PROPERTIES SKIP_AUTOMOC TRUE)
+    MACRO_ADD_FILE_DEPENDENCIES(${_impl} ${_moc})
+
+    SET(${_sources} ${${_sources}} ${_impl} ${_header} ${_moc})
+  ENDMACRO(QT4_ADD_DBUS_ADAPTOR)
+
+   MACRO(QT4_AUTOMOC)
+      QT4_GET_MOC_INC_DIRS(_moc_INCS)
+
+      SET(_matching_FILES )
+      FOREACH (_current_FILE ${ARGN})
+
+         GET_FILENAME_COMPONENT(_abs_FILE ${_current_FILE} ABSOLUTE)
+         # if "SKIP_AUTOMOC" is set to true, we will not handle this file here.
+         # here. this is required to make bouic work correctly:
+         # we need to add generated .cpp files to the sources (to compile them),
+         # but we cannot let automoc handle them, as the .cpp files don't exist yet when
+         # cmake is run for the very first time on them -> however the .cpp files might
+         # exist at a later run. at that time we need to skip them, so that we don't add two
+         # different rules for the same moc file
+         GET_SOURCE_FILE_PROPERTY(_skip ${_abs_FILE} SKIP_AUTOMOC)
+
+         IF ( NOT _skip AND EXISTS ${_abs_FILE} )
+
+            FILE(READ ${_abs_FILE} _contents)
+
+            GET_FILENAME_COMPONENT(_abs_PATH ${_abs_FILE} PATH)
+
+            STRING(REGEX MATCHALL "#include +[^ ]+\\.moc[\">]" _match "${_contents}")
+            IF(_match)
+               FOREACH (_current_MOC_INC ${_match})
+                  STRING(REGEX MATCH "[^ <\"]+\\.moc" _current_MOC "${_current_MOC_INC}")
+
+                  GET_filename_component(_basename ${_current_MOC} NAME_WE)
+   #               SET(_header ${CMAKE_CURRENT_SOURCE_DIR}/${_basename}.h)
+                  IF (EXISTS ${_abs_PATH}/${_basename}.h)
+                    SET(_header ${_abs_PATH}/${_basename}.h)
+                  ELSE (EXISTS ${_abs_PATH}/${_basename}.h)
+                    SET(_header ${_abs_FILE})
+                  ENDIF (EXISTS ${_abs_PATH}/${_basename}.h)
+                  SET(_moc    ${CMAKE_CURRENT_BINARY_DIR}/${_current_MOC})
+                  ADD_CUSTOM_COMMAND(OUTPUT ${_moc}
+                     COMMAND ${QT4_MOC_EXECUTABLE}
+                     ARGS ${_moc_INCS} ${_header} -o ${_moc}
+                     DEPENDS ${_header}
+                  )
+
+                  MACRO_ADD_FILE_DEPENDENCIES(${_abs_FILE} ${_moc})
+               ENDFOREACH (_current_MOC_INC)
+            ENDIF(_match)
+         ENDIF ( NOT _skip AND EXISTS ${_abs_FILE} )
+      ENDFOREACH (_current_FILE)
+   ENDMACRO(QT4_AUTOMOC)
+
+
+
+  ######################################
+  #
+  #       decide if Qt got found
+  #
+  ######################################
+
+  # if the includes,libraries,moc,uic and rcc are found then we have it
+  IF( QT4_LIBRARY_DIR AND QT4_INCLUDE_DIR AND QT4_MOC_EXECUTABLE AND QT4_UIC_EXECUTABLE AND QT_RCC_EXECUTABLE)
+    SET( QT4_FOUND "YES" )
+    IF( NOT Qt4_FIND_QUIETLY)
+      IF (WIN32)
+        MESSAGE(STATUS "Found Qt-Version ${QTVERSION} with qmake at ${QT_QMAKE_EXECUTABLE}")
+      ELSE (WIN32)
+        MESSAGE(STATUS "Found Qt-Version ${QTVERSION}")
+      ENDIF (WIN32)
+    ENDIF( NOT Qt4_FIND_QUIETLY)
+  ELSE( QT4_LIBRARY_DIR AND QT4_INCLUDE_DIR AND QT4_MOC_EXECUTABLE AND QT4_UIC_EXECUTABLE AND QT_RCC_EXECUTABLE)
+    SET( QT4_FOUND "NO")
+    SET(QT_QMAKE_EXECUTABLE "${QT_QMAKE_EXECUTABLE}-NOTFOUND" CACHE FILEPATH "Invalid qmake found" FORCE)
+    IF( Qt4_FIND_REQUIRED)
+      IF ( NOT QT4_LIBRARY_DIR )
+        MESSAGE(STATUS "Qt libraries NOT found!")
+      ENDIF(NOT QT4_LIBRARY_DIR )
+      IF ( NOT QT4_INCLUDE_DIR )
+        MESSAGE(STATUS "Qt includes NOT found!")
+      ENDIF( NOT QT4_INCLUDE_DIR )
+      IF ( NOT QT4_MOC_EXECUTABLE )
+        MESSAGE(STATUS "Qt's moc NOT found!")
+      ENDIF( NOT QT4_MOC_EXECUTABLE )
+      IF ( NOT QT4_UIC_EXECUTABLE )
+        MESSAGE(STATUS "Qt's uic NOT found!")
+      ENDIF( NOT QT4_UIC_EXECUTABLE )
+      IF ( NOT QT_RCC_EXECUTABLE )
+        MESSAGE(STATUS "Qt's rcc NOT found!")
+      ENDIF( NOT QT_RCC_EXECUTABLE )
+      MESSAGE( FATAL_ERROR "Qt libraries, includes, moc, uic or/and rcc NOT found!")
+    ENDIF( Qt4_FIND_REQUIRED)
+  ENDIF( QT4_LIBRARY_DIR AND QT4_INCLUDE_DIR AND QT4_MOC_EXECUTABLE AND QT4_UIC_EXECUTABLE AND  QT_RCC_EXECUTABLE)
+  SET(QT_FOUND ${QT4_FOUND})
+
+
+  #######################################
+  #
+  #       System dependent settings  
+  #
+  #######################################
+  # for unix add X11 stuff
+  IF(UNIX)
+    # on OS X X11 may not be required
+    IF (Q_WS_X11)
+      FIND_PACKAGE(X11 REQUIRED)
+    ENDIF (Q_WS_X11)
+    FIND_PACKAGE(Threads)
+    SET(QT4_QTCORE_LIBRARY ${QT4_QTCORE_LIBRARY} ${CMAKE_THREAD_LIBS_INIT})
+  ENDIF(UNIX)
+
+
+  #######################################
+  #
+  #       compatibility settings 
+  #
+  #######################################
+  # Backwards compatibility for CMake1.4 and 1.2
+  SET (QT_MOC_EXE ${QT4_MOC_EXECUTABLE} )
+  SET (QT_UIC_EXE ${QT4_UIC_EXECUTABLE} )
+
+  SET( QT4_QT_LIBRARY "")
+
+ELSE(QT4_QMAKE_FOUND)
+   
+   SET(QT_QMAKE_EXECUTABLE "${QT_QMAKE_EXECUTABLE}-NOTFOUND" CACHE FILEPATH "Invalid qmake found" FORCE)
+   IF(Qt4_FIND_REQUIRED)
+      IF(QT4_INSTALLED_VERSION_TOO_OLD)
+         MESSAGE(FATAL_ERROR "The installed Qt version ${QTVERSION} is too old, at least version ${QT4_MIN_VERSION} is required")
+      ELSE(QT4_INSTALLED_VERSION_TOO_OLD)
+         MESSAGE( FATAL_ERROR "Qt qmake not found!")
+      ENDIF(QT4_INSTALLED_VERSION_TOO_OLD)
+   ELSE(Qt4_FIND_REQUIRED)
+      IF(QT4_INSTALLED_VERSION_TOO_OLD AND NOT Qt4_FIND_QUIETLY)
+         MESSAGE(STATUS "The installed Qt version ${QTVERSION} is too old, at least version ${QT4_MIN_VERSION} is required")
+      ENDIF(QT4_INSTALLED_VERSION_TOO_OLD AND NOT Qt4_FIND_QUIETLY)
+   ENDIF(Qt4_FIND_REQUIRED)
+ 
+ENDIF (QT4_QMAKE_FOUND)
+ENDIF (QT4_QMAKE_FOUND)
+
diff -N -r -u poppler-0.6.4-orig/cmake/modules/MacroBoolTo01.cmake poppler-0.6.4/cmake/modules/MacroBoolTo01.cmake
--- poppler-0.6.4-orig/cmake/modules/MacroBoolTo01.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/MacroBoolTo01.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,20 @@
+# MACRO_BOOL_TO_01( VAR RESULT0 ... RESULTN )
+# This macro evaluates its first argument
+# and sets all the given vaiables either to 0 or 1
+# depending on the value of the first one
+
+# Copyright (c) 2006, Alexander Neundorf, <neundorf@kde.org>
+#
+# Redistribution and use is allowed according to the terms of the BSD license.
+# For details see the accompanying COPYING-CMAKE-SCRIPTS file.
+
+
+MACRO(MACRO_BOOL_TO_01 FOUND_VAR )
+   FOREACH (_current_VAR ${ARGN})
+      IF(${FOUND_VAR})
+         SET(${_current_VAR} 1)
+      ELSE(${FOUND_VAR})
+         SET(${_current_VAR} 0)
+      ENDIF(${FOUND_VAR})
+   ENDFOREACH(_current_VAR)
+ENDMACRO(MACRO_BOOL_TO_01)
diff -N -r -u poppler-0.6.4-orig/cmake/modules/MacroOptionalFindPackage.cmake poppler-0.6.4/cmake/modules/MacroOptionalFindPackage.cmake
--- poppler-0.6.4-orig/cmake/modules/MacroOptionalFindPackage.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/MacroOptionalFindPackage.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,28 @@
+# - MACRO_OPTIONAL_FIND_PACKAGE() combines FIND_PACKAGE() with an OPTION()
+# MACRO_OPTIONAL_FIND_PACKAGE( <name> [QUIT] )
+# This macro is a combination of OPTION() and FIND_PACKAGE(), it
+# works like FIND_PACKAGE(), but additionally it automatically creates
+# an option name WITH_<name>, which can be disabled via the cmake GUI.
+# or via -DWITH_<name>=OFF
+# The standard <name>_FOUND variables can be used in the same way
+# as when using the normal FIND_PACKAGE()
+
+# Copyright (c) 2006, Alexander Neundorf, <neundorf@kde.org>
+#
+# Redistribution and use is allowed according to the terms of the BSD license.
+# For details see the accompanying COPYING-CMAKE-SCRIPTS file.
+
+
+MACRO (MACRO_OPTIONAL_FIND_PACKAGE _name )
+   OPTION(WITH_${_name} "Search for ${_name} package" ON)
+   if (WITH_${_name})
+      FIND_PACKAGE(${_name} ${ARGN})
+   else (WITH_${_name})
+      set(${_name}_FOUND)
+      set(${_name}_INCLUDE_DIR)
+      set(${_name}_INCLUDES)
+      set(${_name}_LIBRARY)
+      set(${_name}_LIBRARIES)
+   endif (WITH_${_name})
+ENDMACRO (MACRO_OPTIONAL_FIND_PACKAGE)
+
diff -N -r -u poppler-0.6.4-orig/cmake/modules/MacroPushRequiredVars.cmake poppler-0.6.4/cmake/modules/MacroPushRequiredVars.cmake
--- poppler-0.6.4-orig/cmake/modules/MacroPushRequiredVars.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/MacroPushRequiredVars.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,47 @@
+# this module defines two macros:
+# MACRO_PUSH_REQUIRED_VARS()
+# and
+# MACRO_POP_REQUIRED_VARS()
+# use these if you call cmake macros which use
+# any of the CMAKE_REQUIRED_XXX variables
+#
+# Usage:
+# MACRO_PUSH_REQUIRED_VARS()
+# SET(CMAKE_REQUIRED_DEFINITIONS ${CMAKE_REQUIRED_DEFINITIONS} -DSOME_MORE_DEF)
+# CHECK_FUNCTION_EXISTS(...)
+# MACRO_POP_REQUIRED_VARS()
+
+# Copyright (c) 2006, Alexander Neundorf, <neundorf@kde.org>
+#
+# Redistribution and use is allowed according to the terms of the BSD license.
+# For details see the accompanying COPYING-CMAKE-SCRIPTS file.
+
+MACRO(MACRO_PUSH_REQUIRED_VARS)
+
+   IF(NOT DEFINED _PUSH_REQUIRED_VARS_COUNTER)
+      SET(_PUSH_REQUIRED_VARS_COUNTER 0)
+   ENDIF(NOT DEFINED _PUSH_REQUIRED_VARS_COUNTER)
+
+   MATH(EXPR _PUSH_REQUIRED_VARS_COUNTER "${_PUSH_REQUIRED_VARS_COUNTER}+1")
+
+   SET(_CMAKE_REQUIRED_INCLUDES_SAVE_${_PUSH_REQUIRED_VARS_COUNTER}    ${CMAKE_REQUIRED_INCLUDES})
+   SET(_CMAKE_REQUIRED_DEFINITIONS_SAVE_${_PUSH_REQUIRED_VARS_COUNTER} ${CMAKE_REQUIRED_DEFINITIONS})
+   SET(_CMAKE_REQUIRED_LIBRARIES_SAVE_${_PUSH_REQUIRED_VARS_COUNTER}   ${CMAKE_REQUIRED_LIBRARIES})
+   SET(_CMAKE_REQUIRED_FLAGS_SAVE_${_PUSH_REQUIRED_VARS_COUNTER}       ${CMAKE_REQUIRED_FLAGS})
+ENDMACRO(MACRO_PUSH_REQUIRED_VARS)
+
+MACRO(MACRO_POP_REQUIRED_VARS)
+
+# don't pop more than we pushed
+   IF("${_PUSH_REQUIRED_VARS_COUNTER}" GREATER "0")
+
+      SET(CMAKE_REQUIRED_INCLUDES    ${_CMAKE_REQUIRED_INCLUDES_SAVE_${_PUSH_REQUIRED_VARS_COUNTER}})
+      SET(CMAKE_REQUIRED_DEFINITIONS ${_CMAKE_REQUIRED_DEFINITIONS_SAVE_${_PUSH_REQUIRED_VARS_COUNTER}})
+      SET(CMAKE_REQUIRED_LIBRARIES   ${_CMAKE_REQUIRED_LIBRARIES_SAVE_${_PUSH_REQUIRED_VARS_COUNTER}})
+      SET(CMAKE_REQUIRED_FLAGS       ${_CMAKE_REQUIRED_FLAGS_SAVE_${_PUSH_REQUIRED_VARS_COUNTER}})
+
+      MATH(EXPR _PUSH_REQUIRED_VARS_COUNTER "${_PUSH_REQUIRED_VARS_COUNTER}-1")
+   ENDIF("${_PUSH_REQUIRED_VARS_COUNTER}" GREATER "0")
+
+ENDMACRO(MACRO_POP_REQUIRED_VARS)
+
diff -N -r -u poppler-0.6.4-orig/cmake/modules/PopplerMacros.cmake poppler-0.6.4/cmake/modules/PopplerMacros.cmake
--- poppler-0.6.4-orig/cmake/modules/PopplerMacros.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/cmake/modules/PopplerMacros.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,53 @@
+# Copyright 2007, Pino Toscano, <pino@kde.org>
+#
+# Redistribution and use is allowed according to the terms of the BSD license.
+# For details see the accompanying COPYING-CMAKE-SCRIPTS file.
+
+macro(POPPLER_ADD_TEST exe build_flag)
+
+  if(MSVC)
+    include_directories( ${CMAKE_INCLUDE_PATH}/msvc )
+  endif(MSVC)
+  set(build_test ${${build_flag}})
+  if(NOT build_test)
+    set(_add_executable_param ${_add_executable_param} EXCLUDE_FROM_ALL)
+  endif(NOT build_test)
+
+  add_executable(${exe} ${_add_executable_param} ${ARGN})
+  add_test(${exe} ${EXECUTABLE_OUTPUT_PATH}/${exe} )
+
+  # if the tests are EXCLUDE_FROM_ALL, add a target "buildtests" to build all tests
+  if(NOT build_test)
+    get_directory_property(_buildtestsAdded BUILDTESTS_ADDED)
+    if(NOT _buildtestsAdded)
+      add_custom_target(buildtests)
+      set_directory_properties(PROPERTIES BUILDTESTS_ADDED TRUE)
+    endif(NOT _buildtestsAdded)
+    add_dependencies(buildtests ${exe})
+  endif(NOT build_test)
+
+endmacro(POPPLER_ADD_TEST)
+
+macro(POPPLER_CREATE_INSTALL_PKGCONFIG generated_file install_location)
+  if(NOT WIN32)
+    configure_file(${generated_file}.cmake ${CMAKE_CURRENT_BINARY_DIR}/${generated_file} @ONLY)
+    install(FILES ${CMAKE_CURRENT_BINARY_DIR}/${generated_file} DESTINATION ${install_location})
+  endif(NOT WIN32)
+endmacro(POPPLER_CREATE_INSTALL_PKGCONFIG)
+
+macro(SHOW_END_MESSAGE what enabled)
+  string(LENGTH ${what} length_what)
+  math(EXPR left_char "20 - ${length_what}")
+  set(blanks)
+  foreach (_i RANGE 1 ${left_char})
+    set(blanks "${blanks} ")
+  endforeach (_i)
+  if(${enabled})
+    set(enabled_string "yes")
+  else (${enabled})
+    set(enabled_string "no")
+  endif(${enabled})
+
+  message("  ${what}:${blanks} ${enabled_string}")
+endmacro(SHOW_END_MESSAGE)
+
diff -N -r -u poppler-0.6.4-orig/CMakeLists.txt poppler-0.6.4/CMakeLists.txt
--- poppler-0.6.4-orig/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/CMakeLists.txt	2008-02-11 00:00:46.000000000 +0100
@@ -0,0 +1,382 @@
+project(poppler)
+
+set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules)
+
+include(PopplerMacros)
+include(MacroOptionalFindPackage)
+
+set(POPPLER_VERSION "0.6.90")
+
+enable_testing()
+
+# command line switches
+option(ENABLE_XPDF_HEADERS "Install unsupported xpdf headers." OFF)
+option(BUILD_GTK_TESTS "Whether compile the GTK+ test programs." OFF)
+option(BUILD_QT3_TESTS "Whether compile the Qt3 test programs." OFF)
+option(BUILD_QT4_TESTS "Whether compile the Qt4 test programs." OFF)
+option(ENABLE_SPLASH "Build the Splash graphics backend." ON)
+option(ENABLE_UTILS "Compile poppler command line utils." ON)
+option(ENABLE_ABIWORD "Build the Abiword backend." ON)
+option(ENABLE_ZLIB "TODO" OFF)
+option(USE_EXCEPTIONS "Throw exceptions to deal with not enough memory and similar problems." OFF)
+option(USE_FIXEDPOINT "Use fixed point arithmetic" OFF)
+
+# Enable these unconditionally.
+set(MULTITHREAD ON)
+set(OPI_SUPPORT ON)
+set(TEXTOUT_WORD_LIST ON)
+
+# setting the minimum required versions for some components
+set(QT3_MIN_VERSION "3.3.0")
+set(QT4_MIN_VERSION "4.1.0")
+set(CAIRO_VERSION "1.4")
+
+# set the default compile warnings
+if(CMAKE_COMPILER_IS_GNUCXX)
+  set(DEFAULT_COMPILE_WARNINGS_NO)
+  set(DEFAULT_COMPILE_WARNINGS_YES "-Wall -Wno-write-strings")
+  set(DEFAULT_COMPILE_WARNINGS_KDE "-Wnon-virtual-dtor -Wno-long-long -Wundef -ansi -D_XOPEN_SOURCE=500 -D_BSD_SOURCE -Wcast-align -Wconversion -Wchar-subscripts -Wall -W -Wpointer-arith -Wwrite-strings -O2 -Wformat-security -Wmissing-format-attribute -fno-exceptions -fno-check-new -fno-common")
+endif(CMAKE_COMPILER_IS_GNUCXX)
+
+find_package(Freetype REQUIRED)
+find_package(Fontconfig REQUIRED)
+if(MSVC)
+find_package(kdewin32 REQUIRED)
+include_directories( ${CMAKE_INCLUDE_PATH}/msvc )
+add_definitions(-D_CRT_SECURE_NO_WARNINGS)
+endif(MSVC)
+macro_optional_find_package(JPEG)
+macro_optional_find_package(Qt3)
+macro_optional_find_package(Qt4)
+macro_optional_find_package(GTK)
+if(GLIB_FOUND)
+  macro_optional_find_package(Cairo)
+  set(HAVE_CAIRO CAIRO_FOUND)
+  if(CAIRO_FOUND)
+    set(CAIRO_REQ "cairo")
+  endif(CAIRO_FOUND)
+endif(GLIB_FOUND)
+if(ENABLE_ZLIB)
+  find_package(ZLIB)
+  set(ENABLE_ZLIB ${ZLIB_FOUND})
+endif(ENABLE_ZLIB)
+if(ENABLE_ABIWORD)
+  find_package(LibXml2)
+  set(ENABLE_ABIWORD ${LIBXML2_FOUND})
+endif(ENABLE_ABIWORD)
+
+add_definitions(-DHAVE_CONFIG_H=1 ${FONTCONFIG_DEFINITIONS})
+include_directories(
+  ${CMAKE_CURRENT_SOURCE_DIR}
+  ${CMAKE_CURRENT_SOURCE_DIR}/fofi
+  ${CMAKE_CURRENT_SOURCE_DIR}/goo
+  ${CMAKE_CURRENT_SOURCE_DIR}/poppler
+  ${CMAKE_CURRENT_BINARY_DIR}
+  ${CMAKE_CURRENT_BINARY_DIR}/poppler
+  ${FREETYPE_INCLUDE_DIR}
+)
+set(HAVE_FREETYPE_H ON)
+
+if(ENABLE_ZLIB)
+  include_directories(${ZLIB_INCLUDE_DIR})
+endif(ENABLE_ZLIB)
+if(JPEG_FOUND)
+  include_directories(${JPEG_INCLUDE_DIR})
+  set(ENABLE_LIBJPEG ON)
+endif(JPEG_FOUND)
+if(ENABLE_ABIWORD)
+  include_directories(${LIBXML2_INCLUDE_DIR})
+  add_definitions(${LIBXML2_DEFINITIONS})
+endif(ENABLE_ABIWORD)
+
+if(DEFINED COMPILE_WARNINGS)
+else(DEFINED COMPILE_WARNINGS)
+  set(COMPILE_WARNINGS "yes")
+endif(DEFINED COMPILE_WARNINGS)
+string(TOLOWER "${COMPILE_WARNINGS}" _comp_warnings)
+if(_comp_warnings STREQUAL "no")
+  add_definitions(${DEFAULT_COMPILE_WARNINGS_NO})
+endif(_comp_warnings STREQUAL "no")
+if(_comp_warnings STREQUAL "yes")
+  add_definitions(${DEFAULT_COMPILE_WARNINGS_YES})
+endif(_comp_warnings STREQUAL "yes")
+if(_comp_warnings STREQUAL "kde")
+  set(CMAKE_CXX_FLAGS "${DEFAULT_COMPILE_WARNINGS_KDE} ${CMAKE_CXX_FLAGS}")
+endif(_comp_warnings STREQUAL "kde")
+
+
+include(ConfigureChecks.cmake)
+configure_file(config.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config.h)
+configure_file(poppler-config.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/poppler/poppler-config.h)
+
+
+set(poppler_SRCS
+  goo/gfile.cc
+  goo/gmempp.cc
+  goo/GooHash.cc
+  goo/GooList.cc
+  goo/GooTimer.cc
+  goo/GooString.cc
+  goo/gmem.cc
+  goo/FixedPoint.cc
+  fofi/FoFiBase.cc
+  fofi/FoFiBase.h
+  fofi/FoFiEncodings.cc
+  fofi/FoFiEncodings.h
+  fofi/FoFiTrueType.cc
+  fofi/FoFiTrueType.h
+  fofi/FoFiType1.cc
+  fofi/FoFiType1.h
+  fofi/FoFiType1C.cc
+  fofi/FoFiType1C.h
+  poppler/Annot.cc
+  poppler/Array.cc
+  poppler/BuiltinFont.cc
+  poppler/BuiltinFontTables.cc
+  poppler/Catalog.cc
+  poppler/CharCodeToUnicode.cc
+  poppler/CMap.cc
+  poppler/Decrypt.cc
+  poppler/Dict.cc
+  poppler/Error.cc
+  poppler/FontEncodingTables.cc
+  poppler/Form.cc
+  poppler/FontInfo.cc
+  poppler/Function.cc
+  poppler/Gfx.cc
+  poppler/GfxFont.cc
+  poppler/GfxState.cc
+  poppler/GlobalParams.cc
+  poppler/JArithmeticDecoder.cc
+  poppler/JBIG2Stream.cc
+  poppler/JPXStream.cc
+  poppler/Lexer.cc
+  poppler/Link.cc
+  poppler/NameToCharCode.cc
+  poppler/Object.cc
+  poppler/Outline.cc
+  poppler/OutputDev.cc
+  poppler/Page.cc
+  poppler/PageTransition.cc
+  poppler/Parser.cc
+  poppler/PDFDoc.cc
+  poppler/PDFDocEncoding.cc
+  poppler/ProfileData.cc
+  poppler/PreScanOutputDev.cc
+  poppler/PSTokenizer.cc
+  poppler/Stream.cc
+  poppler/UnicodeMap.cc
+  poppler/UnicodeTypeTable.cc
+  poppler/XRef.cc
+  poppler/PSOutputDev.cc
+  poppler/TextOutputDev.cc
+  poppler/PageLabelInfo.cc
+  poppler/SecurityHandler.cc
+  poppler/Sound.cc
+  poppler/XpdfPluginAPI.cc
+)
+set(poppler_LIBS ${FREETYPE_LIBRARIES} ${FONTCONFIG_LIBRARIES})
+if(ENABLE_SPLASH)
+  set(poppler_SRCS ${poppler_SRCS}
+    poppler/SplashOutputDev.cc
+    splash/Splash.cc
+    splash/SplashBitmap.cc
+    splash/SplashClip.cc
+    splash/SplashFTFont.cc
+    splash/SplashFTFontEngine.cc
+    splash/SplashFTFontFile.cc
+    splash/SplashFont.cc
+    splash/SplashFontEngine.cc
+    splash/SplashFontFile.cc
+    splash/SplashFontFileID.cc
+    splash/SplashPath.cc
+    splash/SplashPattern.cc
+    splash/SplashScreen.cc
+    splash/SplashState.cc
+    splash/SplashT1Font.cc
+    splash/SplashT1FontEngine.cc
+    splash/SplashT1FontFile.cc
+    splash/SplashXPath.cc
+    splash/SplashXPathScanner.cc
+  )
+endif(ENABLE_SPLASH)
+if(JPEG_FOUND)
+  set(poppler_SRCS ${poppler_SRCS}
+    poppler/DCTStream.cc
+  )
+  set(poppler_LIBS ${poppler_LIBS} ${JPEG_LIBRARIES})
+endif(JPEG_FOUND)
+if(ENABLE_ZLIB)
+  set(poppler_SRCS ${poppler_SRCS}
+    poppler/FlateStream.cc
+  )
+  set(poppler_LIBS ${poppler_LIBS} ${ZLIB_LIBRARIES})
+endif(ENABLE_ZLIB)
+if(ENABLE_ABIWORD)
+  set(poppler_SRCS ${poppler_SRCS}
+    poppler/ABWOutputDev.cc
+  )
+  set(poppler_LIBS ${poppler_LIBS} ${LIBXML2_LIBRARIES})
+endif(ENABLE_ABIWORD)
+if(WIN32)
+    # gdi32 is needed under win32
+    set(poppler_LIBS ${poppler_LIBS} gdi32)
+    if(MSVC)
+        set(poppler_LIBS ${poppler_LIBS} ${KDEWIN32_LIBRARY})
+    endif(MSVC)
+endif(WIN32)
+add_library(poppler SHARED ${poppler_SRCS})
+set_target_properties(poppler PROPERTIES VERSION 2.0.0 SOVERSION 2)
+target_link_libraries(poppler ${poppler_LIBS})
+install(TARGETS poppler RUNTIME DESTINATION bin LIBRARY DESTINATION lib ARCHIVE DESTINATION lib)
+if(MSVC)
+#	add_library(poppler_STATIC STATIC ${poppler_SRCS})
+#	set_target_properties(poppler_STATIC PROPERTIES output_name poppler)
+endif(MSVC)
+if(ENABLE_XPDF_HEADERS)
+  install(FILES
+    goo/GooHash.h
+    goo/GooList.h
+    goo/GooTimer.h
+    goo/GooMutex.h
+    goo/GooString.h
+    goo/GooVector.h
+    goo/gtypes.h
+    goo/gmem.h
+    goo/gfile.h
+    goo/FixedPoint.h
+    poppler/Annot.h
+    poppler/Array.h
+    poppler/BaseFile.h
+    poppler/BuiltinFont.h
+    poppler/BuiltinFontTables.h
+    poppler/Catalog.h
+    poppler/CharCodeToUnicode.h
+    poppler/CMap.h
+    poppler/Decrypt.h
+    poppler/Dict.h
+    poppler/Error.h
+    poppler/FontEncodingTables.h
+    poppler/FontInfo.h
+    poppler/Form.h
+    poppler/Function.cc
+    poppler/Function.h
+    poppler/Gfx.h
+    poppler/GfxFont.h
+    poppler/GfxState.h
+    poppler/GlobalParams.h
+    poppler/JArithmeticDecoder.h
+    poppler/JBIG2Stream.h
+    poppler/JPXStream.h
+    poppler/Lexer.h
+    poppler/Link.h
+    poppler/NameToCharCode.h
+    poppler/Object.h
+    poppler/Outline.h
+    poppler/OutputDev.h
+    poppler/Page.h
+    poppler/PageTransition.h
+    poppler/Parser.h
+    poppler/PDFDoc.h
+    poppler/PDFDocEncoding.h
+    poppler/ProfileData.h
+    poppler/PreScanOutputDev.h
+    poppler/PSTokenizer.h
+    poppler/Stream-CCITT.h
+    poppler/Stream.h
+    poppler/UnicodeMap.h
+    poppler/UnicodeMapTables.h
+    poppler/UnicodeTypeTable.h
+    poppler/UnicodeCClassTables.h
+    poppler/UnicodeCompTables.h
+    poppler/UnicodeDecompTables.h
+    poppler/XRef.h
+    poppler/CharTypes.h
+    poppler/CompactFontTables.h
+    poppler/ErrorCodes.h
+    poppler/NameToUnicodeTable.h
+    poppler/PSOutputDev.h
+    poppler/TextOutputDev.h
+    poppler/SecurityHandler.h
+    poppler/UTF8.h
+    poppler/XpdfPluginAPI.h
+    poppler/Sound.h
+    ${CMAKE_CURRENT_BINARY_DIR}/poppler/poppler-config.h
+    DESTINATION include/poppler)
+  if(ENABLE_SPLASH)
+    install(FILES
+      poppler/SplashOutputDev.h
+      DESTINATION include/poppler)
+    install(FILES
+      splash/Splash.h
+      splash/SplashBitmap.h
+      splash/SplashClip.h
+      splash/SplashErrorCodes.h
+      splash/SplashFTFont.h
+      splash/SplashFTFontEngine.h
+      splash/SplashFTFontFile.h
+      splash/SplashFont.h
+      splash/SplashFontEngine.h
+      splash/SplashFontFile.h
+      splash/SplashFontFileID.h
+      splash/SplashGlyphBitmap.h
+      splash/SplashMath.h
+      splash/SplashPath.h
+      splash/SplashPattern.h
+      splash/SplashScreen.h
+      splash/SplashState.h
+      splash/SplashT1Font.h
+      splash/SplashT1FontEngine.h
+      splash/SplashT1FontFile.h
+      splash/SplashTypes.h
+      splash/SplashXPath.h
+      splash/SplashXPathScanner.h
+      DESTINATION include/poppler/splash)
+  endif(ENABLE_SPLASH)
+endif(ENABLE_XPDF_HEADERS)
+
+
+if(ENABLE_UTILS)
+  add_subdirectory(utils)
+endif(ENABLE_UTILS)
+if(GLIB_FOUND)
+  add_subdirectory(glib)
+endif(GLIB_FOUND)
+if(QT3_FOUND)
+  add_subdirectory(qt)
+endif(QT3_FOUND)
+add_subdirectory(test)
+if(QT4_FOUND)
+  add_subdirectory(qt4)
+endif(QT4_FOUND)
+
+
+poppler_create_install_pkgconfig(poppler.pc lib/pkgconfig)
+if(ENABLE_SPLASH)
+  poppler_create_install_pkgconfig(poppler-splash.pc lib/pkgconfig)
+endif(ENABLE_SPLASH)
+if(QT3_FOUND)
+  poppler_create_install_pkgconfig(poppler-qt.pc lib/pkgconfig)
+endif(QT3_FOUND)
+if(QT4_FOUND)
+  poppler_create_install_pkgconfig(poppler-qt4.pc lib/pkgconfig)
+endif(QT4_FOUND)
+# if(GLIB_FOUND) ### FIXME
+#   poppler_create_install_pkgconfig(poppler-glib.pc lib/pkgconfig)
+# endif(GLIB_FOUND)
+if(CAIRO_FOUND)
+  poppler_create_install_pkgconfig(poppler-cairo.pc lib/pkgconfig)
+endif(CAIRO_FOUND)
+if(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/../poppler-data)
+set(POPPLER_DATA_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../poppler-data)
+include(${CMAKE_CURRENT_SOURCE_DIR}/../poppler-data/CMakeLists.txt)
+endif(EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/../poppler-data)
+
+message("Building poppler with support for:")
+show_end_message("splash output" ENABLE_SPLASH)
+show_end_message("cairo output" CAIRO_FOUND)
+show_end_message("abiword output" ENABLE_ABIWORD)
+show_end_message("qt wrapper" QT3_FOUND)
+show_end_message("qt4 wrapper" QT4_FOUND)
+show_end_message("glib wrapper" GLIB_FOUND)
+# message("  use gtk-doc:        $enable_gtk_doc") ###
diff -N -r -u poppler-0.6.4-orig/config.h.cmake poppler-0.6.4/config.h.cmake
--- poppler-0.6.4-orig/config.h.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/config.h.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,152 @@
+/* config.h.  Generated from config.h.cmake by cmake.  */
+
+/* Use libjpeg instead of builtin jpeg decoder. */
+#cmakedefine ENABLE_LIBJPEG 1
+
+/* Use zlib instead of builtin zlib decoder. */
+#cmakedefine ENABLE_ZLIB 1
+
+/* Use cairo for rendering. */
+#cmakedefine HAVE_CAIRO 1
+
+/* Define to 1 if you have the <dirent.h> header file, and it defines `DIR'. */
+#cmakedefine HAVE_DIRENT_H 1
+
+/* Define to 1 if you have the <dlfcn.h> header file. */
+#cmakedefine HAVE_DLFCN_H 1
+
+/* Have FreeType2 include files */
+#cmakedefine HAVE_FREETYPE_H 1
+
+/* Define to 1 if you have the `fseek64' function. */
+#cmakedefine HAVE_FSEEK64 1
+
+/* Define to 1 if fseeko (and presumably ftello) exists and is declared. */
+#cmakedefine HAVE_FSEEKO 1
+
+/* Define to 1 if you have the `ftell64' function. */
+#cmakedefine HAVE_FTELL64 1
+
+/* Defines if gettimeofday is available on your system */
+#cmakedefine HAVE_GETTIMEOFDAY 1
+
+/* Define to 1 if you have the <inttypes.h> header file. */
+#cmakedefine HAVE_INTTYPES_H 1
+
+/* Define to 1 if you have the `z' library (-lz). */
+#cmakedefine HAVE_LIBZ 1
+
+/* Define to 1 if you have the <memory.h> header file. */
+#cmakedefine HAVE_MEMORY_H 1
+
+/* Define to 1 if you have the `mkstemp' function. */
+#cmakedefine HAVE_MKSTEMP 1
+
+/* Define to 1 if you have the `mkstemps' function. */
+#cmakedefine HAVE_MKSTEMPS 1
+
+/* Define to 1 if you have the <ndir.h> header file, and it defines `DIR'. */
+#cmakedefine HAVE_NDIR_H 1
+
+/* Define to 1 if you have the `popen' function. */
+#cmakedefine HAVE_POPEN 1
+
+/* Use splash for rendering. */
+#cmakedefine HAVE_SPLASH 1
+
+/* Define to 1 if you have the <stdint.h> header file. */
+#cmakedefine HAVE_STDINT_H 1
+
+/* Define to 1 if you have the <stdlib.h> header file. */
+#cmakedefine HAVE_STDLIB_H 1
+
+/* Define to 1 if you have the <strings.h> header file. */
+#cmakedefine HAVE_STRINGS_H 1
+
+/* Define to 1 if you have the <string.h> header file. */
+#cmakedefine HAVE_STRING_H 1
+
+/* Define to 1 if you have the <sys/dir.h> header file, and it defines `DIR'. */
+#cmakedefine HAVE_SYS_DIR_H 1
+
+/* Define to 1 if you have the <sys/ndir.h> header file, and it defines `DIR'. */
+#cmakedefine HAVE_SYS_NDIR_H 1
+
+/* Define to 1 if you have the <sys/stat.h> header file. */
+#cmakedefine HAVE_SYS_STAT_H 1
+
+/* Define to 1 if you have the <sys/types.h> header file. */
+#cmakedefine HAVE_SYS_TYPES_H 1
+
+/* Define to 1 if you have the <unistd.h> header file. */
+#cmakedefine HAVE_UNISTD_H 1
+
+/* Define to 1 if you have the <zlib.h> header file. */
+#cmakedefine HAVE_ZLIB_H 1
+
+/* Enable multithreading support. */
+#cmakedefine MULTITHREADED 1
+
+/* Generate OPI comments in PS output. */
+#cmakedefine OPI_SUPPORT 1
+
+/* Name of package */
+#define PACKAGE "poppler"
+
+/* Define to the address where bug reports for this package should be sent. */
+#define PACKAGE_BUGREPORT ""
+
+/* Define to the full name of this package. */
+#define PACKAGE_NAME "poppler"
+
+/* Define to the full name and version of this package. */
+#define PACKAGE_STRING "poppler ${POPPLER_VERSION}"
+
+/* Define to the one symbol short name of this package. */
+#define PACKAGE_TARNAME "poppler"
+
+/* Define to the version of this package. */
+#define PACKAGE_VERSION "${POPPLER_VERSION}"
+
+/* Poppler data dir */
+#define POPPLER_DATADIR "${CMAKE_INSTALL_PREFIX}/share/poppler"
+
+/* Define to 1 if you have the ANSI C header files. */
+#define STDC_HEADERS 1
+
+/* Enable word list support. */
+#cmakedefine TEXTOUT_WORD_LIST 1
+
+/* Throw exceptions to deal with not enough memory and similar problems */
+#cmakedefine USE_EXCEPTIONS 1
+
+/* Use fixed point arithmetic */
+#cmakedefine USE_FIXEDPOINT 1
+
+/* Version number of package */
+#define VERSION "${POPPLER_VERSION}"
+
+/* Define to 1 if the X Window System is missing or not being used. */
+/* #undef X_DISPLAY_MISSING */
+
+/*
+ * jpeg.h needs HAVE_BOOLEAN, when the system uses boolean in system
+ * headers and I'm too lazy to write a configure test as long as only
+ * unixware is related
+ */
+#ifdef _UNIXWARE
+#define HAVE_BOOLEAN
+#endif
+
+#ifdef _MSC_VER
+#include <winsock2.h>
+#endif
+
+/* Number of bits in a file offset, on hosts where this is settable. */
+/* #undef _FILE_OFFSET_BITS */
+
+/* Define to 1 to make fseeko visible on some hosts (e.g. glibc 2.2). */
+/* #undef _LARGEFILE_SOURCE */
+
+/* Define for large files, on AIX-style hosts. */
+/* #undef _LARGE_FILES */
diff -N -r -u poppler-0.6.4-orig/ConfigureChecks.cmake poppler-0.6.4/ConfigureChecks.cmake
--- poppler-0.6.4-orig/ConfigureChecks.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/ConfigureChecks.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,54 @@
+include(CheckIncludeFile)
+include(CheckIncludeFiles)
+include(CheckSymbolExists)
+include(CheckFunctionExists)
+include(CheckLibraryExists)
+include(CheckTypeSize)
+include(CheckCSourceCompiles)
+include(MacroBoolTo01)
+
+set(CMAKE_REQUIRED_INCLUDES ${CMAKE_INCLUDE_PATH} ${CMAKE_INCLUDE_PATH}/msvc )
+check_include_files(dlfcn.h HAVE_DLFCN_H)
+check_include_files(inttypes.h HAVE_INTTYPES_H)
+check_include_files(memory.h HAVE_MEMORY_H)
+check_include_files(stdint.h HAVE_STDINT_H)
+check_include_files(stdlib.h HAVE_STDLIB_H)
+check_include_files(strings.h HAVE_STRINGS_H)
+check_include_files(string.h HAVE_STRING_H)
+check_include_files(sys/stat.h HAVE_SYS_STAT_H)
+check_include_files(sys/types.h HAVE_SYS_TYPES_H)
+check_include_files(unistd.h HAVE_UNISTD_H)
+if (ZLIB_FOUND)
+  set(HAVE_LIBZ ZLIB_FOUND)
+endif (ZLIB_FOUND)
+if (JPEG_FOUND)
+  set(ENABLE_LIBJPEG JPEG_FOUND)
+endif(JPEG_FOUND)
+
+macro_bool_to_01(FREETYPE_FOUND HAVE_FREETYPE_H)
+macro_bool_to_01(ENABLE_SPLASH HAVE_SPLASH)
+
+check_function_exists(fseek64 HAVE_FSEEK64)
+check_function_exists(fseeko HAVE_FSEEKO)
+check_function_exists(ftell64 HAVE_FTELL64)
+check_function_exists(gettimeofday HAVE_GETTIMEOFDAY)
+check_function_exists(popen HAVE_POPEN)
+check_function_exists(mkstemp HAVE_MKSTEMP)
+check_function_exists(mkstemps HAVE_MKSTEMPS)
+
+set(CMAKE_REQUIRED_INCLUDES ${CMAKE_INCLUDE_PATH} ${CMAKE_INCLUDE_PATH}/msvc )
+macro(CHECK_FOR_DIR include var)
+  check_c_source_compiles(
+    "#include <${include}>
+
+int main(int argc, char *argv[])
+{
+  DIR* d = 0;
+  return 0;
+}
+" ${var})
+endmacro(CHECK_FOR_DIR)
+check_for_dir("dirent.h" HAVE_DIRENT_H)
+check_for_dir("ndir.h" HAVE_NDIR_H)
+check_for_dir("sys/dir.h" HAVE_SYS_DIR_H)
+check_for_dir("sys/ndir.h" HAVE_SYS_NDIR_H)
diff -N -r -u poppler-0.6.4-orig/fofi/FoFiBase.h poppler-0.6.4/fofi/FoFiBase.h
--- poppler-0.6.4-orig/fofi/FoFiBase.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/fofi/FoFiBase.h	2008-02-10 23:41:58.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef FOFIBASE_H
 #define FOFIBASE_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -23,7 +25,7 @@
 // FoFiBase
 //------------------------------------------------------------------------
 
-class FoFiBase {
+class poppler_EXPORT FoFiBase {
 public:
 
   virtual ~FoFiBase();
diff -N -r -u poppler-0.6.4-orig/fofi/FoFiTrueType.h poppler-0.6.4/fofi/FoFiTrueType.h
--- poppler-0.6.4-orig/fofi/FoFiTrueType.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/fofi/FoFiTrueType.h	2008-02-10 23:41:58.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef FOFITRUETYPE_H
 #define FOFITRUETYPE_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -25,7 +27,7 @@
 // FoFiTrueType
 //------------------------------------------------------------------------
 
-class FoFiTrueType: public FoFiBase {
+class poppler_EXPORT FoFiTrueType: public FoFiBase {
 public:
 
   // Create a FoFiTrueType object from a memory buffer.
diff -N -r -u poppler-0.6.4-orig/fofi/FoFiType1.h poppler-0.6.4/fofi/FoFiType1.h
--- poppler-0.6.4-orig/fofi/FoFiType1.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/fofi/FoFiType1.h	2008-02-10 23:41:58.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef FOFITYPE1_H
 #define FOFITYPE1_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -20,7 +22,7 @@
 // FoFiType1
 //------------------------------------------------------------------------
 
-class FoFiType1: public FoFiBase {
+class poppler_EXPORT FoFiType1: public FoFiBase {
 public:
 
   // Create a FoFiType1 object from a memory buffer.
diff -N -r -u poppler-0.6.4-orig/fofi/FoFiType1C.h poppler-0.6.4/fofi/FoFiType1C.h
--- poppler-0.6.4-orig/fofi/FoFiType1C.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/fofi/FoFiType1C.h	2008-02-10 23:41:58.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef FOFITYPE1C_H
 #define FOFITYPE1C_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -129,7 +131,7 @@
 // FoFiType1C
 //------------------------------------------------------------------------
 
-class FoFiType1C: public FoFiBase {
+class poppler_EXPORT FoFiType1C: public FoFiBase {
 public:
 
   // Create a FoFiType1C object from a memory buffer.
diff -N -r -u poppler-0.6.4-orig/glib/CMakeLists.txt poppler-0.6.4/glib/CMakeLists.txt
--- poppler-0.6.4-orig/glib/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/glib/CMakeLists.txt	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,107 @@
+add_definitions(-DG_LOG_DOMAIN=\\"Poppler\\" ${GLIB2_CFLAGS})
+
+include_directories(
+  ${CMAKE_CURRENT_SOURCE_DIR}
+  ${CMAKE_CURRENT_BINARY_DIR}
+)
+if (CAIRO_FOUND)
+  include_directories(${CAIRO_INCLUDES})
+  set (CAIRO_FEATURE "#define POPPLER_HAS_CAIRO 1")
+  add_definitions(${CAIRO_CFLAGS})
+else (CAIRO_FOUND)
+  set (CAIRO_FEATURE "#undef POPPLER_HAS_CAIRO")
+endif (CAIRO_FOUND)
+
+configure_file(poppler-features.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/poppler-features.h)
+
+if (GTK_FOUND)
+  add_subdirectory(demo)
+endif (GTK_FOUND)
+
+set(poppler_glib_public_headers
+  poppler-action.h
+  poppler-document.h
+  poppler-page.h
+  poppler-attachment.h
+  poppler-form-field.h
+  poppler.h
+)
+
+find_program(GLIB2_MKENUMS glib-mkenums)
+
+add_custom_command(
+  OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/poppler-enums.h
+  COMMAND ${GLIB2_MKENUMS}
+  ARGS
+    --fhead \"\#ifndef __POPPLER_TYPE_ENUMS_H__\\n\"
+    --fhead \"\#define __POPPLER_TYPE_ENUMS_H__ 1\\n\\n\"
+    --fhead \"\#include <glib-object.h>\\n\\n\"
+    --fhead \"G_BEGIN_DECLS\\n\\n\"
+    --ftail \"G_END_DECLS\\n\\n\"
+    --ftail \"\#endif /* __POPPLER_TYPE_ENUMS_H__ */\\n\"
+    --fprod \"\\n/* --- @filename@ --- */\"
+    --eprod \"\#define POPPLER_TYPE_@ENUMSHORT@ \(@enum_name@_get_type\(\)\)\\n\"
+    --eprod \"GType @enum_name@_get_type \(void\) G_GNUC_CONST\;\\n\"
+    ${poppler_glib_public_headers} > ${CMAKE_CURRENT_BINARY_DIR}/poppler-enums.h
+  WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
+  DEPENDS ${poppler_glib_public_headers}
+)
+
+add_custom_command(
+  OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/poppler-enums.c
+  COMMAND ${GLIB2_MKENUMS}
+  ARGS
+    --fhead \"\#include \\"poppler-enums.h\\"\\n\\n\"
+    --fprod \"\\n/* enumerations from \\"@filename@\\" */\"
+    --fprod \"\\n\#include \\"@filename@\\"\"
+    --vhead \"static const G@Type@Value _@enum_name@_values[] = {\"
+    --vprod \"  { @VALUENAME@, \\"@VALUENAME@\\", \\"@valuenick@\\" },\"
+    --vtail \"  { 0, NULL, NULL }\\n}\;\\n\\n\"
+    --vtail \"GType\\n@enum_name@_get_type \(void\)\\n{\\n\"
+    --vtail \"  static GType type = 0\;\\n\\n\"
+    --vtail \"  if \(G_UNLIKELY \(type == 0\)\)\\n\"
+    --vtail \"    type = g_\@type\@_register_static \(\\"@EnumName@\\", _@enum_name@_values\)\;\\n\\n\"
+    --vtail \"  return type\;\\n}\\n\\n\"
+    ${poppler_glib_public_headers} > ${CMAKE_CURRENT_BINARY_DIR}/poppler-enums.c
+  WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
+  DEPENDS ${poppler_glib_public_headers} ${CMAKE_CURRENT_BINARY_DIR}/poppler-enums.h
+)
+
+
+set(poppler_glib_SRCS
+  poppler-action.cc
+  poppler-document.cc
+  poppler-page.cc
+  poppler-attachment.cc
+  poppler-form-field.cc
+  poppler.cc
+  ${CMAKE_CURRENT_BINARY_DIR}/poppler-enums.c
+)
+if (CAIRO_FOUND)
+  set(poppler_glib_SRCS ${poppler_glib_SRCS}
+    ${CMAKE_SOURCE_DIR}/poppler/CairoFontEngine.cc
+    ${CMAKE_SOURCE_DIR}/poppler/CairoOutputDev.cc
+  )
+endif (CAIRO_FOUND)
+add_library(poppler-glib SHARED ${poppler_glib_SRCS})
+set_target_properties(poppler-glib PROPERTIES VERSION 2.0.0 SOVERSION 2)
+target_link_libraries(poppler-glib poppler ${GLIB2_LIBRARIES})
+if (CAIRO_FOUND)
+  target_link_libraries(poppler-glib ${CAIRO_LIBRARIES})
+endif (CAIRO_FOUND)
+install(TARGETS poppler-glib DESTINATION lib)
+
+install(FILES
+  ${poppler_glib_public_headers}
+  ${CMAKE_CURRENT_BINARY_DIR}/poppler-enums.h
+  ${CMAKE_CURRENT_BINARY_DIR}/poppler-features.h
+  DESTINATION include/poppler/glib)
+
+
+
+set(test_poppler_glib_SRCS
+  test-poppler-glib.cc
+)
+poppler_add_test(test-poppler-glib BUILD_GTK_TESTS ${test_poppler_glib_SRCS})
+target_link_libraries(test-poppler-glib poppler-glib)
+
diff -N -r -u poppler-0.6.4-orig/glib/demo/CMakeLists.txt poppler-0.6.4/glib/demo/CMakeLists.txt
--- poppler-0.6.4-orig/glib/demo/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/glib/demo/CMakeLists.txt	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,16 @@
+
+add_definitions(${GTK2_CFLAGS})
+
+set(poppler_glib_demo_SRCS
+  main.c
+  fonts.c
+  forms.c
+  info.c
+  links.c
+  outline.c
+  page.c
+  render.c
+  utils.c
+)
+poppler_add_test(poppler-glib-demo BUILD_GTK_TESTS ${poppler_glib_demo_SRCS})
+target_link_libraries(poppler-glib-demo poppler-glib ${GTK2_LIBRARIES})
diff -N -r -u poppler-0.6.4-orig/glib/poppler-features.h.cmake poppler-0.6.4/glib/poppler-features.h.cmake
--- poppler-0.6.4-orig/glib/poppler-features.h.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/glib/poppler-features.h.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,24 @@
+/* poppler-features.h: glib interface to poppler
+ * Copyright (C) 2006, Red Hat, Inc.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2, or (at your option)
+ * any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA 02110-1301, USA.
+ */
+
+#ifndef __POPPLER_FEATURES_H__
+#define __POPPLER_FEATURES_H__
+
+${CAIRO_FEATURE}
+
+#endif /* __POPPLER_FEATURES_H__ */
diff -N -r -u poppler-0.6.4-orig/goo/FixedPoint.h poppler-0.6.4/goo/FixedPoint.h
--- poppler-0.6.4-orig/goo/FixedPoint.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/goo/FixedPoint.h	2008-02-10 23:28:48.000000000 +0100
@@ -11,6 +11,8 @@
 #ifndef FIXEDPOINT_H
 #define FIXEDPOINT_H
 
+#include <poppler/poppler-export.h>
+
 #include <poppler/poppler-config.h>
 
 #if USE_FIXEDPOINT
@@ -29,7 +31,7 @@
 
 typedef long long FixPtInt64;
 
-class FixedPoint {
+class poppler_EXPORT FixedPoint {
 public:
 
   FixedPoint() { val = 0; }
diff -N -r -u poppler-0.6.4-orig/goo/gfile.h poppler-0.6.4/goo/gfile.h
--- poppler-0.6.4-orig/goo/gfile.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/goo/gfile.h	2008-02-11 00:36:30.000000000 +0100
@@ -48,6 +48,8 @@
 #  endif
 #endif
 }
+#include <poppler/poppler-export.h>
+
 #include "gtypes.h"
 
 class GooString;
@@ -55,29 +57,29 @@
 //------------------------------------------------------------------------
 
 // Get home directory path.
-extern GooString *getHomeDir();
+extern poppler_EXPORT GooString *getHomeDir();
 
 // Get current directory.
-extern GooString *getCurrentDir();
+extern poppler_EXPORT GooString *getCurrentDir();
 
 // Append a file name to a path string.  <path> may be an empty
 // string, denoting the current directory).  Returns <path>.
-extern GooString *appendToPath(GooString *path, char *fileName);
+extern poppler_EXPORT GooString *appendToPath(GooString *path, char *fileName);
 
 // Grab the path from the front of the file name.  If there is no
 // directory component in <fileName>, returns an empty string.
-extern GooString *grabPath(char *fileName);
+extern poppler_EXPORT GooString *grabPath(char *fileName);
 
 // Is this an absolute path or file name?
-extern GBool isAbsolutePath(char *path);
+extern poppler_EXPORT GBool isAbsolutePath(char *path);
 
 // Make this path absolute by prepending current directory (if path is
 // relative) or prepending user's directory (if path starts with '~').
-extern GooString *makePathAbsolute(GooString *path);
+extern poppler_EXPORT GooString *makePathAbsolute(GooString *path);
 
 // Get the modification time for <fileName>.  Returns 0 if there is an
 // error.
-extern time_t getModTime(char *fileName);
+extern poppler_EXPORT time_t getModTime(char *fileName);
 
 // Create a temporary file and open it for writing.  If <ext> is not
 // NULL, it will be used as the file name extension.  Returns both the
@@ -85,20 +87,20 @@
 // should be done to the returned file pointer; the file may be
 // reopened later for reading, but not for writing.  The <mode> string
 // should be "w" or "wb".  Returns true on success.
-extern GBool openTempFile(GooString **name, FILE **f, char *mode, char *ext);
+extern poppler_EXPORT GBool openTempFile(GooString **name, FILE **f, char *mode, char *ext);
 
 // Execute <command>.  Returns true on success.
-extern GBool executeCommand(char *cmd);
+extern poppler_EXPORT GBool executeCommand(char *cmd);
 
 // Just like fgets, but handles Unix, Mac, and/or DOS end-of-line
 // conventions.
-extern char *getLine(char *buf, int size, FILE *f);
+extern poppler_EXPORT char *getLine(char *buf, int size, FILE *f);
 
 //------------------------------------------------------------------------
 // GDir and GDirEntry
 //------------------------------------------------------------------------
 
-class GDirEntry {
+class poppler_EXPORT GDirEntry {
 public:
 
   GDirEntry(char *dirPath, char *nameA, GBool doStat);
@@ -114,7 +116,7 @@
   GBool dir;			// is it a directory?
 };
 
-class GDir {
+class poppler_EXPORT GDir {
 public:
 
   GDir(char *name, GBool doStatA = gTrue);
diff -N -r -u poppler-0.6.4-orig/goo/gmem.h poppler-0.6.4/goo/gmem.h
--- poppler-0.6.4-orig/goo/gmem.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/goo/gmem.h	2008-02-11 00:24:54.000000000 +0100
@@ -9,12 +9,14 @@
 #ifndef GMEM_H
 #define GMEM_H
 
+#include <poppler/poppler-export.h>
+
 #include <stdio.h>
 #include <poppler/poppler-config.h>
 
 #if USE_EXCEPTIONS
 
-class GMemException {
+class poppler_EXPORT GMemException {
 public:
   GMemException() {}
   ~GMemException() {}
@@ -36,13 +38,13 @@
  * Same as malloc, but prints error message and exits if malloc()
  * returns NULL.
  */
-extern void *gmalloc(size_t size) GMEM_EXCEP;
+extern poppler_EXPORT void *gmalloc(size_t size) GMEM_EXCEP;
 
 /*
  * Same as realloc, but prints error message and exits if realloc()
  * returns NULL.  If <p> is NULL, calls malloc instead of realloc().
  */
-extern void *grealloc(void *p, size_t size) GMEM_EXCEP;
+extern poppler_EXPORT void *grealloc(void *p, size_t size) GMEM_EXCEP;
 
 /*
  * These are similar to gmalloc and grealloc, but take an object count
@@ -52,20 +54,20 @@
  * The gmallocn_checkoverflow variant returns NULL instead of exiting
  * the application if a overflow is detected
  */
-extern void *gmallocn(int nObjs, int objSize) GMEM_EXCEP;
-extern void *gmallocn_checkoverflow(int nObjs, int objSize) GMEM_EXCEP;
-extern void *greallocn(void *p, int nObjs, int objSize) GMEM_EXCEP;
+extern poppler_EXPORT void *gmallocn(int nObjs, int objSize) GMEM_EXCEP;
+extern poppler_EXPORT void *gmallocn_checkoverflow(int nObjs, int objSize) GMEM_EXCEP;
+extern poppler_EXPORT void *greallocn(void *p, int nObjs, int objSize) GMEM_EXCEP;
 
 /*
  * Same as free, but checks for and ignores NULL pointers.
  */
-extern void gfree(void *p);
+extern poppler_EXPORT void gfree(void *p);
 
 #ifdef DEBUG_MEM
 /*
  * Report on unfreed memory.
  */
-extern void gMemReport(FILE *f);
+extern poppler_EXPORT void gMemReport(FILE *f);
 #else
 #define gMemReport(f)
 #endif
@@ -73,7 +75,7 @@
 /*
  * Allocate memory and copy a string into it.
  */
-extern char *copyString(char *s);
+extern poppler_EXPORT char *copyString(char *s);
 
 #ifdef __cplusplus
 }
diff -N -r -u poppler-0.6.4-orig/goo/GooHash.h poppler-0.6.4/goo/GooHash.h
--- poppler-0.6.4-orig/goo/GooHash.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/goo/GooHash.h	2008-02-10 23:28:48.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef GHASH_H
 #define GHASH_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -21,7 +23,7 @@
 
 //------------------------------------------------------------------------
 
-class GooHash {
+class poppler_EXPORT GooHash {
 public:
 
   GooHash(GBool deleteKeysA = gFalse);
diff -N -r -u poppler-0.6.4-orig/goo/GooList.h poppler-0.6.4/goo/GooList.h
--- poppler-0.6.4-orig/goo/GooList.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/goo/GooList.h	2008-02-10 23:28:48.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef GLIST_H
 #define GLIST_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -19,7 +21,7 @@
 // GooList
 //------------------------------------------------------------------------
 
-class GooList {
+class poppler_EXPORT GooList {
 public:
 
   // Create an empty list.
diff -N -r -u poppler-0.6.4-orig/goo/GooString.cc poppler-0.6.4/goo/GooString.cc
--- poppler-0.6.4-orig/goo/GooString.cc	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/goo/GooString.cc	2008-02-10 18:41:04.000000000 +0100
@@ -22,7 +22,9 @@
 #include <math.h>
 #include "gmem.h"
 #include "GooString.h"
-
+#undef ___QNAN
+#undef ___INFF
+#undef ___INFL
 //------------------------------------------------------------------------
 
 union GooStringFormatArg {
diff -N -r -u poppler-0.6.4-orig/goo/GooString.h poppler-0.6.4/goo/GooString.h
--- poppler-0.6.4-orig/goo/GooString.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/goo/GooString.h	2008-02-10 23:28:48.000000000 +0100
@@ -11,6 +11,8 @@
 #ifndef GooString_H
 #define GooString_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -19,7 +21,7 @@
 #include <stdlib.h> // for NULL
 #include "gtypes.h"
 
-class GooString {
+class poppler_EXPORT GooString {
 public:
 
   // Create an empty string.
diff -N -r -u poppler-0.6.4-orig/goo/GooTimer.h poppler-0.6.4/goo/GooTimer.h
--- poppler-0.6.4-orig/goo/GooTimer.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/goo/GooTimer.h	2008-02-10 23:28:48.000000000 +0100
@@ -11,6 +11,8 @@
 #ifndef GOOTIMER_H
 #define GOOTIMER_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -22,7 +24,7 @@
 // GooList
 //------------------------------------------------------------------------
 
-class GooTimer {
+class poppler_EXPORT GooTimer {
 public:
 
   // Create a new timer.
diff -N -r -u poppler-0.6.4-orig/goo/GooVector.h poppler-0.6.4/goo/GooVector.h
--- poppler-0.6.4-orig/goo/GooVector.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/goo/GooVector.h	2008-02-10 23:28:48.000000000 +0100
@@ -1,5 +1,8 @@
 #ifndef GOO_VECTOR_H
 #define GOO_VECTOR_H
+
+#include <poppler/poppler-export.h>
+
 #include "goo/gtypes.h"
 
 
diff -N -r -u poppler-0.6.4-orig/poppler/ABWOutputDev.h poppler-0.6.4/poppler/ABWOutputDev.h
--- poppler-0.6.4-orig/poppler/ABWOutputDev.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/ABWOutputDev.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef ABWOUTPUTDEV_H
 #define ABWOUTPUTDEV_H
 
+#include "poppler-export.h"
+
 #ifdef __GNUC__
 #pragma interface
 #endif
@@ -42,7 +44,7 @@
 // ABWOutputDev
 //------------------------------------------------------------------------
 
-class ABWOutputDev: public OutputDev {
+class poppler_EXPORT ABWOutputDev: public OutputDev {
 public:
 
   // Open a text output file.  If <fileName> is NULL, no file is written
diff -N -r -u poppler-0.6.4-orig/poppler/Annot.h poppler-0.6.4/poppler/Annot.h
--- poppler-0.6.4-orig/poppler/Annot.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/Annot.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef ANNOT_H
 #define ANNOT_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -33,7 +35,7 @@
   annotBorderUnderlined
 };
 
-class AnnotBorderStyle {
+class poppler_EXPORT AnnotBorderStyle {
 public:
 
   AnnotBorderStyle(AnnotBorderType typeA, double widthA,
@@ -61,7 +63,7 @@
 // Annot
 //------------------------------------------------------------------------
 
-class Annot {
+class poppler_EXPORT Annot {
 public:
 
   Annot(XRef *xrefA, Dict *acroForm, Dict *dict, Catalog *catalog);
@@ -132,7 +134,7 @@
 // Annots
 //------------------------------------------------------------------------
 
-class Annots {
+class poppler_EXPORT Annots {
 public:
 
   // Build a list of Annot objects.
diff -N -r -u poppler-0.6.4-orig/poppler/Array.h poppler-0.6.4/poppler/Array.h
--- poppler-0.6.4-orig/poppler/Array.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/Array.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef ARRAY_H
 #define ARRAY_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -21,7 +23,7 @@
 // Array
 //------------------------------------------------------------------------
 
-class Array {
+class poppler_EXPORT Array {
 public:
 
   // Constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/ArthurOutputDev.cc poppler-0.6.4/poppler/ArthurOutputDev.cc
--- poppler-0.6.4-orig/poppler/ArthurOutputDev.cc	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/ArthurOutputDev.cc	2008-02-10 18:41:04.000000000 +0100
@@ -241,7 +241,7 @@
 
 void ArthurOutputDev::updateFont(GfxState *state)
 {
-#warning fix this, probably update with updated code from SplashOutputdev
+//#warning fix this, probably update with updated code from SplashOutputdev
 /*
   GfxFont *gfxFont;
   GfxFontType fontType;
@@ -516,7 +516,7 @@
 		       fontPath->pts[i+1].x+x0, fontPath->pts[i+1].y+y0);
 	  ++i;
 	}
-#warning FIX THIS
+//#warning FIX THIS
 // 	else if (fontPath->flags[i] & splashPathArcCW) {
 // 	  qDebug() << "Need to implement arc";
 // 	}
diff -N -r -u poppler-0.6.4-orig/poppler/ArthurOutputDev.h poppler-0.6.4/poppler/ArthurOutputDev.h
--- poppler-0.6.4-orig/poppler/ArthurOutputDev.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/ArthurOutputDev.h	2008-02-11 01:18:04.000000000 +0100
@@ -10,6 +10,8 @@
 #ifndef CAIROOUTPUTDEV_H
 #define CAIROOUTPUTDEV_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -32,8 +34,11 @@
 //------------------------------------------------------------------------
 // ArthurOutputDev - Qt 4 QPainter renderer
 //------------------------------------------------------------------------
+#if defined (poppler_qt4_EXPORTS) && defined(_WIN32) 
+#define poppler_EXPORT poppler_qt4_EXPORT
+#endif
 
-class ArthurOutputDev: public OutputDev {
+class poppler_EXPORT ArthurOutputDev: public OutputDev {
 public:
 
   // Constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/BaseFile.h poppler-0.6.4/poppler/BaseFile.h
--- poppler-0.6.4-orig/poppler/BaseFile.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/BaseFile.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef BASEFILE_H
 #define BASEFILE_H
 
+#include "poppler-export.h"
+
 #include <stdio.h>
 #include <stdarg.h>
 
diff -N -r -u poppler-0.6.4-orig/poppler/BuiltinFont.h poppler-0.6.4/poppler/BuiltinFont.h
--- poppler-0.6.4-orig/poppler/BuiltinFont.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/BuiltinFont.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef BUILTINFONT_H
 #define BUILTINFONT_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -37,7 +39,7 @@
   BuiltinFontWidth *next;
 };
 
-class BuiltinFontWidths {
+class poppler_EXPORT BuiltinFontWidths {
 public:
 
   BuiltinFontWidths(BuiltinFontWidth *widths, int sizeA);
diff -N -r -u poppler-0.6.4-orig/poppler/CairoFontEngine.h poppler-0.6.4/poppler/CairoFontEngine.h
--- poppler-0.6.4-orig/poppler/CairoFontEngine.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/CairoFontEngine.h	2008-02-10 23:28:06.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef CAIROFONTENGINE_H
 #define CAIROFONTENGINE_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -16,7 +18,7 @@
 
 #include "GfxFont.h"
 
-class CairoFont {
+class poppler_EXPORT CairoFont {
 public:
   static CairoFont *create(GfxFont *gfxFont, XRef *xref, FT_Library lib, GBool useCIDs);
   ~CairoFont();
@@ -43,7 +45,7 @@
 // CairoFontEngine
 //------------------------------------------------------------------------
 
-class CairoFontEngine {
+class poppler_EXPORT CairoFontEngine {
 public:
 
   // Create a font engine.
diff -N -r -u poppler-0.6.4-orig/poppler/CairoOutputDev.h poppler-0.6.4/poppler/CairoOutputDev.h
--- poppler-0.6.4-orig/poppler/CairoOutputDev.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/CairoOutputDev.h	2008-02-10 23:28:06.000000000 +0100
@@ -10,6 +10,8 @@
 #ifndef CAIROOUTPUTDEV_H
 #define CAIROOUTPUTDEV_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -31,7 +33,7 @@
 //------------------------------------------------------------------------
 // CairoImage
 //------------------------------------------------------------------------
-class CairoImage {
+class poppler_EXPORT CairoImage {
 public:
   // Constructor.
   CairoImage (cairo_surface_t *image, double x1, double y1, double x2, double y2);
@@ -57,7 +59,7 @@
 // CairoOutputDev
 //------------------------------------------------------------------------
 
-class CairoOutputDev: public OutputDev {
+class poppler_EXPORT CairoOutputDev: public OutputDev {
 public:
 
   // Constructor.
@@ -226,7 +228,7 @@
 //------------------------------------------------------------------------
 
 //XXX: this should ideally not inherit from CairoOutputDev but use it instead perhaps
-class CairoImageOutputDev: public CairoOutputDev {
+class poppler_EXPORT CairoImageOutputDev: public CairoOutputDev {
 public:
 
   // Constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/Catalog.h poppler-0.6.4/poppler/Catalog.h
--- poppler-0.6.4-orig/poppler/Catalog.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/Catalog.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef CATALOG_H
 #define CATALOG_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -26,7 +28,7 @@
 // NameTree
 //------------------------------------------------------------------------
 
-class NameTree {
+class poppler_EXPORT NameTree {
 public:
   NameTree();
   void init(XRef *xref, Object *tree);
@@ -58,7 +60,7 @@
                     // length is the number of real Entry
 };
 
-class EmbFile {
+class poppler_EXPORT EmbFile {
 public:
   EmbFile(GooString *name, GooString *description, 
 	  int size,
@@ -107,7 +109,7 @@
 // Catalog
 //------------------------------------------------------------------------
 
-class Catalog {
+class poppler_EXPORT Catalog {
 public:
 
   // Constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/CharCodeToUnicode.h poppler-0.6.4/poppler/CharCodeToUnicode.h
--- poppler-0.6.4-orig/poppler/CharCodeToUnicode.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/CharCodeToUnicode.h	2008-02-10 23:28:06.000000000 +0100
@@ -11,6 +11,8 @@
 #ifndef CHARCODETOUNICODE_H
 #define CHARCODETOUNICODE_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -26,7 +28,7 @@
 
 //------------------------------------------------------------------------
 
-class CharCodeToUnicode {
+class poppler_EXPORT CharCodeToUnicode {
 friend class UnicodeToCharCode;
 public:
 
@@ -97,7 +99,7 @@
 
 //------------------------------------------------------------------------
 
-class CharCodeToUnicodeCache {
+class poppler_EXPORT CharCodeToUnicodeCache {
 public:
 
   CharCodeToUnicodeCache(int sizeA);
diff -N -r -u poppler-0.6.4-orig/poppler/DCTStream.cc poppler-0.6.4/poppler/DCTStream.cc
--- poppler-0.6.4-orig/poppler/DCTStream.cc	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/DCTStream.cc	2008-02-11 00:06:02.000000000 +0100
@@ -184,3 +184,7 @@
 GBool DCTStream::isBinary(GBool last) {
   return str->isBinary(gTrue);
 }
+
+void DCTStream::close() {
+str->close();
+}
\ No newline at end of file
diff -N -r -u poppler-0.6.4-orig/poppler/DCTStream.h poppler-0.6.4/poppler/DCTStream.h
--- poppler-0.6.4-orig/poppler/DCTStream.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/DCTStream.h	2008-02-11 00:08:06.000000000 +0100
@@ -10,6 +10,8 @@
 #define DCTSTREAM_H
 #include <config.h>
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -48,13 +50,14 @@
 };
 
 
-class DCTStream: public FilterStream {
+class poppler_EXPORT DCTStream: public FilterStream {
 public:
 
   DCTStream(Stream *strA, int colorXformA);
   virtual ~DCTStream();
   virtual StreamKind getKind() { return strDCT; }
   virtual void reset();
+  virtual void close();
   virtual int getChar();
   virtual int lookChar();
   virtual GooString *getPSFilter(int psLevel, char *indent);
diff -N -r -u poppler-0.6.4-orig/poppler/Decrypt.h poppler-0.6.4/poppler/Decrypt.h
--- poppler-0.6.4-orig/poppler/Decrypt.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/Decrypt.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef DECRYPT_H
 #define DECRYPT_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -22,7 +24,7 @@
 // Decrypt
 //------------------------------------------------------------------------
 
-class Decrypt {
+class poppler_EXPORT Decrypt {
 public:
 
   // Generate a file key.  The <fileKey> buffer must have space for at
@@ -64,7 +66,7 @@
   int bufIdx;
 };
 
-class DecryptStream: public FilterStream {
+class poppler_EXPORT DecryptStream: public FilterStream {
 public:
 
   DecryptStream(Stream *strA, Guchar *fileKey,
diff -N -r -u poppler-0.6.4-orig/poppler/Dict.h poppler-0.6.4/poppler/Dict.h
--- poppler-0.6.4-orig/poppler/Dict.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/Dict.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef DICT_H
 #define DICT_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -24,7 +26,7 @@
   Object val;
 };
 
-class Dict {
+class poppler_EXPORT Dict {
 public:
 
   // Constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/Error.cc poppler-0.6.4/poppler/Error.cc
--- poppler-0.6.4-orig/poppler/Error.cc	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/Error.cc	2008-02-10 18:41:04.000000000 +0100
@@ -30,6 +30,9 @@
   fflush(stderr);
 }
 
+#ifdef _MSC_VER
+# define CDECL
+#endif
 static void CDECL (*errorFunction)(int , char *, va_list args) = defaultErrorFunction;
 
 void setErrorFunction(void CDECL (* f)(int , char *, va_list args))
diff -N -r -u poppler-0.6.4-orig/poppler/Error.h poppler-0.6.4/poppler/Error.h
--- poppler-0.6.4-orig/poppler/Error.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/Error.h	2008-02-11 00:29:04.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef ERROR_H
 #define ERROR_H
 
+#include <poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -16,7 +18,7 @@
 #include <stdarg.h>
 #include "poppler-config.h"
 
-extern void CDECL error(int pos, char *msg, ...) GCC_PRINTF_FORMAT (2, 3);
+extern poppler_EXPORT void CDECL error(int pos, char *msg, ...) GCC_PRINTF_FORMAT (2, 3);
 void warning(char *msg, ...) GCC_PRINTF_FORMAT (1, 2);
 
 void setErrorFunction(void (* f)(int , char *, va_list args));
diff -N -r -u poppler-0.6.4-orig/poppler/FlateStream.h poppler-0.6.4/poppler/FlateStream.h
--- poppler-0.6.4-orig/poppler/FlateStream.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/FlateStream.h	2008-02-10 23:28:06.000000000 +0100
@@ -10,6 +10,8 @@
 #define FLATESTREAM_H
 #include <config.h>
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -39,7 +41,7 @@
 #include <zlib.h>
 }
 
-class FlateStream: public FilterStream {
+class poppler_EXPORT FlateStream: public FilterStream {
 public:
 
   FlateStream(Stream *strA, int predictor, int columns, int colors, int bits);
diff -N -r -u poppler-0.6.4-orig/poppler/FontInfo.h poppler-0.6.4/poppler/FontInfo.h
--- poppler-0.6.4-orig/poppler/FontInfo.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/FontInfo.h	2008-02-10 23:28:06.000000000 +0100
@@ -1,10 +1,12 @@
 #ifndef FONT_INFO_H
 #define FONT_INFO_H
 
+#include "poppler-export.h"
+
 #include "goo/gtypes.h"
 #include "goo/GooList.h"
 
-class FontInfo {
+class poppler_EXPORT FontInfo {
 public:
   enum Type {
     unknown,
@@ -45,7 +47,7 @@
   Ref fontRef;
 };
 
-class FontInfoScanner {
+class poppler_EXPORT FontInfoScanner {
 public:
 
   // Constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/Form.h poppler-0.6.4/poppler/Form.h
--- poppler-0.6.4-orig/poppler/Form.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/Form.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef FORM_H
 #define FORM_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -49,7 +51,7 @@
 // to a page.
 //------------------------------------------------------------------------
 
-class FormWidget {
+class poppler_EXPORT FormWidget {
 public:
   virtual ~FormWidget();
 
@@ -120,7 +122,7 @@
 // FormWidgetButton
 //------------------------------------------------------------------------
 
-class FormWidgetButton: public FormWidget {
+class poppler_EXPORT FormWidgetButton: public FormWidget {
 public:
   FormWidgetButton(XRef *xrefA, Object *dict, unsigned num, Ref ref, FormFieldButton *p);
   ~FormWidgetButton ();
@@ -156,7 +158,7 @@
 // FormWidgetText
 //------------------------------------------------------------------------
 
-class FormWidgetText: public FormWidget {
+class poppler_EXPORT FormWidgetText: public FormWidget {
 public:
   FormWidgetText(XRef *xrefA, Object *dict, unsigned num, Ref ref, FormFieldText *p);
   //return the field's content (UTF16BE)
@@ -186,7 +188,7 @@
 // FormWidgetChoice
 //------------------------------------------------------------------------
 
-class FormWidgetChoice: public FormWidget {
+class poppler_EXPORT FormWidgetChoice: public FormWidget {
 public:
   FormWidgetChoice(XRef *xrefA, Object *dict, unsigned num, Ref ref, FormFieldChoice *p);
   ~FormWidgetChoice();
@@ -229,7 +231,7 @@
 // FormWidgetSignature
 //------------------------------------------------------------------------
 
-class FormWidgetSignature: public FormWidget {
+class poppler_EXPORT FormWidgetSignature: public FormWidget {
 public:
   FormWidgetSignature(XRef *xrefA, Object *dict, unsigned num, Ref ref, FormFieldSignature *p);
   bool isReadOnly () const;
@@ -244,7 +246,7 @@
 // only interact with FormWidgets.
 //------------------------------------------------------------------------
 
-class FormField {
+class poppler_EXPORT FormField {
 public:
   FormField(XRef* xrefa, Object *aobj, const Ref& aref, Form* aform, FormFieldType t=formUndef);
 
@@ -290,7 +292,7 @@
 // FormFieldButton
 //------------------------------------------------------------------------
 
-class FormFieldButton: public FormField {
+class poppler_EXPORT FormFieldButton: public FormField {
 public:
   FormFieldButton(XRef *xrefA, Object *dict, const Ref& ref, Form* form);
 
@@ -315,7 +317,7 @@
 // FormFieldText
 //------------------------------------------------------------------------
 
-class FormFieldText: public FormField {
+class poppler_EXPORT FormFieldText: public FormField {
 public:
   FormFieldText(XRef *xrefA, Object *dict, const Ref& ref, Form* form);
   
@@ -349,7 +351,7 @@
 // FormFieldChoice
 //------------------------------------------------------------------------
 
-class FormFieldChoice: public FormField {
+class poppler_EXPORT FormFieldChoice: public FormField {
 public:
   FormFieldChoice(XRef *xrefA, Object *aobj, const Ref& ref, Form* form);
 
@@ -412,7 +414,7 @@
 // FormFieldSignature
 //------------------------------------------------------------------------
 
-class FormFieldSignature: public FormField {
+class poppler_EXPORT FormFieldSignature: public FormField {
 public:
   FormFieldSignature(XRef *xrefA, Object *dict, const Ref& ref, Form* form);
 
@@ -425,7 +427,7 @@
 // Catalog entry).
 //------------------------------------------------------------------------
 
-class Form {
+class poppler_EXPORT Form {
 public:
   Form(XRef *xrefA, Object* acroForm);
 
@@ -455,7 +457,7 @@
 // FormPageWidgets
 //------------------------------------------------------------------------
 
-class FormPageWidgets {
+class poppler_EXPORT FormPageWidgets {
 public:
   FormPageWidgets (XRef *xrefA, Object* annots, unsigned int page, Form *form);
   ~FormPageWidgets();
diff -N -r -u poppler-0.6.4-orig/poppler/Function.h poppler-0.6.4/poppler/Function.h
--- poppler-0.6.4-orig/poppler/Function.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/Function.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef FUNCTION_H
 #define FUNCTION_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -29,7 +31,7 @@
 #define funcMaxOutputs       32
 #define sampledFuncMaxInputs 16
 
-class Function {
+class poppler_EXPORT Function {
 public:
 
   Function();
@@ -81,7 +83,7 @@
 // IdentityFunction
 //------------------------------------------------------------------------
 
-class IdentityFunction: public Function {
+class poppler_EXPORT IdentityFunction: public Function {
 public:
 
   IdentityFunction();
@@ -98,7 +100,7 @@
 // SampledFunction
 //------------------------------------------------------------------------
 
-class SampledFunction: public Function {
+class poppler_EXPORT SampledFunction: public Function {
 public:
 
   SampledFunction(Object *funcObj, Dict *dict);
@@ -138,7 +140,7 @@
 // ExponentialFunction
 //------------------------------------------------------------------------
 
-class ExponentialFunction: public Function {
+class poppler_EXPORT ExponentialFunction: public Function {
 public:
 
   ExponentialFunction(Object *funcObj, Dict *dict);
@@ -166,7 +168,7 @@
 // StitchingFunction
 //------------------------------------------------------------------------
 
-class StitchingFunction: public Function {
+class poppler_EXPORT StitchingFunction: public Function {
 public:
 
   StitchingFunction(Object *funcObj, Dict *dict);
@@ -198,7 +200,7 @@
 // PostScriptFunction
 //------------------------------------------------------------------------
 
-class PostScriptFunction: public Function {
+class poppler_EXPORT PostScriptFunction: public Function {
 public:
 
   PostScriptFunction(Object *funcObj, Dict *dict);
diff -N -r -u poppler-0.6.4-orig/poppler/Gfx.h poppler-0.6.4/poppler/Gfx.h
--- poppler-0.6.4-orig/poppler/Gfx.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/Gfx.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef GFX_H
 #define GFX_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -74,7 +76,7 @@
 
 //------------------------------------------------------------------------
 
-class GfxResources {
+class poppler_EXPORT GfxResources {
 public:
 
   GfxResources(XRef *xref, Dict *resDict, GfxResources *nextA);
@@ -105,7 +107,7 @@
 // Gfx
 //------------------------------------------------------------------------
 
-class Gfx {
+class poppler_EXPORT Gfx {
 public:
 
   // Constructor for regular output.
diff -N -r -u poppler-0.6.4-orig/poppler/GfxFont.h poppler-0.6.4/poppler/GfxFont.h
--- poppler-0.6.4-orig/poppler/GfxFont.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/GfxFont.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef GFXFONT_H
 #define GFXFONT_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -84,7 +86,7 @@
 #define fontItalic     (1 << 6)
 #define fontBold       (1 << 18)
 
-class GfxFont {
+class poppler_EXPORT GfxFont {
 public:
 
   enum Stretch { 
@@ -240,7 +242,7 @@
 // Gfx8BitFont
 //------------------------------------------------------------------------
 
-class Gfx8BitFont: public GfxFont {
+class poppler_EXPORT Gfx8BitFont: public GfxFont {
 public:
 
   Gfx8BitFont(XRef *xref, char *tagA, Ref idA, GooString *nameA,
@@ -300,7 +302,7 @@
 // GfxCIDFont
 //------------------------------------------------------------------------
 
-class GfxCIDFont: public GfxFont {
+class poppler_EXPORT GfxCIDFont: public GfxFont {
 public:
 
   GfxCIDFont(XRef *xref, char *tagA, Ref idA, GooString *nameA,
@@ -348,7 +350,7 @@
 // GfxFontDict
 //------------------------------------------------------------------------
 
-class GfxFontDict {
+class poppler_EXPORT GfxFontDict {
 public:
 
   // Build the font dictionary, given the PDF font dictionary.
diff -N -r -u poppler-0.6.4-orig/poppler/GfxState.h poppler-0.6.4/poppler/GfxState.h
--- poppler-0.6.4-orig/poppler/GfxState.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/GfxState.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef GFXSTATE_H
 #define GFXSTATE_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -22,7 +24,7 @@
 class PDFRectangle;
 class GfxShading;
 
-class Matrix {
+class poppler_EXPORT Matrix {
 public:
   double m[6];
 
@@ -135,7 +137,7 @@
   csPattern
 };
 
-class GfxColorSpace {
+class poppler_EXPORT GfxColorSpace {
 public:
 
   GfxColorSpace();
@@ -181,7 +183,7 @@
 // GfxDeviceGrayColorSpace
 //------------------------------------------------------------------------
 
-class GfxDeviceGrayColorSpace: public GfxColorSpace {
+class poppler_EXPORT GfxDeviceGrayColorSpace: public GfxColorSpace {
 public:
 
   GfxDeviceGrayColorSpace();
@@ -205,7 +207,7 @@
 // GfxCalGrayColorSpace
 //------------------------------------------------------------------------
 
-class GfxCalGrayColorSpace: public GfxColorSpace {
+class poppler_EXPORT GfxCalGrayColorSpace: public GfxColorSpace {
 public:
 
   GfxCalGrayColorSpace();
@@ -245,7 +247,7 @@
 // GfxDeviceRGBColorSpace
 //------------------------------------------------------------------------
 
-class GfxDeviceRGBColorSpace: public GfxColorSpace {
+class poppler_EXPORT GfxDeviceRGBColorSpace: public GfxColorSpace {
 public:
 
   GfxDeviceRGBColorSpace();
@@ -269,7 +271,7 @@
 // GfxCalRGBColorSpace
 //------------------------------------------------------------------------
 
-class GfxCalRGBColorSpace: public GfxColorSpace {
+class poppler_EXPORT GfxCalRGBColorSpace: public GfxColorSpace {
 public:
 
   GfxCalRGBColorSpace();
@@ -313,7 +315,7 @@
 // GfxDeviceCMYKColorSpace
 //------------------------------------------------------------------------
 
-class GfxDeviceCMYKColorSpace: public GfxColorSpace {
+class poppler_EXPORT GfxDeviceCMYKColorSpace: public GfxColorSpace {
 public:
 
   GfxDeviceCMYKColorSpace();
@@ -335,7 +337,7 @@
 // GfxLabColorSpace
 //------------------------------------------------------------------------
 
-class GfxLabColorSpace: public GfxColorSpace {
+class poppler_EXPORT GfxLabColorSpace: public GfxColorSpace {
 public:
 
   GfxLabColorSpace();
@@ -380,7 +382,7 @@
 // GfxICCBasedColorSpace
 //------------------------------------------------------------------------
 
-class GfxICCBasedColorSpace: public GfxColorSpace {
+class poppler_EXPORT GfxICCBasedColorSpace: public GfxColorSpace {
 public:
 
   GfxICCBasedColorSpace(int nCompsA, GfxColorSpace *altA,
@@ -419,7 +421,7 @@
 // GfxIndexedColorSpace
 //------------------------------------------------------------------------
 
-class GfxIndexedColorSpace: public GfxColorSpace {
+class poppler_EXPORT GfxIndexedColorSpace: public GfxColorSpace {
 public:
 
   GfxIndexedColorSpace(GfxColorSpace *baseA, int indexHighA);
@@ -458,7 +460,7 @@
 // GfxSeparationColorSpace
 //------------------------------------------------------------------------
 
-class GfxSeparationColorSpace: public GfxColorSpace {
+class poppler_EXPORT GfxSeparationColorSpace: public GfxColorSpace {
 public:
 
   GfxSeparationColorSpace(GooString *nameA, GfxColorSpace *altA,
@@ -496,7 +498,7 @@
 // GfxDeviceNColorSpace
 //------------------------------------------------------------------------
 
-class GfxDeviceNColorSpace: public GfxColorSpace {
+class poppler_EXPORT GfxDeviceNColorSpace: public GfxColorSpace {
 public:
 
   GfxDeviceNColorSpace(int nCompsA, GfxColorSpace *alt, Function *func);
@@ -535,7 +537,7 @@
 // GfxPatternColorSpace
 //------------------------------------------------------------------------
 
-class GfxPatternColorSpace: public GfxColorSpace {
+class poppler_EXPORT GfxPatternColorSpace: public GfxColorSpace {
 public:
 
   GfxPatternColorSpace(GfxColorSpace *underA);
@@ -566,7 +568,7 @@
 // GfxPattern
 //------------------------------------------------------------------------
 
-class GfxPattern {
+class poppler_EXPORT GfxPattern {
 public:
 
   GfxPattern(int typeA);
@@ -587,7 +589,7 @@
 // GfxTilingPattern
 //------------------------------------------------------------------------
 
-class GfxTilingPattern: public GfxPattern {
+class poppler_EXPORT GfxTilingPattern: public GfxPattern {
 public:
 
   static GfxTilingPattern *parse(Object *patObj);
@@ -625,7 +627,7 @@
 // GfxShadingPattern
 //------------------------------------------------------------------------
 
-class GfxShadingPattern: public GfxPattern {
+class poppler_EXPORT GfxShadingPattern: public GfxPattern {
 public:
 
   static GfxShadingPattern *parse(Object *patObj);
@@ -648,7 +650,7 @@
 // GfxShading
 //------------------------------------------------------------------------
 
-class GfxShading {
+class poppler_EXPORT GfxShading {
 public:
 
   GfxShading(int typeA);
@@ -683,7 +685,7 @@
 // GfxFunctionShading
 //------------------------------------------------------------------------
 
-class GfxFunctionShading: public GfxShading {
+class poppler_EXPORT GfxFunctionShading: public GfxShading {
 public:
 
   GfxFunctionShading(double x0A, double y0A,
@@ -716,7 +718,7 @@
 // GfxAxialShading
 //------------------------------------------------------------------------
 
-class GfxAxialShading: public GfxShading {
+class poppler_EXPORT GfxAxialShading: public GfxShading {
 public:
 
   GfxAxialShading(double x0A, double y0A,
@@ -754,7 +756,7 @@
 // GfxRadialShading
 //------------------------------------------------------------------------
 
-class GfxRadialShading: public GfxShading {
+class poppler_EXPORT GfxRadialShading: public GfxShading {
 public:
 
   GfxRadialShading(double x0A, double y0A, double r0A,
@@ -798,7 +800,7 @@
   GfxColor color;
 };
 
-class GfxGouraudTriangleShading: public GfxShading {
+class poppler_EXPORT GfxGouraudTriangleShading: public GfxShading {
 public:
 
   GfxGouraudTriangleShading(int typeA,
@@ -837,7 +839,7 @@
   GfxColor color[2][2];
 };
 
-class GfxPatchMeshShading: public GfxShading {
+class poppler_EXPORT GfxPatchMeshShading: public GfxShading {
 public:
 
   GfxPatchMeshShading(int typeA, GfxPatch *patchesA, int nPatchesA,
@@ -864,7 +866,7 @@
 // GfxImageColorMap
 //------------------------------------------------------------------------
 
-class GfxImageColorMap {
+class poppler_EXPORT GfxImageColorMap {
 public:
 
   // Constructor.
@@ -922,7 +924,7 @@
 // GfxSubpath and GfxPath
 //------------------------------------------------------------------------
 
-class GfxSubpath {
+class poppler_EXPORT GfxSubpath {
 public:
 
   // Constructor.
@@ -970,7 +972,7 @@
   GfxSubpath(GfxSubpath *subpath);
 };
 
-class GfxPath {
+class poppler_EXPORT GfxPath {
 public:
 
   // Constructor.
@@ -1032,7 +1034,7 @@
 // GfxState
 //------------------------------------------------------------------------
 
-class GfxState {
+class poppler_EXPORT GfxState {
 public:
 
   // Construct a default GfxState, for a device with resolution <hDPI>
diff -N -r -u poppler-0.6.4-orig/poppler/GlobalParams.h poppler-0.6.4/poppler/GlobalParams.h
--- poppler-0.6.4-orig/poppler/GlobalParams.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/GlobalParams.h	2008-02-11 00:26:52.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef GLOBALPARAMS_H
 #define GLOBALPARAMS_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -43,7 +45,7 @@
 //------------------------------------------------------------------------
 
 // The global parameters object.
-extern GlobalParams *globalParams;
+extern poppler_EXPORT GlobalParams *globalParams;
 
 //------------------------------------------------------------------------
 
@@ -61,7 +63,7 @@
   int faceIndex;
 };
 
-class DisplayFontParam {
+class poppler_EXPORT DisplayFontParam {
 public:
 
   GooString *name;		// font name for 8-bit fonts and named
@@ -79,7 +81,7 @@
 
 //------------------------------------------------------------------------
 
-class PSFontParam {
+class poppler_EXPORT PSFontParam {
 public:
 
   GooString *pdfFontName;		// PDF font name for 8-bit fonts and
@@ -125,7 +127,7 @@
 
 //------------------------------------------------------------------------
 
-class GlobalParams {
+class poppler_EXPORT GlobalParams {
 public:
 
   // Initialize the global parameters by attempting to read a config
diff -N -r -u poppler-0.6.4-orig/poppler/JArithmeticDecoder.h poppler-0.6.4/poppler/JArithmeticDecoder.h
--- poppler-0.6.4-orig/poppler/JArithmeticDecoder.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/JArithmeticDecoder.h	2008-02-10 23:28:06.000000000 +0100
@@ -23,7 +23,7 @@
 // JArithmeticDecoderStats
 //------------------------------------------------------------------------
 
-class JArithmeticDecoderStats {
+class poppler_EXPORT JArithmeticDecoderStats {
 public:
 
   JArithmeticDecoderStats(int contextSizeA);
@@ -46,7 +46,7 @@
 // JArithmeticDecoder
 //------------------------------------------------------------------------
 
-class JArithmeticDecoder {
+class poppler_EXPORT JArithmeticDecoder {
 public:
 
   JArithmeticDecoder();
diff -N -r -u poppler-0.6.4-orig/poppler/JBIG2Stream.h poppler-0.6.4/poppler/JBIG2Stream.h
--- poppler-0.6.4-orig/poppler/JBIG2Stream.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/JBIG2Stream.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef JBIG2STREAM_H
 #define JBIG2STREAM_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -28,7 +30,7 @@
 
 //------------------------------------------------------------------------
 
-class JBIG2Stream: public FilterStream {
+class poppler_EXPORT JBIG2Stream: public FilterStream {
 public:
 
   JBIG2Stream(Stream *strA, Object *globalsStreamA);
diff -N -r -u poppler-0.6.4-orig/poppler/JPXStream.h poppler-0.6.4/poppler/JPXStream.h
--- poppler-0.6.4-orig/poppler/JPXStream.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/JPXStream.h	2008-02-10 23:28:06.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef JPXSTREAM_H
 #define JPXSTREAM_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -269,7 +271,7 @@
 
 //------------------------------------------------------------------------
 
-class JPXStream: public FilterStream {
+class poppler_EXPORT JPXStream: public FilterStream {
 public:
 
   JPXStream(Stream *strA);
diff -N -r -u poppler-0.6.4-orig/poppler/Lexer.h poppler-0.6.4/poppler/Lexer.h
--- poppler-0.6.4-orig/poppler/Lexer.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/Lexer.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef LEXER_H
 #define LEXER_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -24,7 +26,7 @@
 // Lexer
 //------------------------------------------------------------------------
 
-class Lexer {
+class poppler_EXPORT Lexer {
 public:
 
   // Construct a lexer for a single stream.  Deletes the stream when
diff -N -r -u poppler-0.6.4-orig/poppler/Link.h poppler-0.6.4/poppler/Link.h
--- poppler-0.6.4-orig/poppler/Link.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/Link.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef LINK_H
 #define LINK_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -35,7 +37,7 @@
   actionUnknown			// anything else
 };
 
-class LinkAction {
+class poppler_EXPORT LinkAction {
 public:
 
   // Destructor.
@@ -73,7 +75,7 @@
   destFitBV
 };
 
-class LinkDest {
+class poppler_EXPORT LinkDest {
 public:
 
   // Build a LinkDest from the array.
@@ -121,7 +123,7 @@
 // LinkGoTo
 //------------------------------------------------------------------------
 
-class LinkGoTo: public LinkAction {
+class poppler_EXPORT LinkGoTo: public LinkAction {
 public:
 
   // Build a LinkGoTo from a destination (dictionary, name, or string).
@@ -150,7 +152,7 @@
 // LinkGoToR
 //------------------------------------------------------------------------
 
-class LinkGoToR: public LinkAction {
+class poppler_EXPORT LinkGoToR: public LinkAction {
 public:
 
   // Build a LinkGoToR from a file spec (dictionary) and destination
@@ -182,7 +184,7 @@
 // LinkLaunch
 //------------------------------------------------------------------------
 
-class LinkLaunch: public LinkAction {
+class poppler_EXPORT LinkLaunch: public LinkAction {
 public:
 
   // Build a LinkLaunch from an action dictionary.
@@ -209,7 +211,7 @@
 // LinkURI
 //------------------------------------------------------------------------
 
-class LinkURI: public LinkAction {
+class poppler_EXPORT LinkURI: public LinkAction {
 public:
 
   // Build a LinkURI given the URI (string) and base URI.
@@ -234,7 +236,7 @@
 // LinkNamed
 //------------------------------------------------------------------------
 
-class LinkNamed: public LinkAction {
+class poppler_EXPORT LinkNamed: public LinkAction {
 public:
 
   // Build a LinkNamed given the action name.
@@ -256,7 +258,7 @@
 // LinkMovie
 //------------------------------------------------------------------------
 
-class LinkMovie: public LinkAction {
+class poppler_EXPORT LinkMovie: public LinkAction {
 public:
 
   LinkMovie(Object *annotObj, Object *titleObj);
@@ -280,7 +282,7 @@
 // LinkSound
 //------------------------------------------------------------------------
 
-class LinkSound: public LinkAction {
+class poppler_EXPORT LinkSound: public LinkAction {
 public:
 
   LinkSound(Object *soundObj);
@@ -310,7 +312,7 @@
 // LinkUnknown
 //------------------------------------------------------------------------
 
-class LinkUnknown: public LinkAction {
+class poppler_EXPORT LinkUnknown: public LinkAction {
 public:
 
   // Build a LinkUnknown with the specified action type.
@@ -335,7 +337,7 @@
 // Link
 //------------------------------------------------------------------------
 
-class Link {
+class poppler_EXPORT Link {
 public:
 
   // Construct a link, given its dictionary.
@@ -370,7 +372,7 @@
 // Links
 //------------------------------------------------------------------------
 
-class Links {
+class poppler_EXPORT Links {
 public:
 
   // Extract links from array of annotations.
diff -N -r -u poppler-0.6.4-orig/poppler/NameToCharCode.h poppler-0.6.4/poppler/NameToCharCode.h
--- poppler-0.6.4-orig/poppler/NameToCharCode.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/NameToCharCode.h	2008-02-10 23:28:08.000000000 +0100
@@ -19,7 +19,7 @@
 
 //------------------------------------------------------------------------
 
-class NameToCharCode {
+class poppler_EXPORT NameToCharCode {
 public:
 
   NameToCharCode();
diff -N -r -u poppler-0.6.4-orig/poppler/Object.h poppler-0.6.4/poppler/Object.h
--- poppler-0.6.4-orig/poppler/Object.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/Object.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef OBJECT_H
 #define OBJECT_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -71,7 +73,7 @@
 #define initObj(t) type = t
 #endif
 
-class Object {
+class poppler_EXPORT Object {
 public:
 
   // Default constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/Outline.h poppler-0.6.4/poppler/Outline.h
--- poppler-0.6.4-orig/poppler/Outline.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/Outline.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef OUTLINE_H
 #define OUTLINE_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -23,7 +25,7 @@
 
 //------------------------------------------------------------------------
 
-class Outline {
+class poppler_EXPORT Outline {
 public:
 
   Outline(Object *outlineObj, XRef *xref);
@@ -39,7 +41,7 @@
 
 //------------------------------------------------------------------------
 
-class OutlineItem {
+class poppler_EXPORT OutlineItem {
 public:
 
   OutlineItem(Dict *dict, XRef *xrefA);
diff -N -r -u poppler-0.6.4-orig/poppler/OutputDev.h poppler-0.6.4/poppler/OutputDev.h
--- poppler-0.6.4-orig/poppler/OutputDev.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/OutputDev.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef OUTPUTDEV_H
 #define OUTPUTDEV_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -38,7 +40,7 @@
 // OutputDev
 //------------------------------------------------------------------------
 
-class OutputDev {
+class poppler_EXPORT OutputDev {
 public:
 
   // Constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/Page.h poppler-0.6.4/poppler/Page.h
--- poppler-0.6.4-orig/poppler/Page.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/Page.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef PAGE_H
 #define PAGE_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -28,7 +30,7 @@
 
 //------------------------------------------------------------------------
 
-class PDFRectangle {
+class poppler_EXPORT PDFRectangle {
 public:
   double x1, y1, x2, y2;
 
@@ -43,7 +45,7 @@
 // PageAttrs
 //------------------------------------------------------------------------
 
-class PageAttrs {
+class poppler_EXPORT PageAttrs {
 public:
 
   // Construct a new PageAttrs object by merging a dictionary
@@ -103,7 +105,7 @@
 // Page
 //------------------------------------------------------------------------
 
-class Page {
+class poppler_EXPORT Page {
 public:
 
   // Constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/PageLabelInfo.h poppler-0.6.4/poppler/PageLabelInfo.h
--- poppler-0.6.4-orig/poppler/PageLabelInfo.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/PageLabelInfo.h	2008-02-10 23:28:08.000000000 +0100
@@ -4,12 +4,14 @@
 #include <ctype.h>
 #include <assert.h>
 
+#include "poppler-export.h"
+
 #include "goo/gtypes.h"
 #include "goo/GooList.h"
 #include "goo/GooString.h"
 #include <Object.h>
 
-class PageLabelInfo {
+class poppler_EXPORT PageLabelInfo {
 public:
   PageLabelInfo(Object *tree, int numPages);
   ~PageLabelInfo();
diff -N -r -u poppler-0.6.4-orig/poppler/PageTransition.h poppler-0.6.4/poppler/PageTransition.h
--- poppler-0.6.4-orig/poppler/PageTransition.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/PageTransition.h	2008-02-10 23:28:08.000000000 +0100
@@ -1,6 +1,8 @@
 #ifndef PAGE_TRANSITION_H
 #define PAGE_TRANSITION_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -39,7 +41,7 @@
   transitionOutward
 };
 
-class PageTransition {
+class poppler_EXPORT PageTransition {
 public:
   // Construct a Page Transition.
   PageTransition (Object *trans);
diff -N -r -u poppler-0.6.4-orig/poppler/Parser.h poppler-0.6.4/poppler/Parser.h
--- poppler-0.6.4-orig/poppler/Parser.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/Parser.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef PARSER_H
 #define PARSER_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -19,7 +21,7 @@
 // Parser
 //------------------------------------------------------------------------
 
-class Parser {
+class poppler_EXPORT Parser {
 public:
 
   // Constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/PDFDoc.h poppler-0.6.4/poppler/PDFDoc.h
--- poppler-0.6.4-orig/poppler/PDFDoc.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/PDFDoc.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef PDFDOC_H
 #define PDFDOC_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -31,7 +33,7 @@
 // PDFDoc
 //------------------------------------------------------------------------
 
-class PDFDoc {
+class poppler_EXPORT PDFDoc {
 public:
 
   PDFDoc(GooString *fileNameA, GooString *ownerPassword = NULL,
diff -N -r -u poppler-0.6.4-orig/poppler/PDFDocEncoding.h poppler-0.6.4/poppler/PDFDocEncoding.h
--- poppler-0.6.4-orig/poppler/PDFDocEncoding.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/PDFDocEncoding.h	2008-02-11 00:32:14.000000000 +0100
@@ -9,8 +9,9 @@
 #ifndef PDFDOCENCODING_H
 #define PDFDOCENCODING_H
 
+#include <poppler-export.h>
 #include "CharTypes.h"
 
-extern Unicode pdfDocEncoding[256];
+extern poppler_EXPORT Unicode pdfDocEncoding[256];
 
 #endif
diff -N -r -u poppler-0.6.4-orig/poppler/poppler-config.h poppler-0.6.4/poppler/poppler-config.h
--- poppler-0.6.4-orig/poppler/poppler-config.h	2008-01-21 21:19:14.000000000 +0100
+++ poppler-0.6.4/poppler/poppler-config.h	2008-02-10 23:56:18.000000000 +0100
@@ -141,6 +141,9 @@
 #endif
 
 #if defined(_MSC_VER) || defined(__BORLANDC__)
+#ifdef CDECL
+#undef CDECL
+#endif
 #define CDECL __cdecl
 #else
 #define CDECL
diff -N -r -u poppler-0.6.4-orig/poppler/poppler-export.h poppler-0.6.4/poppler/poppler-export.h
--- poppler-0.6.4-orig/poppler/poppler-export.h	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/poppler/poppler-export.h	2008-02-11 01:18:12.000000000 +0100
@@ -0,0 +1,23 @@
+#ifndef _POPPLER_EXPORT_H
+#define _POPPLER_EXPORT_H
+# if _WIN32
+#  if defined (poppler_EXPORTS)
+#   define poppler_EXPORT __declspec(dllexport)
+#  else
+#   define poppler_EXPORT __declspec(dllimport)
+#  endif
+# else
+#  define poppler_EXPORT
+# endif
+
+# if _WIN32
+#  if defined (poppler_qt4_EXPORTS)
+#   define poppler_qt4_EXPORT __declspec(dllexport)
+#  else
+#   define poppler_qt4_EXPORT __declspec(dllimport)
+#  endif
+# else
+#  define poppler_qt4_EXPORT
+# endif
+
+#endif
diff -N -r -u poppler-0.6.4-orig/poppler/PreScanOutputDev.h poppler-0.6.4/poppler/PreScanOutputDev.h
--- poppler-0.6.4-orig/poppler/PreScanOutputDev.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/PreScanOutputDev.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef PRESCANOUTPUTDEV_H
 #define PRESCANOUTPUTDEV_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -21,7 +23,7 @@
 // PreScanOutputDev
 //------------------------------------------------------------------------
 
-class PreScanOutputDev: public OutputDev {
+class poppler_EXPORT PreScanOutputDev: public OutputDev {
 public:
 
   // Constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/ProfileData.h poppler-0.6.4/poppler/ProfileData.h
--- poppler-0.6.4-orig/poppler/ProfileData.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/ProfileData.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef PROFILE_DATA_H
 #define PROFILE_DATA_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -17,7 +19,7 @@
 // ProfileData
 //------------------------------------------------------------------------
 
-class ProfileData {
+class poppler_EXPORT ProfileData {
 public:
 
   // Constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/PSOutputDev.h poppler-0.6.4/poppler/PSOutputDev.h
--- poppler-0.6.4-orig/poppler/PSOutputDev.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/PSOutputDev.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef PSOUTPUTDEV_H
 #define PSOUTPUTDEV_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -48,7 +50,7 @@
 
 typedef void (*PSOutputFunc)(void *stream, char *data, int len);
 
-class PSOutputDev: public OutputDev {
+class poppler_EXPORT PSOutputDev: public OutputDev {
 public:
 
   // Open a PostScript output file, and write the prolog.
diff -N -r -u poppler-0.6.4-orig/poppler/PSTokenizer.h poppler-0.6.4/poppler/PSTokenizer.h
--- poppler-0.6.4-orig/poppler/PSTokenizer.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/PSTokenizer.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef PSTOKENIZER_H
 #define PSTOKENIZER_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -17,7 +19,7 @@
 
 //------------------------------------------------------------------------
 
-class PSTokenizer {
+class poppler_EXPORT PSTokenizer {
 public:
 
   PSTokenizer(int (*getCharFuncA)(void *), void *dataA);
diff -N -r -u poppler-0.6.4-orig/poppler/SecurityHandler.h poppler-0.6.4/poppler/SecurityHandler.h
--- poppler-0.6.4-orig/poppler/SecurityHandler.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/SecurityHandler.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef SECURITYHANDLER_H
 #define SECURITYHANDLER_H
 
+#include "poppler-export.h"
+
 #include "poppler-config.h"
 
 #ifdef USE_GCC_PRAGMAS
@@ -26,7 +28,7 @@
 // SecurityHandler
 //------------------------------------------------------------------------
 
-class SecurityHandler {
+class poppler_EXPORT SecurityHandler {
 public:
 
   static SecurityHandler *make(PDFDoc *docA, Object *encryptDictA);
@@ -86,7 +88,7 @@
 // StandardSecurityHandler
 //------------------------------------------------------------------------
 
-class StandardSecurityHandler: public SecurityHandler {
+class poppler_EXPORT StandardSecurityHandler: public SecurityHandler {
 public:
 
   StandardSecurityHandler(PDFDoc *docA, Object *encryptDictA);
@@ -126,7 +128,7 @@
 // ExternalSecurityHandler
 //------------------------------------------------------------------------
 
-class ExternalSecurityHandler: public SecurityHandler {
+class poppler_EXPORT ExternalSecurityHandler: public SecurityHandler {
 public:
 
   ExternalSecurityHandler(PDFDoc *docA, Object *encryptDictA,
diff -N -r -u poppler-0.6.4-orig/poppler/Sound.h poppler-0.6.4/poppler/Sound.h
--- poppler-0.6.4-orig/poppler/Sound.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/Sound.h	2008-02-10 23:28:08.000000000 +0100
@@ -19,6 +19,8 @@
 #ifndef Sound_H
 #define Sound_H
 
+#include "poppler-export.h"
+
 class GooString;
 class Object;
 class Stream;
@@ -37,7 +39,7 @@
   soundALaw			// A-law-encoded samples
 };
 
-class Sound
+class poppler_EXPORT Sound
 {
 public:
   // Try to parse the Object s
diff -N -r -u poppler-0.6.4-orig/poppler/SplashOutputDev.h poppler-0.6.4/poppler/SplashOutputDev.h
--- poppler-0.6.4-orig/poppler/SplashOutputDev.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/SplashOutputDev.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef SPLASHOUTPUTDEV_H
 #define SPLASHOUTPUTDEV_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -40,7 +42,7 @@
 // SplashOutputDev
 //------------------------------------------------------------------------
 
-class SplashOutputDev: public OutputDev {
+class poppler_EXPORT SplashOutputDev: public OutputDev {
 public:
 
   // Constructor.
diff -N -r -u poppler-0.6.4-orig/poppler/Stream.h poppler-0.6.4/poppler/Stream.h
--- poppler-0.6.4-orig/poppler/Stream.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/Stream.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef STREAM_H
 #define STREAM_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -55,7 +57,7 @@
 // Stream (base class)
 //------------------------------------------------------------------------
 
-class Stream {
+class poppler_EXPORT Stream {
 public:
 
   // Constructor.
@@ -141,7 +143,7 @@
 // This is the base class for all streams that read directly from a file.
 //------------------------------------------------------------------------
 
-class BaseStream: public Stream {
+class poppler_EXPORT BaseStream: public Stream {
 public:
 
   BaseStream(Object *dictA);
@@ -170,7 +172,7 @@
 // This is the base class for all streams that filter another stream.
 //------------------------------------------------------------------------
 
-class FilterStream: public Stream {
+class poppler_EXPORT FilterStream: public Stream {
 public:
 
   FilterStream(Stream *strA);
@@ -192,7 +194,7 @@
 // ImageStream
 //------------------------------------------------------------------------
 
-class ImageStream {
+class poppler_EXPORT ImageStream {
 public:
 
   // Create an image stream object for an image with the specified
@@ -231,7 +233,7 @@
 // StreamPredictor
 //------------------------------------------------------------------------
 
-class StreamPredictor {
+class poppler_EXPORT StreamPredictor {
 public:
 
   // Create a predictor object.  Note that the parameters are for the
@@ -269,7 +271,7 @@
 
 #define fileStreamBufSize 256
 
-class FileStream: public BaseStream {
+class poppler_EXPORT FileStream: public BaseStream {
 public:
 
   FileStream(FILE *fA, Guint startA, GBool limitedA,
@@ -309,7 +311,7 @@
 // MemStream
 //------------------------------------------------------------------------
 
-class MemStream: public BaseStream {
+class poppler_EXPORT MemStream: public BaseStream {
 public:
 
   MemStream(char *bufA, Guint startA, Guint lengthA, Object *dictA);
@@ -348,7 +350,7 @@
 // that creating a new FileStream (using makeSubStream).
 //------------------------------------------------------------------------
 
-class EmbedStream: public BaseStream {
+class poppler_EXPORT EmbedStream: public BaseStream {
 public:
 
   EmbedStream(Stream *strA, Object *dictA, GBool limitedA, Guint lengthA);
@@ -375,7 +377,7 @@
 // ASCIIHexStream
 //------------------------------------------------------------------------
 
-class ASCIIHexStream: public FilterStream {
+class poppler_EXPORT ASCIIHexStream: public FilterStream {
 public:
 
   ASCIIHexStream(Stream *strA);
@@ -398,7 +400,7 @@
 // ASCII85Stream
 //------------------------------------------------------------------------
 
-class ASCII85Stream: public FilterStream {
+class poppler_EXPORT ASCII85Stream: public FilterStream {
 public:
 
   ASCII85Stream(Stream *strA);
@@ -423,7 +425,7 @@
 // LZWStream
 //------------------------------------------------------------------------
 
-class LZWStream: public FilterStream {
+class poppler_EXPORT LZWStream: public FilterStream {
 public:
 
   LZWStream(Stream *strA, int predictor, int columns, int colors,
@@ -467,7 +469,7 @@
 // RunLengthStream
 //------------------------------------------------------------------------
 
-class RunLengthStream: public FilterStream {
+class poppler_EXPORT RunLengthStream: public FilterStream {
 public:
 
   RunLengthStream(Stream *strA);
@@ -497,7 +499,7 @@
 
 struct CCITTCodeTable;
 
-class CCITTFaxStream: public FilterStream {
+class poppler_EXPORT CCITTFaxStream: public FilterStream {
 public:
 
   CCITTFaxStream(Stream *strA, int encodingA, GBool endOfLineA,
@@ -573,7 +575,7 @@
   Guchar sym[256];		// symbols
 };
 
-class DCTStream: public FilterStream {
+class poppler_EXPORT DCTStream: public FilterStream {
 public:
 
   DCTStream(Stream *strA, int colorXformA);
@@ -678,7 +680,7 @@
   int first;			// first length/distance
 };
 
-class FlateStream: public FilterStream {
+class poppler_EXPORT FlateStream: public FilterStream {
 public:
 
   FlateStream(Stream *strA, int predictor, int columns,
@@ -734,7 +736,7 @@
 // EOFStream
 //------------------------------------------------------------------------
 
-class EOFStream: public FilterStream {
+class poppler_EXPORT EOFStream: public FilterStream {
 public:
 
   EOFStream(Stream *strA);
@@ -751,7 +753,7 @@
 // FixedLengthEncoder
 //------------------------------------------------------------------------
 
-class FixedLengthEncoder: public FilterStream {
+class poppler_EXPORT FixedLengthEncoder: public FilterStream {
 public:
 
   FixedLengthEncoder(Stream *strA, int lengthA);
@@ -774,7 +776,7 @@
 // ASCIIHexEncoder
 //------------------------------------------------------------------------
 
-class ASCIIHexEncoder: public FilterStream {
+class poppler_EXPORT ASCIIHexEncoder: public FilterStream {
 public:
 
   ASCIIHexEncoder(Stream *strA);
@@ -804,7 +806,7 @@
 // ASCII85Encoder
 //------------------------------------------------------------------------
 
-class ASCII85Encoder: public FilterStream {
+class poppler_EXPORT ASCII85Encoder: public FilterStream {
 public:
 
   ASCII85Encoder(Stream *strA);
@@ -834,7 +836,7 @@
 // RunLengthEncoder
 //------------------------------------------------------------------------
 
-class RunLengthEncoder: public FilterStream {
+class poppler_EXPORT RunLengthEncoder: public FilterStream {
 public:
 
   RunLengthEncoder(Stream *strA);
diff -N -r -u poppler-0.6.4-orig/poppler/TextOutputDev.h poppler-0.6.4/poppler/TextOutputDev.h
--- poppler-0.6.4-orig/poppler/TextOutputDev.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/TextOutputDev.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef TEXTOUTPUTDEV_H
 #define TEXTOUTPUTDEV_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -52,7 +54,7 @@
 // TextFontInfo
 //------------------------------------------------------------------------
 
-class TextFontInfo {
+class poppler_EXPORT TextFontInfo {
 public:
 
   TextFontInfo(GfxState *state);
@@ -89,7 +91,7 @@
 // TextWord
 //------------------------------------------------------------------------
 
-class TextWord {
+class poppler_EXPORT TextWord {
 public:
 
   // Constructor.
@@ -195,7 +197,7 @@
 // TextPool
 //------------------------------------------------------------------------
 
-class TextPool {
+class poppler_EXPORT TextPool {
 public:
 
   TextPool();
@@ -227,7 +229,7 @@
 // TextLine
 //------------------------------------------------------------------------
 
-class TextLine {
+class poppler_EXPORT TextLine {
 public:
 
   TextLine(TextBlock *blkA, int rotA, double baseA);
@@ -304,7 +306,7 @@
 // TextBlock
 //------------------------------------------------------------------------
 
-class TextBlock {
+class poppler_EXPORT TextBlock {
 public:
 
   TextBlock(TextPage *pageA, int rotA);
@@ -371,7 +373,7 @@
 // TextFlow
 //------------------------------------------------------------------------
 
-class TextFlow {
+class poppler_EXPORT TextFlow {
 public:
 
   TextFlow(TextPage *pageA, TextBlock *blk);
@@ -412,7 +414,7 @@
 // TextWordList
 //------------------------------------------------------------------------
 
-class TextWordList {
+class poppler_EXPORT TextWordList {
 public:
 
   // Build a flat word list, in content stream order (if
@@ -440,7 +442,7 @@
 // TextPage
 //------------------------------------------------------------------------
 
-class TextPage {
+class poppler_EXPORT TextPage {
 public:
 
   // Constructor.
@@ -592,7 +594,7 @@
 // TextOutputDev
 //------------------------------------------------------------------------
 
-class TextOutputDev: public OutputDev {
+class poppler_EXPORT TextOutputDev: public OutputDev {
 public:
 
   // Open a text output file.  If <fileName> is NULL, no file is
diff -N -r -u poppler-0.6.4-orig/poppler/UnicodeMap.h poppler-0.6.4/poppler/UnicodeMap.h
--- poppler-0.6.4-orig/poppler/UnicodeMap.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/poppler/UnicodeMap.h	2008-02-10 23:28:08.000000000 +0100
@@ -11,6 +11,8 @@
 #ifndef UNICODEMAP_H
 #define UNICODEMAP_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -44,7 +46,7 @@
 
 //------------------------------------------------------------------------
 
-class UnicodeMap {
+class poppler_EXPORT UnicodeMap {
 public:
 
   // Create the UnicodeMap specified by <encodingName>.  Sets the
@@ -103,7 +105,7 @@
 
 #define unicodeMapCacheSize 4
 
-class UnicodeMapCache {
+class poppler_EXPORT UnicodeMapCache {
 public:
 
   UnicodeMapCache();
diff -N -r -u poppler-0.6.4-orig/poppler/XRef.h poppler-0.6.4/poppler/XRef.h
--- poppler-0.6.4-orig/poppler/XRef.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/poppler/XRef.h	2008-02-10 23:28:08.000000000 +0100
@@ -9,6 +9,8 @@
 #ifndef XREF_H
 #define XREF_H
 
+#include "poppler-export.h"
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -39,7 +41,7 @@
   Object obj;
 };
 
-class XRef {
+class poppler_EXPORT XRef {
 public:
 
   // Constructor, create an empty XRef, used for PDF writing
diff -N -r -u poppler-0.6.4-orig/poppler-cairo.pc.cmake poppler-0.6.4/poppler-cairo.pc.cmake
--- poppler-0.6.4-orig/poppler-cairo.pc.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/poppler-cairo.pc.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,9 @@
+prefix=@CMAKE_INSTALL_PREFIX@
+exec_prefix=${prefix}
+libdir=${exec_prefix}/lib
+includedir=${prefix}/include
+
+Name: poppler-cairo
+Description: Cairo backend for Poppler PDF rendering library
+Version: @POPPLER_VERSION@
+Requires: poppler = @POPPLER_VERSION@ cairo >= @CAIRO_VERSION@
diff -N -r -u poppler-0.6.4-orig/poppler-config.h.cmake poppler-0.6.4/poppler-config.h.cmake
--- poppler-0.6.4-orig/poppler-config.h.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/poppler-config.h.cmake	2008-02-10 19:16:46.000000000 +0100
@@ -0,0 +1,160 @@
+//================================================= -*- mode: c++ -*- ====
+//
+// poppler-config.h
+//
+// Copyright 1996-2004 Glyph & Cog, LLC
+//
+//========================================================================
+
+#ifndef POPPLER_CONFIG_H
+#define POPPLER_CONFIG_H
+
+// We duplicate some of the config.h #define's here since they are
+// used in some of the header files we install.  The #ifndef/#endif
+// around #undef look odd, but it's to silence warnings about
+// redefining those symbols.
+
+/* Enable multithreading support. */
+#ifndef MULTITHREADED
+#cmakedefine MULTITHREADED 1
+#endif
+
+/* Enable exceptions. */
+#ifndef USE_EXCEPTIONS
+#cmakedefine USE_EXCEPTIONS 1
+#endif
+
+/* Use fixedpoint. */
+#ifndef USE_FIXEDPOINT
+#cmakedefine USE_FIXEDPOINT 1
+#endif
+
+/* Full path for the system-wide xpdfrc file. */
+#ifndef SYSTEM_XPDFRC
+#cmakedefine SYSTEM_XPDFRC 1
+#endif
+
+/* Include support for OPI comments. */
+#ifndef OPI_SUPPORT
+#cmakedefine OPI_SUPPORT 1
+#endif
+
+/* Enable word list support. */
+#ifndef TEXTOUT_WORD_LIST
+#cmakedefine TEXTOUT_WORD_LIST 1
+#endif
+
+// Also, there's a couple of preprocessor symbols in the header files
+// that are used but never defined: DISABLE_OUTLINE, DEBUG_MEM and
+
+//------------------------------------------------------------------------
+// version
+//------------------------------------------------------------------------
+
+// xpdf version
+#define xpdfVersion         "3.00"
+#define xpdfVersionNum      3.00
+#define xpdfMajorVersion    3
+#define xpdfMinorVersion    0
+#define xpdfMajorVersionStr "3"
+#define xpdfMinorVersionStr "0"
+
+// supported PDF version
+#define supportedPDFVersionStr "1.5"
+#define supportedPDFVersionNum 1.5
+
+// copyright notice
+#define xpdfCopyright "Copyright 1996-2004 Glyph & Cog, LLC"
+
+// Windows resource file stuff
+#define winxpdfVersion "WinXpdf 3.00"
+#define xpdfCopyrightAmp "Copyright 1996-2004 Glyph && Cog, LLC"
+
+//------------------------------------------------------------------------
+// paper size
+//------------------------------------------------------------------------
+
+// default paper size (in points) for PostScript output
+#ifdef A4_PAPER
+#define defPaperWidth  595    // ISO A4 (210x297 mm)
+#define defPaperHeight 842
+#else
+#define defPaperWidth  612    // American letter (8.5x11")
+#define defPaperHeight 792
+#endif
+
+//------------------------------------------------------------------------
+// config file (xpdfrc) path
+//------------------------------------------------------------------------
+
+// user config file name, relative to the user's home directory
+#if defined(VMS) || (defined(WIN32) && !defined(__CYGWIN32__))
+#define xpdfUserConfigFile "xpdfrc"
+#else
+#define xpdfUserConfigFile ".xpdfrc"
+#endif
+
+// system config file name (set via the configure script)
+#ifdef SYSTEM_XPDFRC
+#define xpdfSysConfigFile SYSTEM_XPDFRC
+#else
+// under Windows, we get the directory with the executable and then
+// append this file name
+#define xpdfSysConfigFile "xpdfrc"
+#endif
+
+//------------------------------------------------------------------------
+// X-related constants
+//------------------------------------------------------------------------
+
+// default maximum size of color cube to allocate
+#define defaultRGBCube 5
+
+// number of fonts (combined t1lib, FreeType, X server) to cache
+#define xOutFontCacheSize 64
+
+// number of Type 3 fonts to cache
+#define xOutT3FontCacheSize 8
+
+//------------------------------------------------------------------------
+// popen
+//------------------------------------------------------------------------
+
+#if defined(_MSC_VER) || defined(__BORLANDC__)
+#define popen _popen
+#define pclose _pclose
+#endif
+
+#if defined(VMS) || defined(VMCMS) || defined(DOS) || defined(OS2) || defined(__EMX__) || defined(WIN32) || defined(__DJGPP__) || defined(MACOS)
+#define POPEN_READ_MODE "rb"
+#else
+#define POPEN_READ_MODE "r"
+#endif
+
+//------------------------------------------------------------------------
+// Win32 stuff
+//------------------------------------------------------------------------
+
+#ifdef CDECL
+#undef CDECL
+#endif
+
+#if defined(_MSC_VER) || defined(__BORLANDC__)
+#define CDECL __cdecl
+#else
+#define CDECL
+#endif
+
+//------------------------------------------------------------------------
+// Compiler
+//------------------------------------------------------------------------
+
+#if __GNUC__ > 2 || (__GNUC__ == 2 && __GNUC_MINOR__ > 4)
+#define GCC_PRINTF_FORMAT(fmt_index, va_index) \
+	__attribute__((__format__(__printf__, fmt_index, va_index)))
+#else
+#define GCC_PRINTF_FORMAT(fmt_index, va_index)
+#endif
+
+
+#endif /* POPPLER_CONFIG_H */
diff -N -r -u poppler-0.6.4-orig/poppler-glib.pc.cmake poppler-0.6.4/poppler-glib.pc.cmake
--- poppler-0.6.4-orig/poppler-glib.pc.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/poppler-glib.pc.cmake	2008-02-10 18:41:04.000000000 +0100
@@ -0,0 +1,13 @@
+prefix=@CMAKE_INSTALL_PREFIX@
+exec_prefix=${prefix}
+libdir=${exec_prefix}/lib
+includedir=${prefix}/include
+
+Name: poppler-glib
+Description: GLib wrapper for poppler
+Version: @POPPLER_VERSION@
+Requires: @PC_REQUIRES@ gobject-2.0 gdk-2.0 gdk-pixbuf-2.0 @CAIRO_REQ@
+@PC_REQUIRES_PRIVATE@
+
+Libs: -L${libdir} -lpoppler-glib
+Cflags: -I${includedir}/poppler/glib
diff -N -r -u poppler-0.6.4-orig/poppler-qt.pc.cmake poppler-0.6.4/poppler-qt.pc.cmake
--- poppler-0.6.4-orig/poppler-qt.pc.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/poppler-qt.pc.cmake	2008-02-10 18:41:06.000000000 +0100
@@ -0,0 +1,12 @@
+prefix=@CMAKE_INSTALL_PREFIX@
+exec_prefix=${prefix}
+libdir=${exec_prefix}/lib
+includedir=${prefix}/include
+
+Name: poppler-qt
+Description: Qt bindings for poppler
+Version: @POPPLER_VERSION@
+Requires: poppler = @POPPLER_VERSION@
+
+Libs: -L${libdir} -lpoppler-qt
+Cflags: -I${includedir}/poppler/qt3
diff -N -r -u poppler-0.6.4-orig/poppler-qt4.pc.cmake poppler-0.6.4/poppler-qt4.pc.cmake
--- poppler-0.6.4-orig/poppler-qt4.pc.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/poppler-qt4.pc.cmake	2008-02-10 18:41:06.000000000 +0100
@@ -0,0 +1,12 @@
+prefix=@CMAKE_INSTALL_PREFIX@
+exec_prefix=${prefix}
+libdir=${exec_prefix}/lib
+includedir=${prefix}/include
+
+Name: poppler-qt4
+Description: Qt4 bindings for poppler
+Version: @POPPLER_VERSION@
+Requires: poppler = @POPPLER_VERSION@
+
+Libs: -L${libdir} -lpoppler-qt4
+Cflags: -I${includedir}/poppler/qt4
diff -N -r -u poppler-0.6.4-orig/poppler-splash.pc.cmake poppler-0.6.4/poppler-splash.pc.cmake
--- poppler-0.6.4-orig/poppler-splash.pc.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/poppler-splash.pc.cmake	2008-02-10 18:41:06.000000000 +0100
@@ -0,0 +1,9 @@
+prefix=@CMAKE_INSTALL_PREFIX@
+exec_prefix=${prefix}
+libdir=${exec_prefix}/lib
+includedir=${prefix}/include
+
+Name: poppler-splash
+Description: Splash backend for Poppler PDF rendering library
+Version: @POPPLER_VERSION@
+Requires: poppler = @POPPLER_VERSION@
diff -N -r -u poppler-0.6.4-orig/poppler.pc.cmake poppler-0.6.4/poppler.pc.cmake
--- poppler-0.6.4-orig/poppler.pc.cmake	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/poppler.pc.cmake	2008-02-10 18:41:06.000000000 +0100
@@ -0,0 +1,11 @@
+prefix=@CMAKE_INSTALL_PREFIX@
+exec_prefix=${prefix}
+libdir=${exec_prefix}/lib
+includedir=${prefix}/include
+
+Name: poppler
+Description: PDF rendering library
+Version: @POPPLER_VERSION@
+
+Libs: -L${libdir} -lpoppler
+Cflags: -I${includedir}/poppler
diff -N -r -u poppler-0.6.4-orig/qt/CMakeLists.txt poppler-0.6.4/qt/CMakeLists.txt
--- poppler-0.6.4-orig/qt/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/qt/CMakeLists.txt	2008-02-10 18:41:06.000000000 +0100
@@ -0,0 +1,33 @@
+add_definitions(${QT3_DEFINITIONS})
+
+include_directories(
+  ${CMAKE_CURRENT_SOURCE_DIR}
+  ${QT3_INCLUDE_DIR}
+)
+
+set(poppler_qt_SRCS
+  poppler-document.cc
+  poppler-fontinfo.cc
+  poppler-link.cc
+  poppler-page.cc
+  poppler-page-transition.cc
+)
+add_library(poppler-qt SHARED ${poppler_qt_SRCS})
+set_target_properties(poppler-qt PROPERTIES VERSION 2.0.0 SOVERSION 2)
+target_link_libraries(poppler-qt poppler ${QT3_LIBRARIES})
+install(TARGETS poppler-qt DESTINATION lib)
+
+install(FILES
+  poppler-qt.h
+  poppler-page-transition.h
+  poppler-link-qt3.h
+  DESTINATION include/poppler/qt3)
+
+
+set(test_poppler_qt_SOURCES
+  test-poppler-qt.cpp
+)
+poppler_add_test(test-poppler-qt BUILD_QT3_TESTS ${test_poppler_qt_SOURCES})
+target_link_libraries(test-poppler-qt poppler-qt)
+
+
diff -N -r -u poppler-0.6.4-orig/qt4/CMakeLists.txt poppler-0.6.4/qt4/CMakeLists.txt
--- poppler-0.6.4-orig/qt4/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/qt4/CMakeLists.txt	2008-02-10 18:41:06.000000000 +0100
@@ -0,0 +1,2 @@
+add_subdirectory(src)
+add_subdirectory(tests)
diff -N -r -u poppler-0.6.4-orig/qt4/src/CMakeLists.txt poppler-0.6.4/qt4/src/CMakeLists.txt
--- poppler-0.6.4-orig/qt4/src/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/qt4/src/CMakeLists.txt	2008-02-11 00:40:22.000000000 +0100
@@ -0,0 +1,54 @@
+add_definitions(${QT4_DEFINITIONS})
+
+include_directories(
+  ${CMAKE_CURRENT_SOURCE_DIR}
+  ${CMAKE_SOURCE_DIR}/qt # for PageTransition
+  ${QT4_INCLUDE_DIR}
+)
+
+#link_directories( ${CMAKE_BINARY_DIR})
+
+if(MSVC)
+include_directories( ${CMAKE_INSTALL_PATH}/msvc )
+endif(MSVC)
+
+set(poppler_qt4_SRCS
+  poppler-annotation.cc
+  poppler-document.cc
+  poppler-embeddedfile.cc
+  poppler-fontinfo.cc
+  poppler-form.cc
+  poppler-link.cc
+  poppler-link-extractor.cc
+  poppler-page.cc
+  poppler-ps-converter.cc
+  poppler-sound.cc
+  poppler-textbox.cc
+  ${CMAKE_SOURCE_DIR}/qt/poppler-page-transition.cc
+)
+if (ENABLE_SPLASH)
+  set(poppler_qt4_SRCS ${poppler_qt4_SRCS}
+    ${CMAKE_SOURCE_DIR}/poppler/ArthurOutputDev.cc
+  )
+endif (ENABLE_SPLASH)
+add_library(poppler-qt4 SHARED ${poppler_qt4_SRCS})
+set_target_properties(poppler-qt4 PROPERTIES VERSION 2.0.0 SOVERSION 2)
+target_link_libraries(poppler-qt4 poppler ${QT4_QTCORE_LIBRARY} ${QT4_QTGUI_LIBRARY} ${QT4_QTXML_LIBRARY})
+
+install(TARGETS poppler-qt4 RUNTIME DESTINATION bin LIBRARY DESTINATION lib ARCHIVE DESTINATION lib)
+if(MSVC)
+#    add_library(poppler-qt4_STATIC STATIC ${poppler_qt4_SRCS})
+#    set_target_properties(poppler-qt4_STATIC PROPERTIES VERSION 2.0.0 SOVERSION 2)
+#    target_link_libraries(poppler-qt4_STATIC poppler_STATIC ${QT4_QTCORE_LIBRARY} ${QT4_QTGUI_LIBRARY} ${QT4_QTXML_LIBRARY})
+#    set_target_properties(poppler-qt4_STATIC PROPERTIES output_name poppler-qt4 )
+#    install(TARGETS poppler-qt4_STATIC RUNTIME DESTINATION bin LIBRARY DESTINATION lib ARCHIVE DESTINATION lib)
+endif(MSVC)
+
+install(FILES
+  poppler-qt4.h
+  poppler-link.h
+  poppler-annotation.h
+  poppler-form.h
+  ${CMAKE_SOURCE_DIR}/qt/poppler-page-transition.h
+  DESTINATION include/poppler/qt4)
+
diff -N -r -u poppler-0.6.4-orig/qt4/src/poppler-annotation-helper.h poppler-0.6.4/qt4/src/poppler-annotation-helper.h
--- poppler-0.6.4-orig/qt4/src/poppler-annotation-helper.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/qt4/src/poppler-annotation-helper.h	2008-02-11 01:21:08.000000000 +0100
@@ -18,11 +18,12 @@
  * Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA 02110-1301, USA.
  */
 
+#include <poppler-export.h>
 #include <QtCore/QDebug>
 
 namespace Poppler {
 
-class XPDFReader
+class poppler_qt4_EXPORT XPDFReader
 {
     public:
         // find named symbol and parse it
diff -N -r -u poppler-0.6.4-orig/qt4/src/poppler-annotation-private.h poppler-0.6.4/qt4/src/poppler-annotation-private.h
--- poppler-0.6.4-orig/qt4/src/poppler-annotation-private.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/qt4/src/poppler-annotation-private.h	2008-02-11 01:21:42.000000000 +0100
@@ -19,12 +19,13 @@
 #ifndef _POPPLER_ANNOTATION_PRIVATE_H_
 #define _POPPLER_ANNOTATION_PRIVATE_H_
 
+#include <poppler-export.h>
 #include "poppler-annotation.h"
 
 namespace Poppler
 {
 
-class AnnotationPrivate
+class poppler_qt4_EXPORT AnnotationPrivate
 {
     public:
         AnnotationPrivate();
diff -N -r -u poppler-0.6.4-orig/qt4/src/poppler-annotation.h poppler-0.6.4/qt4/src/poppler-annotation.h
--- poppler-0.6.4-orig/qt4/src/poppler-annotation.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/qt4/src/poppler-annotation.h	2008-02-11 01:20:16.000000000 +0100
@@ -21,6 +21,8 @@
 #ifndef _POPPLER_ANNOTATION_H_
 #define _POPPLER_ANNOTATION_H_
 
+#include <poppler-export.h>
+
 #include <QtCore/QDateTime>
 #include <QtCore/QLinkedList>
 #include <QtCore/QList>
@@ -47,7 +49,7 @@
  * \short Helper class for (recursive) Annotation retrieval/storage.
  *
  */
-class AnnotationUtils
+class poppler_qt4_EXPORT AnnotationUtils
 {
     public:
         /**
@@ -80,7 +82,7 @@
  * An Annotation is an object (text note, highlight, sound, popup window, ..)
  * contained by a Page in the document.
  */
-class Annotation
+class poppler_qt4_EXPORT Annotation
 {
   public:
     // enum definitions
@@ -193,7 +195,7 @@
  * A text annotation is an object showing some text directly on the page, or
  * linked to the contents using an icon shown on a page.
  */
-class TextAnnotation : public Annotation
+class poppler_qt4_EXPORT TextAnnotation : public Annotation
 {
   public:
     TextAnnotation();
@@ -237,7 +239,7 @@
  *
  * This annotation represents a polygon (or polyline) to be drawn on a page.
  */
-class LineAnnotation : public Annotation
+class poppler_qt4_EXPORT LineAnnotation : public Annotation
 {
   public:
     LineAnnotation();
@@ -289,7 +291,7 @@
  * The geometric annotation represents a geometric figure, like a rectangle or
  * an ellipse.
  */
-class GeomAnnotation : public Annotation
+class poppler_qt4_EXPORT GeomAnnotation : public Annotation
 {
   public:
     GeomAnnotation();
@@ -320,7 +322,7 @@
  *
  * The higlight annotation represents some areas of text being "highlighted".
  */
-class HighlightAnnotation : public Annotation
+class poppler_qt4_EXPORT HighlightAnnotation : public Annotation
 {
   public:
     HighlightAnnotation();
@@ -356,7 +358,7 @@
  *
  * A simple annotation drawing a stamp on a page.
  */
-class StampAnnotation : public Annotation
+class poppler_qt4_EXPORT StampAnnotation : public Annotation
 {
   public:
     StampAnnotation();
@@ -378,7 +380,7 @@
  *
  * Annotation representing an ink path on a page.
  */
-class InkAnnotation : public Annotation
+class poppler_qt4_EXPORT InkAnnotation : public Annotation
 {
   public:
     InkAnnotation();
@@ -395,7 +397,7 @@
     Q_DISABLE_COPY( InkAnnotation )
 };
 
-class LinkAnnotation : public Annotation
+class poppler_qt4_EXPORT LinkAnnotation : public Annotation
 {
   public:
     LinkAnnotation();
diff -N -r -u poppler-0.6.4-orig/qt4/src/poppler-form.h poppler-0.6.4/qt4/src/poppler-form.h
--- poppler-0.6.4-orig/qt4/src/poppler-form.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/qt4/src/poppler-form.h	2008-02-11 01:29:46.000000000 +0100
@@ -19,6 +19,8 @@
 #ifndef _POPPLER_QT4_FORM_H_
 #define _POPPLER_QT4_FORM_H_
 
+#include <poppler-export.h>
+
 #include <QtCore/QRectF>
 #include <QtCore/QStringList>
 
@@ -36,7 +38,7 @@
     /**
       The base class representing a form field.
      */
-    class FormField {
+    class poppler_qt4_EXPORT FormField {
     public:
 
 	/**
@@ -102,7 +104,7 @@
     /**
       A form field that represents a text input.
      */
-    class FormFieldText : public FormField {
+    class poppler_qt4_EXPORT FormFieldText : public FormField {
     public:
 
 	/**
@@ -173,7 +175,7 @@
     /**
       A form field that represents a choice field.
      */
-    class FormFieldChoice : public FormField {
+    class poppler_qt4_EXPORT FormFieldChoice : public FormField {
     public:
 
 	/**
diff -N -r -u poppler-0.6.4-orig/qt4/src/poppler-link-extractor-private.h poppler-0.6.4/qt4/src/poppler-link-extractor-private.h
--- poppler-0.6.4-orig/qt4/src/poppler-link-extractor-private.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/qt4/src/poppler-link-extractor-private.h	2008-02-11 01:29:52.000000000 +0100
@@ -19,6 +19,8 @@
 #ifndef _POPPLER_LINK_EXTRACTOR_H_
 #define _POPPLER_LINK_EXTRACTOR_H_
 
+#include <poppler-export.h>
+
 #include <OutputDev.h>
 
 #include <QtCore/QList>
@@ -29,7 +31,7 @@
 class PageData;
 class DocumentData;
 
-class LinkExtractorOutputDev : public OutputDev
+class poppler_qt4_EXPORT LinkExtractorOutputDev : public OutputDev
 {
   public:
     LinkExtractorOutputDev(PageData *data, DocumentData *doc);
diff -N -r -u poppler-0.6.4-orig/qt4/src/poppler-link.h poppler-0.6.4/qt4/src/poppler-link.h
--- poppler-0.6.4-orig/qt4/src/poppler-link.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/qt4/src/poppler-link.h	2008-02-11 01:29:50.000000000 +0100
@@ -21,6 +21,8 @@
 #ifndef _POPPLER_LINK_H_
 #define _POPPLER_LINK_H_
 
+#include <poppler-export.h>
+
 #include <QtCore/QString>
 #include <QtCore/QRectF>
 #include <QtCore/QSharedDataPointer>
@@ -43,7 +45,7 @@
  *
  * Coordinates are in 0..1 range
  */
-class LinkDestination
+class poppler_qt4_EXPORT LinkDestination
 {
 	public:
 		enum Kind
@@ -102,7 +104,7 @@
  * kind of links to reimplement the linkType() method and return the type of
  * the link described by the reimplemented class.
  */
-class Link
+class poppler_qt4_EXPORT Link
 {
 	public:
 		Link( const QRectF &linkArea );
@@ -155,7 +157,7 @@
 
 
 /** Goto: a viewport and maybe a reference to an external filename **/
-class LinkGoto : public Link
+class poppler_qt4_EXPORT LinkGoto : public Link
 {
 	public:
 		/**
@@ -187,7 +189,7 @@
 };
 
 /** Execute: filename and parameters to execute **/
-class LinkExecute : public Link
+class poppler_qt4_EXPORT LinkExecute : public Link
 {
 	public:
 		/**
@@ -216,7 +218,7 @@
 };
 
 /** Browse: an URL to open, ranging from 'http://' to 'mailto:', etc. **/
-class LinkBrowse : public Link
+class poppler_qt4_EXPORT LinkBrowse : public Link
 {
 	public:
 		/**
@@ -243,7 +245,7 @@
 };	
 
 /** Action: contains an action to perform on document / viewer **/
-class LinkAction : public Link
+class poppler_qt4_EXPORT LinkAction : public Link
 {
 	public:
 		/**
@@ -287,7 +289,7 @@
 };
 
 /** Sound: a sound to be played **/
-class LinkSound : public Link
+class poppler_qt4_EXPORT LinkSound : public Link
 {
 	public:
 		// create a Link_Sound
@@ -325,7 +327,7 @@
 };
 
 /** Movie: Not yet defined -> think renaming to 'Media' link **/
-class LinkMovie : public Link
+class poppler_qt4_EXPORT LinkMovie : public Link
 // TODO this (Movie link)
 {
 	public:
diff -N -r -u poppler-0.6.4-orig/qt4/src/poppler-page-private.h poppler-0.6.4/qt4/src/poppler-page-private.h
--- poppler-0.6.4-orig/qt4/src/poppler-page-private.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/qt4/src/poppler-page-private.h	2008-02-11 01:29:56.000000000 +0100
@@ -19,12 +19,14 @@
 #ifndef _POPPLER_PAGE_PRIVATE_H_
 #define _POPPLER_PAGE_PRIVATE_H_
 
+#include <poppler-export.h>
+
 #include "poppler-private.h"
 
 namespace Poppler
 {
 
-class PageData {
+class poppler_qt4_EXPORT PageData {
 public:
   Link* convertLinkActionToLink(::LinkAction * a, const QRectF &linkArea, DocumentData * doc);
 
diff -N -r -u poppler-0.6.4-orig/qt4/src/poppler-page.cc poppler-0.6.4/qt4/src/poppler-page.cc
--- poppler-0.6.4-orig/qt4/src/poppler-page.cc	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/qt4/src/poppler-page.cc	2008-02-10 18:41:06.000000000 +0100
@@ -1199,7 +1199,7 @@
     if ( !resolveRevList.isEmpty() )
     {
         // append children to parents
-        int excludeIDs[ resolveRevList.count() ];   // can't even reach this size
+        int *excludeIDs = new int[resolveRevList.count()];   // can't even reach this size
         int excludeIndex = 0;                       // index in excludeIDs array
         QLinkedList< ResolveRevision >::iterator it = resolveRevList.begin(), end = resolveRevList.end();
         for ( ; it != end; ++it )
@@ -1226,6 +1226,7 @@
         // prevent children from being attached to page as roots
         for ( int i = 0; i < excludeIndex; i++ )
             annotationsMap.remove( excludeIDs[ i ] );
+        delete[] excludeIDs;
     }
 
     /** 4 - POSTPROCESS TextAnnotations (when window geom is embedded) */
diff -N -r -u poppler-0.6.4-orig/qt4/src/poppler-private.h poppler-0.6.4/qt4/src/poppler-private.h
--- poppler-0.6.4-orig/qt4/src/poppler-private.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/qt4/src/poppler-private.h	2008-02-11 01:30:00.000000000 +0100
@@ -23,6 +23,8 @@
 #ifndef _POPPLER_PRIVATE_H_
 #define _POPPLER_PRIVATE_H_
 
+#include <poppler-export.h>
+
 #include <config.h>
 #include <GfxState.h>
 #include <GlobalParams.h>
@@ -111,7 +113,7 @@
     }
 
 
-    class LinkDestinationData
+    class poppler_qt4_EXPORT LinkDestinationData
     {
         public:
             LinkDestinationData( LinkDest *l, GooString *nd, Poppler::DocumentData *pdfdoc )
@@ -124,7 +126,7 @@
             Poppler::DocumentData *doc;
     };
 
-    class DocumentData {
+    class poppler_qt4_EXPORT DocumentData {
     public:
 	DocumentData(GooString *filePath, GooString *ownerPassword, GooString *userPassword)
 	    {
@@ -309,7 +311,7 @@
 	static int count;
     };
 
-    class FontInfoData
+    class poppler_qt4_EXPORT FontInfoData
     {
 	public:
 		FontInfoData( const FontInfoData &fid )
@@ -337,7 +339,7 @@
 		FontInfo::Type type;
     };
 
-    class TextBoxData
+    class poppler_qt4_EXPORT TextBoxData
     {
 	public:
 		QString text;
@@ -348,7 +350,7 @@
 		bool hasSpaceAfter;
     };
 
-    class FormFieldData
+    class poppler_qt4_EXPORT FormFieldData
     {
 	public:
 		FormFieldData(DocumentData *_doc, ::Page *p, ::FormWidget *w) :
diff -N -r -u poppler-0.6.4-orig/qt4/src/poppler-qt4.h poppler-0.6.4/qt4/src/poppler-qt4.h
--- poppler-0.6.4-orig/qt4/src/poppler-qt4.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/qt4/src/poppler-qt4.h	2008-02-11 01:34:28.000000000 +0100
@@ -20,6 +20,8 @@
 #ifndef __POPPLER_QT_H__
 #define __POPPLER_QT_H__
 
+#include <poppler-export.h>
+
 #include "poppler-annotation.h"
 #include "poppler-link.h"
 #include "poppler-page-transition.h"
@@ -58,7 +60,7 @@
 	- a QRectF that gives a box that describes where on the page
 	the text is found.
     */
-    class TextBox {
+    class poppler_qt4_EXPORT TextBox {
     friend class Page;
     public:
       /**
@@ -101,7 +103,7 @@
        Container class for information about a font within a PDF
        document
     */
-    class FontInfo {
+    class poppler_qt4_EXPORT FontInfo {
     public:
 	enum Type {
 		unknown,
@@ -192,7 +194,7 @@
     /**
        Container class for an embedded file with a PDF document
     */
-    class EmbeddedFile {
+    class poppler_qt4_EXPORT EmbeddedFile {
     public:
 	/// \cond PRIVATE
 	EmbeddedFile(EmbFile *embfile);
@@ -259,7 +261,7 @@
     /**
        Page within a PDF document
     */
-    class Page {
+    class poppler_qt4_EXPORT Page {
 	friend class Document;
     public:
 	/**
@@ -464,7 +466,7 @@
 
    A document potentially contains multiple Pages
 */
-    class Document {
+    class poppler_qt4_EXPORT Document {
 	friend class Page;
   
     public:
@@ -886,7 +888,7 @@
 height = dummy.height();
        \endcode
     */
-    class PSConverter
+    class poppler_qt4_EXPORT PSConverter
     {
         friend class Document;
         public:
@@ -981,7 +983,7 @@
     /**
        Conversion from PDF date string format to QDateTime
     */
-    QDateTime convertDate( char *dateString );
+    poppler_qt4_EXPORT QDateTime convertDate( char *dateString );
 
     class SoundData;
     /**
@@ -991,7 +993,7 @@
        whose url is represented by url() ), or Embedded, and the player has to
        play the data contained in data().
     */
-    class SoundObject {
+    class poppler_qt4_EXPORT SoundObject {
     public:
 	/**
 	   The type of sound
diff -N -r -u poppler-0.6.4-orig/qt4/tests/CMakeLists.txt poppler-0.6.4/qt4/tests/CMakeLists.txt
--- poppler-0.6.4-orig/qt4/tests/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/qt4/tests/CMakeLists.txt	2008-02-11 01:11:16.000000000 +0100
@@ -0,0 +1,50 @@
+add_definitions(${QT4_DEFINITIONS})
+
+include_directories(
+  ${CMAKE_CURRENT_SOURCE_DIR}
+  ${CMAKE_CURRENT_SOURCE_DIR}/../src
+  ${CMAKE_CURRENT_BINARY_DIR}
+  ${CMAKE_SOURCE_DIR}/qt # for PageTransition
+  ${CMAKE_INCLUDE_PATH}/msvc
+  ${QT4_INCLUDE_DIR}
+)
+
+macro(QT4_ADD_SIMPLETEST exe source)
+  string(REPLACE "-" "" test_name ${exe})
+  set(${test_name}_SOURCES
+    ${source}
+  )
+  poppler_add_test(${exe} BUILD_QT4_TESTS ${${test_name}_SOURCES})
+  target_link_libraries(${exe} poppler-qt4)
+endmacro(QT4_ADD_SIMPLETEST)
+
+macro(QT4_ADD_QTEST exe source)
+  if (QT4_QTTEST_FOUND)
+    string(REPLACE "-" "" test_name ${exe})
+    set(${test_name}_SOURCES
+      ${source}
+    )
+    poppler_add_test(${exe} BUILD_QT4_TESTS ${${test_name}_SOURCES})
+    qt4_automoc(${${test_name}_SOURCES})
+    target_link_libraries(${exe} poppler-qt4 ${QT4_QTTEST_LIBRARY})
+    if(MSVC)
+      target_link_libraries(${exe} poppler)
+    endif(MSVC)
+  endif (QT4_QTTEST_FOUND)
+endmacro(QT4_ADD_QTEST)
+
+
+qt4_add_simpletest(test-poppler-qt4 test-poppler-qt4.cpp)
+qt4_add_simpletest(test-password-qt4 test-password-qt4.cpp)
+qt4_add_simpletest(poppler-fonts poppler-fonts.cpp)
+qt4_add_simpletest(poppler_attachments poppler-attachments.cpp)
+qt4_add_simpletest(stress-poppler-qt4 stress-poppler-qt4.cpp)
+
+qt4_add_qtest(check_attachments check_attachments.cpp)
+qt4_add_qtest(check_dateConversion check_dateConversion.cpp)
+qt4_add_qtest(check_fonts check_fonts.cpp)
+qt4_add_qtest(check_metadata check_metadata.cpp)
+qt4_add_qtest(check_pagelayout check_pagelayout.cpp)
+qt4_add_qtest(check_pagemode check_pagemode.cpp)
+qt4_add_qtest(check_password check_password.cpp)
+qt4_add_qtest(check_permissions check_permissions.cpp)
diff -N -r -u poppler-0.6.4-orig/splash/Splash.h poppler-0.6.4/splash/Splash.h
--- poppler-0.6.4-orig/splash/Splash.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/Splash.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASH_H
 #define SPLASH_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -63,7 +65,7 @@
 // Splash
 //------------------------------------------------------------------------
 
-class Splash {
+class poppler_EXPORT Splash {
 public:
 
   // Create a new rasterizer object.
diff -N -r -u poppler-0.6.4-orig/splash/SplashBitmap.h poppler-0.6.4/splash/SplashBitmap.h
--- poppler-0.6.4-orig/splash/SplashBitmap.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashBitmap.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHBITMAP_H
 #define SPLASHBITMAP_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -18,7 +20,7 @@
 // SplashBitmap
 //------------------------------------------------------------------------
 
-class SplashBitmap {
+class poppler_EXPORT SplashBitmap {
 public:
 
   // Create a new bitmap.  It will have <widthA> x <heightA> pixels in
diff -N -r -u poppler-0.6.4-orig/splash/SplashClip.h poppler-0.6.4/splash/SplashClip.h
--- poppler-0.6.4-orig/splash/SplashClip.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashClip.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHCLIP_H
 #define SPLASHCLIP_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -31,7 +33,7 @@
 // SplashClip
 //------------------------------------------------------------------------
 
-class SplashClip {
+class poppler_EXPORT SplashClip {
 public:
 
   // Create a clip, for the given rectangle.
diff -N -r -u poppler-0.6.4-orig/splash/SplashFont.h poppler-0.6.4/splash/SplashFont.h
--- poppler-0.6.4-orig/splash/SplashFont.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashFont.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHFONT_H
 #define SPLASHFONT_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -33,7 +35,7 @@
 // SplashFont
 //------------------------------------------------------------------------
 
-class SplashFont {
+class poppler_EXPORT SplashFont {
 public:
 
   SplashFont(SplashFontFile *fontFileA, SplashCoord *matA,
diff -N -r -u poppler-0.6.4-orig/splash/SplashFontEngine.h poppler-0.6.4/splash/SplashFontEngine.h
--- poppler-0.6.4-orig/splash/SplashFontEngine.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashFontEngine.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHFONTENGINE_H
 #define SPLASHFONTENGINE_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -30,7 +32,7 @@
 // SplashFontEngine
 //------------------------------------------------------------------------
 
-class SplashFontEngine {
+class poppler_EXPORT SplashFontEngine {
 public:
 
   // Create a font engine.
diff -N -r -u poppler-0.6.4-orig/splash/SplashFontFile.h poppler-0.6.4/splash/SplashFontFile.h
--- poppler-0.6.4-orig/splash/SplashFontFile.h	2008-01-21 21:00:59.000000000 +0100
+++ poppler-0.6.4/splash/SplashFontFile.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHFONTFILE_H
 #define SPLASHFONTFILE_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -42,7 +44,7 @@
   int refcnt;
 };
 
-class SplashFontFile {
+class poppler_EXPORT SplashFontFile {
 public:
 
   virtual ~SplashFontFile();
diff -N -r -u poppler-0.6.4-orig/splash/SplashFontFileID.h poppler-0.6.4/splash/SplashFontFileID.h
--- poppler-0.6.4-orig/splash/SplashFontFileID.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashFontFileID.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHFONTFILEID_H
 #define SPLASHFONTFILEID_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -17,7 +19,7 @@
 // SplashFontFileID
 //------------------------------------------------------------------------
 
-class SplashFontFileID {
+class poppler_EXPORT SplashFontFileID {
 public:
 
   SplashFontFileID();
diff -N -r -u poppler-0.6.4-orig/splash/SplashFTFont.h poppler-0.6.4/splash/SplashFTFont.h
--- poppler-0.6.4-orig/splash/SplashFTFont.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashFTFont.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHFTFONT_H
 #define SPLASHFTFONT_H
 
+#include <poppler/poppler-export.h>
+
 #if HAVE_FREETYPE_FREETYPE_H || HAVE_FREETYPE_H
 
 #ifdef USE_GCC_PRAGMAS
@@ -23,7 +25,7 @@
 // SplashFTFont
 //------------------------------------------------------------------------
 
-class SplashFTFont: public SplashFont {
+class poppler_EXPORT SplashFTFont: public SplashFont {
 public:
 
   SplashFTFont(SplashFTFontFile *fontFileA, SplashCoord *matA,
diff -N -r -u poppler-0.6.4-orig/splash/SplashFTFontEngine.h poppler-0.6.4/splash/SplashFTFontEngine.h
--- poppler-0.6.4-orig/splash/SplashFTFontEngine.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashFTFontEngine.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHFTFONTENGINE_H
 #define SPLASHFTFONTENGINE_H
 
+#include <poppler/poppler-export.h>
+
 #if HAVE_FREETYPE_FREETYPE_H || HAVE_FREETYPE_H
 
 #ifdef USE_GCC_PRAGMAS
diff -N -r -u poppler-0.6.4-orig/splash/SplashFTFontFile.h poppler-0.6.4/splash/SplashFTFontFile.h
--- poppler-0.6.4-orig/splash/SplashFTFontFile.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashFTFontFile.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHFTFONTFILE_H
 #define SPLASHFTFONTFILE_H
 
+#include <poppler/poppler-export.h>
+
 #if HAVE_FREETYPE_FREETYPE_H || HAVE_FREETYPE_H
 
 #ifdef USE_GCC_PRAGMAS
@@ -24,7 +26,7 @@
 // SplashFTFontFile
 //------------------------------------------------------------------------
 
-class SplashFTFontFile: public SplashFontFile {
+class poppler_EXPORT SplashFTFontFile: public SplashFontFile {
 public:
 
   static SplashFontFile *loadType1Font(SplashFTFontEngine *engineA,
diff -N -r -u poppler-0.6.4-orig/splash/SplashPath.h poppler-0.6.4/splash/SplashPath.h
--- poppler-0.6.4-orig/splash/SplashPath.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashPath.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHPATH_H
 #define SPLASHPATH_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -51,7 +53,7 @@
 // SplashPath
 //------------------------------------------------------------------------
 
-class SplashPath {
+class poppler_EXPORT SplashPath {
 public:
 
   // Create an empty path.
diff -N -r -u poppler-0.6.4-orig/splash/SplashPattern.h poppler-0.6.4/splash/SplashPattern.h
--- poppler-0.6.4-orig/splash/SplashPattern.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashPattern.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHPATTERN_H
 #define SPLASHPATTERN_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -19,7 +21,7 @@
 // SplashPattern
 //------------------------------------------------------------------------
 
-class SplashPattern {
+class poppler_EXPORT SplashPattern {
 public:
 
   SplashPattern();
@@ -42,7 +44,7 @@
 // SplashSolidColor
 //------------------------------------------------------------------------
 
-class SplashSolidColor: public SplashPattern {
+class poppler_EXPORT SplashSolidColor: public SplashPattern {
 public:
 
   SplashSolidColor(SplashColorPtr colorA);
diff -N -r -u poppler-0.6.4-orig/splash/SplashScreen.h poppler-0.6.4/splash/SplashScreen.h
--- poppler-0.6.4-orig/splash/SplashScreen.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashScreen.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHSCREEN_H
 #define SPLASHSCREEN_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -17,7 +19,7 @@
 // SplashScreen
 //------------------------------------------------------------------------
 
-class SplashScreen {
+class poppler_EXPORT SplashScreen {
 public:
 
   SplashScreen(SplashScreenParams *params);
diff -N -r -u poppler-0.6.4-orig/splash/SplashState.h poppler-0.6.4/splash/SplashState.h
--- poppler-0.6.4-orig/splash/SplashState.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashState.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHSTATE_H
 #define SPLASHSTATE_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -38,7 +40,7 @@
 // SplashState
 //------------------------------------------------------------------------
 
-class SplashState {
+class poppler_EXPORT SplashState {
 public:
 
   // Create a new state object, initialized with default settings.
diff -N -r -u poppler-0.6.4-orig/splash/SplashT1Font.h poppler-0.6.4/splash/SplashT1Font.h
--- poppler-0.6.4-orig/splash/SplashT1Font.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashT1Font.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHT1FONT_H
 #define SPLASHT1FONT_H
 
+#include <poppler/poppler-export.h>
+
 #if HAVE_T1LIB_H
 
 #ifdef USE_GCC_PRAGMAS
@@ -21,7 +23,7 @@
 // SplashT1Font
 //------------------------------------------------------------------------
 
-class SplashT1Font: public SplashFont {
+class poppler_EXPORT SplashT1Font: public SplashFont {
 public:
 
   SplashT1Font(SplashT1FontFile *fontFileA, SplashCoord *matA,
diff -N -r -u poppler-0.6.4-orig/splash/SplashT1FontEngine.h poppler-0.6.4/splash/SplashT1FontEngine.h
--- poppler-0.6.4-orig/splash/SplashT1FontEngine.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashT1FontEngine.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHT1FONTENGINE_H
 #define SPLASHT1FONTENGINE_H
 
+#include <poppler/poppler-export.h>
+
 #if HAVE_T1LIB_H
 
 #ifdef USE_GCC_PRAGMAS
@@ -23,7 +25,7 @@
 // SplashT1FontEngine
 //------------------------------------------------------------------------
 
-class SplashT1FontEngine {
+class poppler_EXPORT SplashT1FontEngine {
 public:
 
   static SplashT1FontEngine *init(GBool aaA);
diff -N -r -u poppler-0.6.4-orig/splash/SplashT1FontFile.h poppler-0.6.4/splash/SplashT1FontFile.h
--- poppler-0.6.4-orig/splash/SplashT1FontFile.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashT1FontFile.h	2008-02-10 23:28:56.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHT1FONTFILE_H
 #define SPLASHT1FONTFILE_H
 
+#include <poppler/poppler-export.h>
+
 #if HAVE_T1LIB_H
 
 #ifdef USE_GCC_PRAGMAS
@@ -21,7 +23,7 @@
 // SplashT1FontFile
 //------------------------------------------------------------------------
 
-class SplashT1FontFile: public SplashFontFile {
+class poppler_EXPORT SplashT1FontFile: public SplashFontFile {
 public:
 
   static SplashFontFile *loadType1Font(SplashT1FontEngine *engineA,
diff -N -r -u poppler-0.6.4-orig/splash/SplashXPath.h poppler-0.6.4/splash/SplashXPath.h
--- poppler-0.6.4-orig/splash/SplashXPath.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashXPath.h	2008-02-10 23:28:58.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHXPATH_H
 #define SPLASHXPATH_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -46,7 +48,7 @@
 // SplashXPath
 //------------------------------------------------------------------------
 
-class SplashXPath {
+class poppler_EXPORT SplashXPath {
 public:
 
   // Expands (converts to segments) and flattens (converts curves to
diff -N -r -u poppler-0.6.4-orig/splash/SplashXPathScanner.h poppler-0.6.4/splash/SplashXPathScanner.h
--- poppler-0.6.4-orig/splash/SplashXPathScanner.h	2008-01-21 20:59:14.000000000 +0100
+++ poppler-0.6.4/splash/SplashXPathScanner.h	2008-02-10 23:28:58.000000000 +0100
@@ -7,6 +7,8 @@
 #ifndef SPLASHXPATHSCANNER_H
 #define SPLASHXPATHSCANNER_H
 
+#include <poppler/poppler-export.h>
+
 #ifdef USE_GCC_PRAGMAS
 #pragma interface
 #endif
@@ -21,7 +23,7 @@
 // SplashXPathScanner
 //------------------------------------------------------------------------
 
-class SplashXPathScanner {
+class poppler_EXPORT SplashXPathScanner {
 public:
 
   // Create a new SplashXPathScanner object.  <xPathA> must be sorted.
diff -N -r -u poppler-0.6.4-orig/test/CMakeLists.txt poppler-0.6.4/test/CMakeLists.txt
--- poppler-0.6.4-orig/test/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/test/CMakeLists.txt	2008-02-10 18:41:06.000000000 +0100
@@ -0,0 +1,33 @@
+
+if (GTK_FOUND)
+
+  add_definitions(${GTK2_CFLAGS})
+
+  include_directories(
+    ${CMAKE_SOURCE_DIR}/glib
+    ${CMAKE_BINARY_DIR}/glib
+  )
+
+  set (gtk_splash_test_SRCS
+    gtk-splash-test.cc
+  )
+  poppler_add_test(gtk-splash-test BUILD_GTK_TESTS ${gtk_splash_test_SRCS})
+  target_link_libraries(gtk-splash-test poppler ${GTK2_LIBRARIES})
+
+  if (HAVE_CAIRO)
+
+    set (gtk_cairo_test_SRCS
+      gtk-cairo-test.cc
+    )
+    poppler_add_test(gtk-cairo-test BUILD_GTK_TESTS ${gtk_cairo_test_SRCS})
+    target_link_libraries(gtk-cairo-test poppler-glib ${GTK2_LIBRARIES})
+
+    set (pdf_inspector_SRCS
+      pdf-inspector.cc
+    )
+    poppler_add_test(pdf-inspector BUILD_GTK_TESTS ${pdf_inspector_SRCS})
+    target_link_libraries(pdf-inspector poppler-glib ${GTK2_LIBRARIES})
+
+  endif (HAVE_CAIRO)
+
+endif (GTK_FOUND)
diff -N -r -u poppler-0.6.4-orig/utils/CMakeLists.txt poppler-0.6.4/utils/CMakeLists.txt
--- poppler-0.6.4-orig/utils/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ poppler-0.6.4/utils/CMakeLists.txt	2008-02-11 00:21:30.000000000 +0100
@@ -0,0 +1,92 @@
+
+set(common_srcs
+  parseargs.c
+)
+set(common_libs
+  poppler
+)
+if(MSVC)
+  include_directories( ${CMAKE_INCLUDE_PATH}/msvc )
+  set(common_libs ${KDEWIN32_LIBRARY} poppler)
+endif(MSVC)
+
+if (FONTCONFIG_FOUND)
+  set(common_libs ${common_libs} ${FONTCONFIG_LIBRARIES})
+endif (FONTCONFIG_FOUND)
+
+if (ENABLE_SPLASH)
+  # pdftoppm
+  set(pdftoppm_SOURCES ${common_srcs}
+    pdftoppm.cc
+  )
+  add_executable(pdftoppm ${pdftoppm_SOURCES})
+  target_link_libraries(pdftoppm ${common_libs})
+  install(TARGETS pdftoppm DESTINATION bin)
+endif (ENABLE_SPLASH)
+
+# pdffonts
+set(pdffonts_SOURCES ${common_srcs}
+  pdffonts.cc
+)
+add_executable(pdffonts ${pdffonts_SOURCES})
+target_link_libraries(pdffonts ${common_libs})
+install(TARGETS pdffonts DESTINATION bin)
+
+# pdfimages
+set(pdfimages_SOURCES ${common_srcs}
+  pdfimages.cc
+  ImageOutputDev.cc
+  ImageOutputDev.h
+)
+add_executable(pdfimages ${pdfimages_SOURCES})
+target_link_libraries(pdfimages ${common_libs})
+install(TARGETS pdfimages DESTINATION bin)
+
+# pdfinfo
+set(pdfinfo_SOURCES ${common_srcs}
+  pdfinfo.cc
+)
+add_executable(pdfinfo ${pdfinfo_SOURCES})
+target_link_libraries(pdfinfo ${common_libs})
+install(TARGETS pdfinfo DESTINATION bin)
+
+# pdftops
+set(pdftops_SOURCES ${common_srcs}
+  pdftops.cc
+)
+add_executable(pdftops ${pdftops_SOURCES})
+target_link_libraries(pdftops ${common_libs})
+install(TARGETS pdftops DESTINATION bin)
+
+# pdftotext
+set(pdftotext_SOURCES ${common_srcs}
+  pdftotext.cc
+)
+add_executable(pdftotext ${pdftotext_SOURCES})
+target_link_libraries(pdftotext ${common_libs})
+install(TARGETS pdftotext DESTINATION bin)
+
+# pdftohtml
+set(pdftohtml_SOURCES ${common_srcs}
+  pdftohtml.cc
+  HtmlFonts.cc
+  HtmlFonts.h
+  HtmlLinks.cc
+  HtmlLinks.h
+  HtmlOutputDev.cc
+  HtmlOutputDev.h
+)
+add_executable(pdftohtml ${pdftohtml_SOURCES})
+target_link_libraries(pdftohtml ${common_libs})
+install(TARGETS pdftohtml DESTINATION bin)
+
+if (ENABLE_ABIWORD)
+  # pdftoabw
+  set(pdftoabw_SOURCES ${common_srcs}
+    pdftoabw.cc
+  )
+  add_executable(pdftoabw ${pdftoabw_SOURCES})
+  target_link_libraries(pdftoabw ${common_libs})
+  install(TARGETS pdftoabw DESTINATION bin)
+endif (ENABLE_ABIWORD)
+
