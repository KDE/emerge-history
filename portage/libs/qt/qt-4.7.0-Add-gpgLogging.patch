From 65bd2f04133c8d2a46484fb99389988fa4e54f0e Mon Sep 17 00:00:00 2001
From: unknown <Intevation@.(none)>
Date: Fri, 19 Nov 2010 12:31:53 +0100
Subject: [PATCH] Add GPGLogging

---
 src/corelib/global/global.pri  |    4 ++--
 src/corelib/global/qglobal.cpp |    5 +++++
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/corelib/global/global.pri b/src/corelib/global/global.pri
index 9730818..12391f4 100644
--- a/src/corelib/global/global.pri
+++ b/src/corelib/global/global.pri
@@ -7,7 +7,7 @@ HEADERS +=  \
         global/qnumeric_p.h \
         global/qnumeric.h
 
-wince*:HEADERS += global/dlmalloc.h
+wince*:HEADERS += global/dlmalloc.h global/gpglogger_wince.h
 
 SOURCES += \
 	global/qglobal.cpp \
@@ -15,7 +15,7 @@ SOURCES += \
 	global/qmalloc.cpp \
         global/qnumeric.cpp
 
-wince*:SOURCES += global/dlmalloc.c
+wince*:SOURCES += global/dlmalloc.c global/gpglogger_wince.cpp
 
 # qlibraryinfo.cpp includes qconfig.cpp
 INCLUDEPATH += $$QT_BUILD_TREE/src/corelib/global
diff --git a/src/corelib/global/qglobal.cpp b/src/corelib/global/qglobal.cpp
index 3291fe7..52ad458 100644
--- a/src/corelib/global/qglobal.cpp
+++ b/src/corelib/global/qglobal.cpp
@@ -68,8 +68,12 @@
 #  if defined(Q_CC_MSVC)
 #    include <crtdbg.h>
 #  endif
+#else
+# include "gpglogger_wince.h"
+static GPGLogger gpgLogger;
 #endif
 
+
 #if defined(Q_OS_VXWORKS)
 #  include <envLib.h>
 #endif
@@ -2233,6 +2237,7 @@ void qt_message_output(QtMsgType msgType, const char *buf)
         QString fstr = QString::fromLatin1(buf);
         fstr += QLatin1Char('\n');
         OutputDebugString(reinterpret_cast<const wchar_t *> (fstr.utf16()));
+        gpgLogger.log(reinterpret_cast<const wchar_t *> (fstr.utf16()));
 #elif defined(Q_OS_SYMBIAN)
         // RDebug::Print has a cap of 256 characters so break it up
         _LIT(format, "[Qt Message] %S");
-- 
