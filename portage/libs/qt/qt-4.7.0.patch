From 77e7acc841d412eff7d2693e7445f12ab7956b29 Mon Sep 17 00:00:00 2001
From: Christian Ehrlicher <ch.ehrlicher@gmx.de>
Date: Fri, 19 Sep 2008 17:41:26 +0200
Subject: [PATCH] Fix configure.exe to do an out-of-source build on windows

qt-bugs@ issue : N227213
Trolltech task ID : none yet
---
 bin/syncqt             |    6 +++++-
 projects.pro           |    3 +++
 src/tools/moc/main.cpp |    6 ++++++
 3 files changed, 14 insertions(+), 1 deletions(-)

diff --git a/bin/syncqt b/bin/syncqt
index a14a82d..ac140eb 100755
--- a/bin/syncqt
+++ b/bin/syncqt
@@ -366,9 +366,13 @@ sub fixPaths {
         $match_dir = $tmp;
         $i = $slash;
     }
+    my $cnt_ofs = 0;
+    if($match_dir =~ /^[a-zA-Z]:$/) {
+      $cnt_ofs = 1;
+    }
     if($match_dir) {
         my $after = substr($dir, length($match_dir));
-        my $count = ($after =~ tr,/,,);
+        my $count = ($after =~ tr,/,,) - $cnt_ofs;
         my $dots = "";
         for(my $i = 0; $i < $count; $i++) {
             $dots .= "../";
diff --git a/projects.pro b/projects.pro
index aa1eb71..8ae64c2 100644
--- a/projects.pro
+++ b/projects.pro
@@ -149,6 +149,9 @@ unix {
    DEFAULT_QMAKESPEC ~= s,^.*mkspecs/,,g
    mkspecs.commands += $(DEL_FILE) $(INSTALL_ROOT)$$mkspecs.path/default; $(SYMLINK) $$DEFAULT_QMAKESPEC $(INSTALL_ROOT)$$mkspecs.path/default
 }
+win32 {
+   mkspecs.files += $$QT_BUILD_TREE/mkspecs/default
+}
 INSTALLS += mkspecs
 
 false:macx { #mac install location
diff --git a/src/tools/moc/main.cpp b/src/tools/moc/main.cpp
index 8e033b7..b5b2edd 100644
--- a/src/tools/moc/main.cpp
+++ b/src/tools/moc/main.cpp
@@ -94,7 +94,13 @@ static QByteArray combinePath(const char *infile, const char *outfile)
         inSplitted.prepend(QLatin1String(".."));
     }
     inSplitted.append(inFileInfo.fileName());
+#ifdef Q_WS_WIN
+    const QString rel = inSplitted.join(QLatin1String("/"));
+    const QString abs = inFileInfo.absoluteFilePath();
+    return QFile::encodeName(rel.length() < abs.length() ? rel : abs);
+#else
     return QFile::encodeName(inSplitted.join(QLatin1String("/")));
+#endif
 }
 
 
-- 
1.6.5.1.1367.gcd48

From f02fa532c0df62bbfe37cce4bb5516baab59a8bc Mon Sep 17 00:00:00 2001
From: Romain Pokrzywka <romain@kdab.com>
Date: Wed, 28 Apr 2010 12:35:24 +0200
Subject: [PATCH] fix qmlviewer build on wince

---
 tools/qml/qml.pro |   10 +++++++---
 1 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/tools/qml/qml.pro b/tools/qml/qml.pro
index 7a101d0..b33d48b 100644
--- a/tools/qml/qml.pro
+++ b/tools/qml/qml.pro
@@ -14,10 +14,14 @@ target.path = $$[QT_INSTALL_BINS]
 INSTALLS += target
 
 wince* {
-QT += scripttools \
-    xml \
-    phonon
+    QT += xml
 
+    contains(QT_CONFIG, scripttools) {
+        QT += scripttools
+    }
+    contains(QT_CONFIG, phonon) {
+        QT += phonon
+    }
     contains(QT_CONFIG, xmlpatterns) {
         QT += xmlpatterns
     }
-- 
1.6.5.1.1367.gcd48
