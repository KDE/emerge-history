--- libzip-0.8/CMakeLists.txt	2007-12-14 16:51:55.808441900 +0100
+++ libzip-0.8/CMakeLists.txt	2007-12-14 16:52:11.429941900 +0100
@@ -12,6 +12,8 @@
 INCLUDE(CheckFunctionExists)
 INCLUDE(CheckIncludeFiles)
 INCLUDE(CheckSymbolExists)
+FIND_PACKAGE(ZLIB REQUIRED)
+INCLUDE_DIRECTORIES(${ZLIB_INCLUDE_DIR})
 
 SET(PACKAGE "libzip")
 SET(PACKAGE_NAME ${PACKAGE})
@@ -34,11 +34,7 @@
 CHECK_FUNCTION_EXISTS(mkstemp HAVE_MKSTEMP)
 CHECK_INCLUDE_FILES(unistd.h HAVE_UNISTD_H)
 
-INCLUDE(FindZLIB)
-CHECK_SYMBOL_EXISTS(ZEXPORT zlib.h HAVE_ZEXPORT)
-IF(NOT HAVE_ZEXPORT)
-  MESSAGE(FATAL_ERROR "-- ZLIB version too old, please install at least v1.1.2")
-ENDIF(NOT HAVE_ZEXPORT)
+SET(HAVE_ZEXPORT TRUE)
 
 # Targets
 
--- libzip-0.8/lib/CMakeLists.txt	2007-12-14 16:51:55.808441900 +0100
+++ libzip-0.8/lib/CMakeLists.txt	2007-12-14 16:52:11.429941900 +0100
@@ -62,7 +62,7 @@
   zip_dirent.c
   zip_entry_free.c
   zip_entry_new.c
-  ${CMAKE_CURRENT_BINARY_DIR}/zip_err_str.c
+  zip_err_str.c
   zip_error.c
   zip_error_clear.c
   zip_error_get.c
@@ -111,13 +111,13 @@
   ${CMAKE_CURRENT_BINARY_DIR}/..)
 
 # XXX: distribute instead?
-ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/zip_err_str.c
-  COMMAND sh ${CMAKE_CURRENT_SOURCE_DIR}/make_zip_err_str.sh
-    ${CMAKE_CURRENT_SOURCE_DIR}/zip.h
-    ${CMAKE_CURRENT_BINARY_DIR}/zip_err_str.c
-  DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/zip.h
-    ${CMAKE_CURRENT_SOURCE_DIR}/make_zip_err_str.sh
-)
+#ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/zip_err_str.c
+#  COMMAND sh ${CMAKE_CURRENT_SOURCE_DIR}/make_zip_err_str.sh
+#    ${CMAKE_CURRENT_SOURCE_DIR}/zip.h
+#    ${CMAKE_CURRENT_BINARY_DIR}/zip_err_str.c
+#  DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/zip.h
+#    ${CMAKE_CURRENT_SOURCE_DIR}/make_zip_err_str.sh
+#)
 CHECK_FUNCTION_EXISTS(mkstemp HAVE_MKSTEMP)
 IF(NOT HAVE_MKSTEMP)
   SET(LIBZIP_EXTRA_FILES mkstemp.c)
@@ -126,4 +126,5 @@
 ADD_LIBRARY(zip SHARED ${LIBZIP_SOURCES} ${LIBZIP_EXTRA_FILES})
 SET_TARGET_PROPERTIES(zip PROPERTIES VERSION 1.0 SOVERSION 1 )
-TARGET_LINK_LIBRARIES(zip z)
+TARGET_LINK_LIBRARIES(zip ${ZLIB_LIBRARY})
+INSTALL(TARGETS zip RUNTIME DESTINATION bin LIBRARY DESTINATION lib ARCHIVE DESTINATION lib)
 #CREATE_LIBTOOL_FILE(zip lib)
